<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-working-with-scripts/optimizing-scripts-with-asData" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.0">
<title data-rh="true">Optimizing Scripts with asData | Plinth and Plutus Core Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://plutus.cardano.intersectmbo.org/docs/img/docusaurus-social-card.png"><meta data-rh="true" name="twitter:image" content="https://plutus.cardano.intersectmbo.org/docs/img/docusaurus-social-card.png"><meta data-rh="true" property="og:url" content="https://plutus.cardano.intersectmbo.org/docs/working-with-scripts/optimizing-scripts-with-asData"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Optimizing Scripts with asData | Plinth and Plutus Core Documentation"><meta data-rh="true" name="description" content="The Plutus libraries contain a PlutusTx.asData module that contains Template Haskell (TH) code for encoding algebraic data types (ADTs) as Data objects in Plutus Core, as opposed to sums-of-products terms."><meta data-rh="true" property="og:description" content="The Plutus libraries contain a PlutusTx.asData module that contains Template Haskell (TH) code for encoding algebraic data types (ADTs) as Data objects in Plutus Core, as opposed to sums-of-products terms."><link data-rh="true" rel="icon" href="/docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://plutus.cardano.intersectmbo.org/docs/working-with-scripts/optimizing-scripts-with-asData"><link data-rh="true" rel="alternate" href="https://plutus.cardano.intersectmbo.org/docs/working-with-scripts/optimizing-scripts-with-asData" hreflang="en"><link data-rh="true" rel="alternate" href="https://plutus.cardano.intersectmbo.org/docs/working-with-scripts/optimizing-scripts-with-asData" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X6364ZT8L2"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-X6364ZT8L2",{anonymize_ip:!0})</script><link rel="stylesheet" href="/docs/assets/css/styles.225deb0a.css">
<script src="/docs/assets/js/runtime~main.1f3d457e.js" defer="defer"></script>
<script src="/docs/assets/js/main.d2391a78.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/docs/"><div class="navbar__logo"><img src="/docs/img/logo.svg" alt="Plutus Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/docs/img/logo.svg" alt="Plutus Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Plutus</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/">User guide</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item"><a href="https://github.com/IntersectMBO/plutus" class="github-link" target="_blank"></a></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">Plinth User Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/essential-concepts">Essential concepts</a><button aria-label="Expand sidebar category &#x27;Essential concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/example-an-auction-smart-contract">Example: An Auction Smart Contract</a><button aria-label="Expand sidebar category &#x27;Example: An Auction Smart Contract&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/haddock-documentation">Haddock Documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/using-plinth">Using Plinth</a><button aria-label="Expand sidebar category &#x27;Using Plinth&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/working-with-scripts">Working with scripts</a><button aria-label="Collapse sidebar category &#x27;Working with scripts&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/working-with-scripts/ledger-language-version">Plutus Ledger Language Version (Plutus V1/V2/V3)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/working-with-scripts/script-purposes">Script Purposes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/working-with-scripts/producing-a-blueprint">Producing a Plutus contract blueprint</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/working-with-scripts/optimizing-scripts-with-asData">Optimizing Scripts with asData</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/working-with-scripts/simplifying-before-compilation">Simplifying Code Before Compilation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/working-with-scripts/compile-time-evaluation">Compile Time Evaluation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/working-with-scripts/other-optimization-techniques">Other Optimization Techniques</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/working-with-scripts/profiling-budget-usage">Profiling Script Budget Usage</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/delve-deeper">Delve Deeper</a><button aria-label="Expand sidebar category &#x27;Delve Deeper&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/upcoming-features">Upcoming Features</a><button aria-label="Expand sidebar category &#x27;Upcoming Features&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/troubleshooting">Troubleshooting</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/working-with-scripts"><span itemprop="name">Working with scripts</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Optimizing Scripts with asData</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Optimizing Scripts with <code>asData</code></h1></header>
<p>The Plutus libraries contain a <code>PlutusTx.asData</code> module that contains Template Haskell (TH) code for encoding algebraic data types (ADTs) as <code>Data</code> objects in Plutus Core, as opposed to sums-of-products terms.
In general, <code>asData</code> pushes the burden of a computation nearer to where a value is used, in a crude sense making the evaluation less strict and more lazy.
This is intended for expert Plutus developers.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="purpose">Purpose<a href="#purpose" class="hash-link" aria-label="Direct link to Purpose" title="Direct link to Purpose">​</a></h2>
<p>Values stored in datums or redeemers need to be encoded into <code>Data</code> objects.
When writing and optimizing a Plutus script, one of the challenges is finding the right approach to handling <code>Data</code> objects and how expensive that method will be.
To make an informed decision, you may need to benchmark and profile your smart contract code to measure its actual resource consumption.
The primary purpose of <code>asData</code> is to give you more options for how you want to handle <code>Data</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="choice-of-two-approaches">Choice of two approaches<a href="#choice-of-two-approaches" class="hash-link" aria-label="Direct link to Choice of two approaches" title="Direct link to Choice of two approaches">​</a></h2>
<p>When handling <code>Data</code> objects, you have a choice of two pathways.
It is up to you to determine which pathway to use depending on your particular use case.
There are trade offs in performance and where errors occur.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="approach-one-proactively-do-all-of-the-parsing">Approach one: proactively do all of the parsing<a href="#approach-one-proactively-do-all-of-the-parsing" class="hash-link" aria-label="Direct link to Approach one: proactively do all of the parsing" title="Direct link to Approach one: proactively do all of the parsing">​</a></h3>
<p>The first approach is to parse the object immediately (using <code>fromBuiltinData</code>) into a native Plutus Core datatype, which will also identify any problems with the structuring of the object.
However, this performs all the work up front.</p>
<p>This is the normal style that has been promoted in the past.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="approach-two-only-do-the-parsing-if-and-when-necessary">Approach two: only do the parsing if and when necessary<a href="#approach-two-only-do-the-parsing-if-and-when-necessary" class="hash-link" aria-label="Direct link to Approach two: only do the parsing if and when necessary" title="Direct link to Approach two: only do the parsing if and when necessary">​</a></h3>
<p>In the second approach, the script doesn&#x27;t do any parsing work immediately, and instead does it later, when it needs to.
It might be that this saves you a lot of work, because you may never need to parse the entire object.
Instead, the script will just carry the item around as a <code>Data</code> object.</p>
<p>Using this method, every time the script uses the object, it will look at it to find out if it has the right shape.
If it does have the right shape, it will deconstruct the <code>Data</code> object and do its processing; if
not, it will throw an error.
This work may be repeated depending on how your script is written.
In some cases, you might do less work, in some cases you might do more work, depending on your specific use case.</p>
<p>The Plinth library provides some helper types and functions to make this second style easier to do, in the form of the &quot;data-backed&quot; standard types and the <code>asData</code> function.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="data-backed-plinth-standard-library"><code>Data</code>-backed Plinth standard library<a href="#data-backed-plinth-standard-library" class="hash-link" aria-label="Direct link to data-backed-plinth-standard-library" title="Direct link to data-backed-plinth-standard-library">​</a></h2>
<p>The Plinth standard library provides some common types which are already defined as <code>Data</code> objects under the hood.
We refer to such types as being <em>data-backed</em>.</p>
<ul>
<li><a href="https://plutus.cardano.intersectmbo.org/haddock/master/plutus-tx/PlutusTx-Data-List.html#t:List" target="_blank" rel="noopener noreferrer">PlutusTx.Data.List.List</a>, a data-backed version of the regular Plinth <code>[]</code> type.</li>
<li><a href="https://plutus.cardano.intersectmbo.org/haddock/master/plutus-tx/PlutusTx-Data-AssocMap.html#t:Map" target="_blank" rel="noopener noreferrer">PlutusTx.Data.AssocMap.Map</a>, which is the data-backed version of <code>PlutusTx.AssocMap.Map</code>.</li>
</ul>
<p>These types provide similar APIs to their regular Plinth counterparts.</p>
<p>There are also conversion functions between the two representations, and it is up to the developer to decide when or whether to convert to the regular representation or to use the data-backed API.
It depends on a case-by-case basis whether the data-backed or the regular versions perform the best.</p>
<p>It is, however, recommended to use them instead of the regular Plinth types when they are part of other types defined using <code>asData</code>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="using-asdata">Using <code>asData</code><a href="#using-asdata" class="hash-link" aria-label="Direct link to using-asdata" title="Direct link to using-asdata">​</a></h2>
<p>The <code>asData</code> function takes the definition of a data type and replaces it with an equivalent definition whose representation uses <code>Data</code> directly.</p>
<p>For example, if we wanted to use it on the types from the <a href="/docs/auction-smart-contract/on-chain-code">auction example</a>, we would put the datatype declarations inside a Template Haskell quote and call <code>asData</code> on it.</p>
<!-- -->Loading<!-- -->
<p>This is normal Template Haskell that just generates new Haskell source, so you can see the code that it generates with <code>{-# OPTIONS_GHC-ddump-splices #-}</code> but it will look something like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PlutusTx.asData</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[d| data Bid&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        = Bid&#x27; {bBidder&#x27; :: PubKeyHash, bAmount&#x27; :: Lovelace}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        deriving newtype (Eq, Ord, ToBuitinData, FromBuiltinData, UnsafeFromBuiltinData)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    data AuctionRedeemer&#x27; = NewBid&#x27; Bid | Payout&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        deriving newtype (Eq, Ord, ToBuitinData, FromBuiltinData, UnsafeFromBuiltinData) |]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">======&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">newtype Bid&#x27; = Bid&#x27;2 BuiltinData</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deriving newtype (Eq, Ord, PlutusTx.ToData, FromData, UnsafeFromData)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{-# COMPLETE Bid&#x27; #-}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pattern Bid&#x27; :: PubKeyHash -&gt; Lovelace -&gt; Bid&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pattern Bid&#x27; ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">newtype AuctionRedeemer&#x27; = AuctionRedeemer&#x27;2 BuiltinData</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">deriving newtype (Eq, Ord, PlutusTx.ToData, FromData, UnsafeFromData)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{-# COMPLETE NewBid&#x27;, Payout&#x27; #-}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pattern NewBid&#x27; :: Bid -&gt; AuctionRedeemer&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pattern NewBid&#x27; ...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pattern Payout&#x27; :: AuctionRedeemer&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pattern Payout&#x27; ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>That is:</p>
<ul>
<li>It creates a newtype wrapper around <code>BuiltinData</code></li>
<li>It creates pattern synonyms corresponding to each of the constructors you wrote</li>
</ul>
<p>This lets you write code &quot;as if&quot; you were using the original declaration that you wrote, while in fact the pattern synonyms are handling conversion to/from <code>Data</code> for you.
But any values of this type actually are represented with <code>Data</code>.
That means that when we newtype-derive the instances for converting to and from <code>Data</code> we get
the instances for <code>BuiltinData</code> - which are free!</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="nested-fields">Nested fields<a href="#nested-fields" class="hash-link" aria-label="Direct link to Nested fields" title="Direct link to Nested fields">​</a></h3>
<p>The most important caveat to using <code>asData</code> is that <code>Data</code> objects encoding datatypes must also encode the <em>fields</em> of the datatype as <code>Data</code>.
However, <code>asData</code> tries to make the generated code a drop-in replacement for the original code, which means that when using the pattern synonyms they try to give you the fields as they were originally defined, which means <em>not</em> encoded as <code>Data</code>.</p>
<p>For example, in the <code>Bid</code> case above the <code>bAmount</code> field is originally defined to have type <code>Lovelace</code> which is a newtype around a Plutus Core builtin integer.
However, since we are using <code>asData</code>, we need to encode the field into <code>Data</code> in order to store it.
That means that when you construct a <code>Bid</code> object you must take the <code>Integer</code> that you start with and convert it to <code>Data</code>, and when you pattern match on a <code>Bid</code> object you do the reverse conversion.</p>
<p>These conversions are potentially expensive!
If the <code>bAmount</code> field was a complex data structure, then every time we constructed or deconstructed a <code>Bid</code> object we would need to convert that datastructure to or from <code>Data</code>.
Whether or not this is a problem depends on the precise situation, but in general:</p>
<ul>
<li>If the field is a builtin integer or bytestring or a wrapper around those, it is probably cheap</li>
<li>If the field is a datatype which is itself defined with <code>asData</code> then it is free (since it&#x27;s already <code>Data</code>)</li>
<li>If the field is a list or a map, and are defined using the data-backed versions of list and map, then it is free</li>
<li>If the field is any other kind of complex or large datatype, then it is potentially expensive</li>
</ul>
<p>Therefore <code>asData</code> tends to work best when you use it for a type and also for all the types of its fields.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="writing-optimal-code-using-asdata">Writing optimal code using <code>asData</code><a href="#writing-optimal-code-using-asdata" class="hash-link" aria-label="Direct link to writing-optimal-code-using-asdata" title="Direct link to writing-optimal-code-using-asdata">​</a></h3>
<p>Consider the following type encoded using <code>asData</code>, and two functions which produce equivalent results:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PlutusTx.asData</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    [d|</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        data Point =</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">            Point</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                { x :: Int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                , y :: Int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                , z :: Int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    |]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo1 :: Point -&gt; Int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo1 point = x point + y point</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo2 :: Point -&gt; Int</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">foo2 Point {x, y} = x + y</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The second function, <code>foo2</code>, matches on the <code>Point</code> argument using record patterns.
This ensures that both fields are extracted at the same time from the underlying <code>Data</code> object.
In <code>foo1</code>, which uses field accessors instead, this will only be the case if the compiler detects that <code>x point</code> and <code>y point</code> both contain a common subexpression which can be factored out.
Depending on this compiler optimisation is unreliable, therefore the approach illustrated in <code>foo2</code> is preferred.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="choosing-an-approach">Choosing an approach<a href="#choosing-an-approach" class="hash-link" aria-label="Direct link to Choosing an approach" title="Direct link to Choosing an approach">​</a></h2>
<p>There are a number of tradeoffs to consider:</p>
<ol>
<li>Plinth&#x27;s datatypes are faster to work with and easier to optimize than <code>Data</code>, so if the resulting object is going to be processed in its entirety (or have parts of it repeatedly processed) then it can be better to parse it up-front.</li>
<li>If it is important to check that the entire structure is well-formed, then it is better to parse it up-front, since the conversion will check the entire structure for well-formedness immediately, rather than checking only the parts that are used when they are used.</li>
<li>If you do not want to use <code>asData</code> for the types of the fields, then it may be better to not use it at all in order to avoid conversion penalties at the use sites.</li>
</ol>
<p>Which approach is better is an empirical question and may vary in different cases.
A single script may wish to use different approaches in different places.
For example, your datum might contain a large state object which is usually only inspected in part (a good candidate for <code>asData</code>), whereas your redeemer might be a small object which is inspected frequently to determine what to do (a good candidate for a native Plinth datatype).</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="data-backed-scriptcontext">Data-backed <code>ScriptContext</code><a href="#data-backed-scriptcontext" class="hash-link" aria-label="Direct link to data-backed-scriptcontext" title="Direct link to data-backed-scriptcontext">​</a></h2>
<p>The <a href="/docs/working-with-scripts/ledger-language-version#scriptcontext">ScriptContext</a> is one type which can massively benefit from the <code>asData</code> approach.</p>
<p>Plinth scripts receive information from the ledger in the form of a <code>BuiltinData</code> argument.
This argument can be very large, especially in the case of <a href="/docs/working-with-scripts/ledger-language-version#plutus-v3">V3</a> scripts.
Therefore, upfront parsing of this <code>BuiltinData</code> object into a native Plinth datatype may sometimes constitute wasted effort if the script does not make use of most of the information inside the script context.
This effort translates into high evaluation fees which could be avoided if the script would parse only what it needs from the script context.</p>
<p>For this use-case, we provide a version of the ledger API in which the <code>ScriptContext</code> types are data-backed, i.e. they are defined using this <code>asData</code> approach, and so are all the types on which the script contexts depend on as fields.</p>
<p>The module naming scheme is as follows:</p>
<ul>
<li>the <code>PlutusLedgerApi/Data/</code> directory contains the data-backed versions of the top-level <code>V1</code>, <code>V2</code> and <code>V3</code> modules</li>
<li>inside each of the <code>PlutusLedgerApi/Vn</code> directories, where <code>n</code> represents the language version number, there is a <code>Data/</code> directory with the data-backed versions of modules specific to each language version.</li>
</ul>
<p>Using this version of the ledger API can be as simple as modifying the relevant imports; for example, importing <a href="https://plutus.cardano.intersectmbo.org/haddock/master/plutus-ledger-api/PlutusLedgerApi-Data-V3.html" target="_blank" rel="noopener noreferrer">PlutusLedgerApi.Data.V3</a> instead of <a href="https://plutus.cardano.intersectmbo.org/haddock/master/plutus-ledger-api/PlutusLedgerApi-V3.html" target="_blank" rel="noopener noreferrer">PlutusLedgerApi.V3</a>, and so on.</p>
<p>If your script is slightly more complex, and it operates on those fields of the script context which are represented as lists or maps, then you will need to also import the respective data-backed collection type from the Plinth standard library.</p>
<p>It is recommended to use record patterns to extract all necessary fields of the <code>ScriptContext</code> at the beginning of a function.
The reasoning behind this is briefly explained <a href="#writing-optimal-code-using-asdata">above</a>.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/IntersectMBO/plutus/edit/master/doc/docusaurus/docs/working-with-scripts/optimizing-scripts-with-asData.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/working-with-scripts/producing-a-blueprint"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Producing a Plutus contract blueprint</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/working-with-scripts/simplifying-before-compilation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Simplifying Code Before Compilation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#purpose" class="table-of-contents__link toc-highlight">Purpose</a></li><li><a href="#choice-of-two-approaches" class="table-of-contents__link toc-highlight">Choice of two approaches</a><ul><li><a href="#approach-one-proactively-do-all-of-the-parsing" class="table-of-contents__link toc-highlight">Approach one: proactively do all of the parsing</a></li><li><a href="#approach-two-only-do-the-parsing-if-and-when-necessary" class="table-of-contents__link toc-highlight">Approach two: only do the parsing if and when necessary</a></li></ul></li><li><a href="#data-backed-plinth-standard-library" class="table-of-contents__link toc-highlight"><code>Data</code>-backed Plinth standard library</a></li><li><a href="#using-asdata" class="table-of-contents__link toc-highlight">Using <code>asData</code></a><ul><li><a href="#nested-fields" class="table-of-contents__link toc-highlight">Nested fields</a></li><li><a href="#writing-optimal-code-using-asdata" class="table-of-contents__link toc-highlight">Writing optimal code using <code>asData</code></a></li></ul></li><li><a href="#choosing-an-approach" class="table-of-contents__link toc-highlight">Choosing an approach</a></li><li><a href="#data-backed-scriptcontext" class="table-of-contents__link toc-highlight">Data-backed <code>ScriptContext</code></a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="footer-container"><div class="footer-left"><img class="footer-logo" src="/docs/img/logo-footer.svg" alt="Plutus"><span>Copyright ©<!-- -->2025<!-- --> IOHK. Built with Docusaurus.</span></div><div class="footer-right"><a href="/docs/">User Guide</a><a href="https://github.com/IntersectMBO/plutus" class="github-link" target="_blank"></a></div></div></footer></div>
</body>
</html>