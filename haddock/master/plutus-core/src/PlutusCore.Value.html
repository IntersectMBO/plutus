<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
><head
  ><link rel="stylesheet" type="text/css" href="style.css"
     /><script type="text/javascript" src="highlight.js"
    ></script
    ></head
  ><body
  ><pre
    ><span class="hs-pragma"
      >{-# LANGUAGE BangPatterns #-}</span
      ><span
      >
</span
      ><span id="line-2"
      ></span
      ><span class="hs-pragma"
      >{-# LANGUAGE BlockArguments #-}</span
      ><span
      >
</span
      ><span id="line-3"
      ></span
      ><span class="hs-pragma"
      >{-# LANGUAGE DeriveAnyClass #-}</span
      ><span
      >
</span
      ><span id="line-4"
      ></span
      ><span class="hs-pragma"
      >{-# LANGUAGE FlexibleInstances #-}</span
      ><span
      >
</span
      ><span id="line-5"
      ></span
      ><span class="hs-pragma"
      >{-# LANGUAGE LambdaCase #-}</span
      ><span
      >
</span
      ><span id="line-6"
      ></span
      ><span class="hs-pragma"
      >{-# LANGUAGE TupleSections #-}</span
      ><span
      >
</span
      ><span id="line-7"
      ></span
      ><span class="hs-pragma"
      >{-# LANGUAGE ViewPatterns #-}</span
      ><span
      >
</span
      ><span id="line-8"
      ></span
      ><span
      >
</span
      ><span id="line-9"
      ></span
      ><span class="hs-keyword"
      >module</span
      ><span
      > </span
      ><span class="hs-identifier"
      >PlutusCore.Value</span
      ><span
      >
</span
      ><span id="line-10"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >(</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-comment"
      >-- Do not expose data constructor</span
      ><span
      >
</span
      ><span id="line-11"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier"
	  >K</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-comment"
      >-- Do not expose data constructor</span
      ><span
      >
</span
      ><span id="line-12"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#k"
	><span class="hs-identifier"
	  >k</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-13"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#unK"
	><span class="hs-identifier"
	  >unK</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-14"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#maxKeyLen"
	><span class="hs-identifier"
	  >maxKeyLen</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-15"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier"
	  >Quantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-comment"
      >-- Do not expose data constructor</span
      ><span
      >
</span
      ><span id="line-16"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#quantity"
	><span class="hs-identifier"
	  >quantity</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-17"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#unQuantity"
	><span class="hs-identifier"
	  >unQuantity</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-18"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#zeroQuantity"
	><span class="hs-identifier"
	  >zeroQuantity</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-19"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#addQuantity"
	><span class="hs-identifier"
	  >addQuantity</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-20"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#negativeAmounts"
	><span class="hs-identifier"
	  >negativeAmounts</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-21"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#NestedMap"
	><span class="hs-identifier"
	  >NestedMap</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-22"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#unpack"
	><span class="hs-identifier"
	  >unpack</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-23"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#pack"
	><span class="hs-identifier"
	  >pack</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-24"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#empty"
	><span class="hs-identifier"
	  >empty</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-25"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#fromList"
	><span class="hs-identifier"
	  >fromList</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-26"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#toList"
	><span class="hs-identifier"
	  >toList</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-27"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#toFlatList"
	><span class="hs-identifier"
	  >toFlatList</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-28"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#totalSize"
	><span class="hs-identifier"
	  >totalSize</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-29"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#maxInnerSize"
	><span class="hs-identifier"
	  >maxInnerSize</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-30"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#insertCoin"
	><span class="hs-identifier"
	  >insertCoin</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-31"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#deleteCoin"
	><span class="hs-identifier"
	  >deleteCoin</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-32"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#scaleValue"
	><span class="hs-identifier"
	  >scaleValue</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-33"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#lookupCoin"
	><span class="hs-identifier"
	  >lookupCoin</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-34"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#valueContains"
	><span class="hs-identifier"
	  >valueContains</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-35"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#unionValue"
	><span class="hs-identifier"
	  >unionValue</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-36"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#valueData"
	><span class="hs-identifier"
	  >valueData</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-37"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#unValueData"
	><span class="hs-identifier"
	  >unValueData</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-38"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-39"
      ></span
      ><span
      >
</span
      ><span id="line-40"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.html"
	><span class="hs-identifier"
	  >Codec.Serialise</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >qualified</span
      ><span
      > </span
      ><span class="hs-keyword"
      >as</span
      ><span
      > </span
      ><span class="annot"
      ><span class="hs-identifier"
	>CBOR</span
	></span
      ><span
      >
</span
      ><span id="line-41"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/deepseq-1.4.8.1/docs/src/Control.DeepSeq.html"
	><span class="hs-identifier"
	  >Control.DeepSeq</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/deepseq-1.4.8.1/docs/src/Control.DeepSeq.html#NFData"
	><span class="hs-identifier"
	  >NFData</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-42"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/extra-1.8.1/docs/src/Control.Monad.Extra.html"
	><span class="hs-identifier"
	  >Control.Monad.Extra</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.html#unless"
	><span class="hs-identifier"
	  >unless</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#when"
	><span class="hs-identifier"
	  >when</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/extra-1.8.1/docs/src/Control.Monad.Extra.html#whenJust"
	><span class="hs-identifier"
	  >whenJust</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-43"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Bifunctor.html"
	><span class="hs-identifier"
	  >Data.Bifunctor</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-44"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/bytestring-0.11.5.4/docs/src/Data.ByteString.html"
	><span class="hs-identifier"
	  >Data.ByteString</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/bytestring-0.11.5.4/docs/src/Data.ByteString.Internal.Type.html#ByteString"
	><span class="hs-identifier"
	  >ByteString</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-45"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/bytestring-0.11.5.4/docs/src/Data.ByteString.html"
	><span class="hs-identifier"
	  >Data.ByteString</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >qualified</span
      ><span
      > </span
      ><span class="hs-keyword"
      >as</span
      ><span
      > </span
      ><span class="annot"
      ><span class="hs-identifier"
	>B</span
	></span
      ><span
      >
</span
      ><span id="line-46"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><span class="hs-identifier"
	>Data.ByteString.Base64</span
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >qualified</span
      ><span
      > </span
      ><span class="hs-keyword"
      >as</span
      ><span
      > </span
      ><span class="annot"
      ><span class="hs-identifier"
	>Base64</span
	></span
      ><span
      >
</span
      ><span id="line-47"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Foldable.html"
	><span class="hs-identifier"
	  >Data.Foldable</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Foldable.html#find"
	><span class="hs-identifier"
	  >find</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-48"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/hashable-1.5.1.0/docs/src/Data.Hashable.html"
	><span class="hs-identifier"
	  >Data.Hashable</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/hashable-1.5.1.0/docs/src/Data.Hashable.Class.html#Hashable"
	><span class="hs-identifier"
	  >Hashable</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="hs-glyph"
      >..</span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-49"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.IntMap.Strict.html"
	><span class="hs-identifier"
	  >Data.IntMap.Strict</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.IntMap.Internal.html#IntMap"
	><span class="hs-identifier"
	  >IntMap</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-50"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.IntMap.Strict.html"
	><span class="hs-identifier"
	  >Data.IntMap.Strict</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >qualified</span
      ><span
      > </span
      ><span class="hs-keyword"
      >as</span
      ><span
      > </span
      ><span class="annot"
      ><span class="hs-identifier"
	>IntMap</span
	></span
      ><span
      >
</span
      ><span id="line-51"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Merge.Strict.html"
	><span class="hs-identifier"
	  >Data.Map.Merge.Strict</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >qualified</span
      ><span
      > </span
      ><span class="hs-keyword"
      >as</span
      ><span
      > </span
      ><span class="annot"
      ><span class="hs-identifier"
	>M</span
	></span
      ><span
      >
</span
      ><span id="line-52"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Strict.html"
	><span class="hs-identifier"
	  >Data.Map.Strict</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#Map"
	><span class="hs-identifier"
	  >Map</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-53"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Strict.html"
	><span class="hs-identifier"
	  >Data.Map.Strict</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >qualified</span
      ><span
      > </span
      ><span class="hs-keyword"
      >as</span
      ><span
      > </span
      ><span class="annot"
      ><span class="hs-identifier"
	>Map</span
	></span
      ><span
      >
</span
      ><span id="line-54"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/text-2.0.2/docs/src/Data.Text.Encoding.html"
	><span class="hs-identifier"
	  >Data.Text.Encoding</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >qualified</span
      ><span
      > </span
      ><span class="hs-keyword"
      >as</span
      ><span
      > </span
      ><span class="annot"
      ><span class="hs-identifier"
	>Text</span
	></span
      ><span
      >
</span
      ><span id="line-55"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Generics.html"
	><span class="hs-identifier"
	  >GHC.Generics</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-56"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Stack.html"
	><span class="hs-identifier"
	  >GHC.Stack</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-57"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >(</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Stack.Types.html#HasCallStack"
	><span class="hs-identifier"
	  >HasCallStack</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-58"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Stack.html#callStack"
	><span class="hs-identifier"
	  >callStack</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-59"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Stack.Types.html#getCallStack"
	><span class="hs-identifier"
	  >getCallStack</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-60"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-61"
      ></span
      ><span
      >
</span
      ><span id="line-62"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Builtin.Result.html"
	><span class="hs-identifier"
	  >PlutusCore.Builtin.Result</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-63"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Data.html"
	><span class="hs-identifier"
	  >PlutusCore.Data</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Data.html#Data"
	><span class="hs-identifier"
	  >Data</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="hs-glyph"
      >..</span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-64"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="../../plutus-core/src/PlutusCore.Flat.html"
	><span class="hs-identifier"
	  >PlutusCore.Flat</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >qualified</span
      ><span
      > </span
      ><span class="hs-keyword"
      >as</span
      ><span
      > </span
      ><span class="annot"
      ><span class="hs-identifier"
	>Flat</span
	></span
      ><span
      >
</span
      ><span id="line-65"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusPrelude.html"
	><span class="hs-identifier"
	  >PlutusPrelude</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/prettyprinter-1.7.1/docs/src/Prettyprinter.Internal.html#Pretty"
	><span class="hs-identifier"
	  >Pretty</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="hs-glyph"
      >..</span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-66"
      ></span
      ><span
      >
</span
      ><span id="line-67"
      ></span
      ><span class="hs-comment"
      >-- Max length (in bytes) for currency symbols and token names in `Value`,</span
      ><span
      >
</span
      ><span id="line-68"
      ></span
      ><span class="hs-comment"
      >-- both of which cannot exceed 32 bytes. Currency symbols are in fact either</span
      ><span
      >
</span
      ><span id="line-69"
      ></span
      ><span class="hs-comment"
      >-- empty or 28 bytes, but for simplicity we allow anything between 0 and 32 bytes.</span
      ><span
      >
</span
      ><span id="line-70"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#maxKeyLen"
	><span class="hs-identifier hs-type"
	  >maxKeyLen</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-71"
      ></span
      ><span id="maxKeyLen"
      ><span class="annot"
	><span class="annottext"
	  >maxKeyLen :: Int
</span
	  ><a href="PlutusCore.Value.html#maxKeyLen"
	  ><span class="hs-identifier hs-var hs-var"
	    >maxKeyLen</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>32</span
	></span
      ><span
      >
</span
      ><span id="line-72"
      ></span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#maxKeyLen"
	><span class="hs-pragma hs-type"
	  >maxKeyLen</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-73"
      ></span
      ><span
      >
</span
      ><span id="line-74"
      ></span
      ><span class="hs-comment"
      >----------------------------------------------------------------------------------------------------</span
      ><span
      >
</span
      ><span id="line-75"
      ></span
      ><span class="hs-comment"
      >-- Newtype-wrapper for keys used in the nested maps ------------------------------------------------</span
      ><span
      >
</span
      ><span id="line-76"
      ></span
      ><span
      >
</span
      ><span id="line-77"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>-- | A `ByteString` with maximum length of `maxKeyLen` bytes.</span
	></span
      ><span
      >
</span
      ><span id="line-78"
      ></span
      ><span class="hs-keyword"
      >newtype</span
      ><span
      > </span
      ><span id="K"
      ><span class="annot"
	><a href="PlutusCore.Value.html#K"
	  ><span class="hs-identifier hs-var"
	    >K</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span id="UnsafeK"
      ><span class="annot"
	><a href="PlutusCore.Value.html#UnsafeK"
	  ><span class="hs-identifier hs-var"
	    >UnsafeK</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >{</span
      ><span id="unK"
      ><span class="annot"
	><span class="annottext"
	  >K -&gt; ByteString
</span
	  ><a href="PlutusCore.Value.html#unK"
	  ><span class="hs-identifier hs-var hs-var"
	    >unK</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/bytestring-0.11.5.4/docs/src/Data.ByteString.Internal.Type.html#ByteString"
	><span class="hs-identifier hs-type"
	  >ByteString</span
	  ></a
	></span
      ><span class="hs-special"
      >}</span
      ><span
      >
</span
      ><span id="line-79"
      ></span
      ><span
      >  </span
      ><span class="hs-keyword"
      >deriving</span
      ><span
      > </span
      ><span class="annot"
      ><span class="hs-keyword"
	>newtype</span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682073938"
      ><span id="local-6989586621682073943"
	><span class="annot"
	  ><span class="annottext"
	    >K -&gt; K -&gt; Bool
(K -&gt; K -&gt; Bool) -&gt; (K -&gt; K -&gt; Bool) -&gt; Eq K
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: K -&gt; K -&gt; Bool
== :: K -&gt; K -&gt; Bool
$c/= :: K -&gt; K -&gt; Bool
/= :: K -&gt; K -&gt; Bool
</span
	    ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#Eq"
	    ><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var"
	      >Eq</span
	      ></a
	    ></span
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682073951"
      ><span id="local-6989586621682073956"
	><span id="local-6989586621682073960"
	  ><span id="local-6989586621682073964"
	    ><span id="local-6989586621682073968"
	      ><span id="local-6989586621682073972"
		><span id="local-6989586621682073976"
		  ><span class="annot"
		    ><span class="annottext"
		      >Eq K
Eq K =&gt;
(K -&gt; K -&gt; Ordering)
-&gt; (K -&gt; K -&gt; Bool)
-&gt; (K -&gt; K -&gt; Bool)
-&gt; (K -&gt; K -&gt; Bool)
-&gt; (K -&gt; K -&gt; Bool)
-&gt; (K -&gt; K -&gt; K)
-&gt; (K -&gt; K -&gt; K)
-&gt; Ord K
K -&gt; K -&gt; Bool
K -&gt; K -&gt; Ordering
K -&gt; K -&gt; K
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: K -&gt; K -&gt; Ordering
compare :: K -&gt; K -&gt; Ordering
$c&lt; :: K -&gt; K -&gt; Bool
&lt; :: K -&gt; K -&gt; Bool
$c&lt;= :: K -&gt; K -&gt; Bool
&lt;= :: K -&gt; K -&gt; Bool
$c&gt; :: K -&gt; K -&gt; Bool
&gt; :: K -&gt; K -&gt; Bool
$c&gt;= :: K -&gt; K -&gt; Bool
&gt;= :: K -&gt; K -&gt; Bool
$cmax :: K -&gt; K -&gt; K
max :: K -&gt; K -&gt; K
$cmin :: K -&gt; K -&gt; K
min :: K -&gt; K -&gt; K
</span
		      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#Ord"
		      ><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var"
			>Ord</span
			></a
		      ></span
		    ></span
		  ></span
		></span
	      ></span
	    ></span
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682073981"
      ><span id="local-6989586621682073986"
	><span id="local-6989586621682073990"
	  ><span class="annot"
	    ><span class="annottext"
	      >Int -&gt; K -&gt; ShowS
[K] -&gt; ShowS
K -&gt; String
(Int -&gt; K -&gt; ShowS) -&gt; (K -&gt; String) -&gt; ([K] -&gt; ShowS) -&gt; Show K
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; K -&gt; ShowS
showsPrec :: Int -&gt; K -&gt; ShowS
$cshow :: K -&gt; String
show :: K -&gt; String
$cshowList :: [K] -&gt; ShowS
showList :: [K] -&gt; ShowS
</span
	      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Show.html#Show"
	      ><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var"
		>Show</span
		></a
	      ></span
	    ></span
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682073998"
      ><span id="local-6989586621682074003"
	><span class="annot"
	  ><span class="annottext"
	    >Eq K
Eq K =&gt; (Int -&gt; K -&gt; Int) -&gt; (K -&gt; Int) -&gt; Hashable K
Int -&gt; K -&gt; Int
K -&gt; Int
forall a. Eq a =&gt; (Int -&gt; a -&gt; Int) -&gt; (a -&gt; Int) -&gt; Hashable a
$chashWithSalt :: Int -&gt; K -&gt; Int
hashWithSalt :: Int -&gt; K -&gt; Int
$chash :: K -&gt; Int
hash :: K -&gt; Int
</span
	    ><a href="https://hackage.haskell.org/package/hashable-1.5.1.0/docs/src/Data.Hashable.Class.html#Hashable"
	    ><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var"
	      >Hashable</span
	      ></a
	    ></span
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074009"
      ><span class="annot"
	><span class="annottext"
	  >K -&gt; ()
(K -&gt; ()) -&gt; NFData K
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: K -&gt; ()
rnf :: K -&gt; ()
</span
	  ><a href="https://hackage.haskell.org/package/deepseq-1.4.8.1/docs/src/Control.DeepSeq.html#NFData"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >NFData</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-80"
      ></span
      ><span
      >  </span
      ><span class="hs-keyword"
      >deriving</span
      ><span
      > </span
      ><span class="annot"
      ><span class="hs-keyword"
	>stock</span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074016"
      ><span id="local-6989586621682074018"
	><span class="annot"
	  ><span class="annottext"
	    >(forall x. K -&gt; Rep K x) -&gt; (forall x. Rep K x -&gt; K) -&gt; Generic K
forall x. Rep K x -&gt; K
forall x. K -&gt; Rep K x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. K -&gt; Rep K x
from :: forall x. K -&gt; Rep K x
$cto :: forall x. Rep K x -&gt; K
to :: forall x. Rep K x -&gt; K
</span
	    ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Generics.html#Generic"
	    ><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var"
	      >Generic</span
	      ></a
	    ></span
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-81"
      ></span
      ><span
      >
</span
      ><span id="line-82"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#k"
	><span class="hs-identifier hs-type"
	  >k</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/bytestring-0.11.5.4/docs/src/Data.ByteString.Internal.Type.html#ByteString"
	><span class="hs-identifier hs-type"
	  >ByteString</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Maybe"
	><span class="hs-identifier hs-type"
	  >Maybe</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier hs-type"
	  >K</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-83"
      ></span
      ><span id="k"
      ><span class="annot"
	><span class="annottext"
	  >k :: ByteString -&gt; Maybe K
</span
	  ><a href="PlutusCore.Value.html#k"
	  ><span class="hs-identifier hs-var hs-var"
	    >k</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074021"
      ><span class="annot"
	><span class="annottext"
	  >ByteString
</span
	  ><a href="#local-6989586621682074021"
	  ><span class="hs-identifier hs-var"
	    >b</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-keyword"
      >if</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; Int
</span
	><a href="https://hackage.haskell.org/package/bytestring-0.11.5.4/docs/src/Data.ByteString.html#length"
	><span class="hs-identifier hs-var"
	  >B.length</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString
</span
	><a href="#local-6989586621682074021"
	><span class="hs-identifier hs-var"
	  >b</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3C%3D"
	><span class="hs-operator hs-var"
	  >&lt;=</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="PlutusCore.Value.html#maxKeyLen"
	><span class="hs-identifier hs-var"
	  >maxKeyLen</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >then</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K -&gt; Maybe K
forall a. a -&gt; Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-var"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; K
</span
	><a href="PlutusCore.Value.html#UnsafeK"
	><span class="hs-identifier hs-var"
	  >UnsafeK</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString
</span
	><a href="#local-6989586621682074021"
	><span class="hs-identifier hs-var"
	  >b</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-keyword"
      >else</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe K
forall a. Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-84"
      ></span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#k"
	><span class="hs-pragma hs-type"
	  >k</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-85"
      ></span
      ><span
      >
</span
      ><span id="line-86"
      ></span
      ><span class="hs-keyword"
      >instance</span
      ><span
      > </span
      ><span id="local-6989586621682074027"
      ><span class="annot"
	><a href="../../plutus-core/src/PlutusCore.Flat.Class.html#Flat"
	  ><span class="hs-identifier hs-type"
	    >Flat.Flat</span
	    ></a
	  ></span
	><span
	> </span
	><span class="annot"
	><a href="PlutusCore.Value.html#K"
	  ><span class="hs-identifier hs-type"
	    >K</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-87"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621682074042"
      ><span class="annot"
	><span class="annottext"
	  >encode :: K -&gt; Encoding
</span
	  ><a href="#local-6989586621682074042"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >encode</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#UnsafeK"
	><span class="hs-identifier hs-type"
	  >UnsafeK</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074044"
      ><span class="annot"
	><span class="annottext"
	  >ByteString
</span
	  ><a href="#local-6989586621682074044"
	  ><span class="hs-identifier hs-var"
	    >b</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; Encoding
forall a. Flat a =&gt; a -&gt; Encoding
</span
	><a href="../../plutus-core/src/PlutusCore.Flat.Class.html#encode"
	><span class="hs-identifier hs-var"
	  >Flat.encode</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString
</span
	><a href="#local-6989586621682074044"
	><span class="hs-identifier hs-var"
	  >b</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-88"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="../../plutus-core/src/PlutusCore.Flat.Class.html#encode"
	><span class="hs-pragma hs-type"
	  >encode</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-89"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621682074054"
      ><span class="annot"
	><span class="annottext"
	  >decode :: Get K
</span
	  ><a href="#local-6989586621682074054"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >decode</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-keyword"
      >do</span
      ><span
      >
</span
      ><span id="line-90"
      ></span
      ><span
      >    </span
      ><span id="local-6989586621682074056"
      ><span class="annot"
	><span class="annottext"
	  >ByteString
</span
	  ><a href="#local-6989586621682074056"
	  ><span class="hs-identifier hs-var"
	    >b</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >&lt;-</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Get ByteString
forall a. Flat a =&gt; Get a
</span
	><a href="../../plutus-core/src/PlutusCore.Flat.Class.html#decode"
	><span class="hs-identifier hs-var"
	  >Flat.decode</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-91"
      ></span
      ><span
      >    </span
      ><span class="annot"
      ><span class="annottext"
	>Get K -&gt; (K -&gt; Get K) -&gt; Maybe K -&gt; Get K
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Maybe.html#maybe"
	><span class="hs-identifier hs-var"
	  >maybe</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; Get K
forall a. String -&gt; Get a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(String -&gt; Get K) -&gt; String -&gt; Get K
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;Invalid Value key: &quot;</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%3C%3E"
	><span class="hs-operator hs-var"
	  >&lt;&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[Word8] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Show.html#show"
	><span class="hs-identifier hs-var"
	  >show</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; [Word8]
</span
	><a href="https://hackage.haskell.org/package/bytestring-0.11.5.4/docs/src/Data.ByteString.html#unpack"
	><span class="hs-identifier hs-var"
	  >B.unpack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString
</span
	><a href="#local-6989586621682074056"
	><span class="hs-identifier hs-var"
	  >b</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K -&gt; Get K
forall a. a -&gt; Get a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#pure"
	><span class="hs-identifier hs-var"
	  >pure</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; Maybe K
</span
	><a href="PlutusCore.Value.html#k"
	><span class="hs-identifier hs-var"
	  >k</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString
</span
	><a href="#local-6989586621682074056"
	><span class="hs-identifier hs-var"
	  >b</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-92"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="../../plutus-core/src/PlutusCore.Flat.Class.html#decode"
	><span class="hs-pragma hs-type"
	  >decode</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-93"
      ></span
      ><span
      >
</span
      ><span id="line-94"
      ></span
      ><span class="hs-keyword"
      >instance</span
      ><span
      > </span
      ><span id="local-6989586621682074063"
      ><span id="local-6989586621682074067"
	><span class="annot"
	  ><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.Class.html#Serialise"
	    ><span class="hs-identifier hs-type"
	      >CBOR.Serialise</span
	      ></a
	    ></span
	  ><span
	  > </span
	  ><span class="annot"
	  ><a href="PlutusCore.Value.html#K"
	    ><span class="hs-identifier hs-type"
	      >K</span
	      ></a
	    ></span
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-95"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621682074072"
      ><span class="annot"
	><span class="annottext"
	  >encode :: K -&gt; Encoding
</span
	  ><a href="#local-6989586621682074072"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >encode</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#UnsafeK"
	><span class="hs-identifier hs-type"
	  >UnsafeK</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074074"
      ><span class="annot"
	><span class="annottext"
	  >ByteString
</span
	  ><a href="#local-6989586621682074074"
	  ><span class="hs-identifier hs-var"
	    >b</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; Encoding
forall a. Serialise a =&gt; a -&gt; Encoding
</span
	><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.Class.html#encode"
	><span class="hs-identifier hs-var"
	  >CBOR.encode</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString
</span
	><a href="#local-6989586621682074074"
	><span class="hs-identifier hs-var"
	  >b</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-96"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.Class.html#encode"
	><span class="hs-pragma hs-type"
	  >encode</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-97"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621682074084"
      ><span class="annot"
	><span class="annottext"
	  >decode :: forall s. Decoder s K
</span
	  ><a href="#local-6989586621682074084"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >decode</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-keyword"
      >do</span
      ><span
      >
</span
      ><span id="line-98"
      ></span
      ><span
      >    </span
      ><span id="local-6989586621682074086"
      ><span class="annot"
	><span class="annottext"
	  >ByteString
</span
	  ><a href="#local-6989586621682074086"
	  ><span class="hs-identifier hs-var"
	    >b</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >&lt;-</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Decoder s ByteString
forall s. Decoder s ByteString
forall a s. Serialise a =&gt; Decoder s a
</span
	><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.Class.html#decode"
	><span class="hs-identifier hs-var"
	  >CBOR.decode</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-99"
      ></span
      ><span
      >    </span
      ><span class="annot"
      ><span class="annottext"
	>Decoder s K -&gt; (K -&gt; Decoder s K) -&gt; Maybe K -&gt; Decoder s K
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Maybe.html#maybe"
	><span class="hs-identifier hs-var"
	  >maybe</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; Decoder s K
forall a. String -&gt; Decoder s a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(String -&gt; Decoder s K) -&gt; String -&gt; Decoder s K
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;Invalid Value key: &quot;</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%3C%3E"
	><span class="hs-operator hs-var"
	  >&lt;&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[Word8] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Show.html#show"
	><span class="hs-identifier hs-var"
	  >show</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; [Word8]
</span
	><a href="https://hackage.haskell.org/package/bytestring-0.11.5.4/docs/src/Data.ByteString.html#unpack"
	><span class="hs-identifier hs-var"
	  >B.unpack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString
</span
	><a href="#local-6989586621682074086"
	><span class="hs-identifier hs-var"
	  >b</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K -&gt; Decoder s K
forall a. a -&gt; Decoder s a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#pure"
	><span class="hs-identifier hs-var"
	  >pure</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; Maybe K
</span
	><a href="PlutusCore.Value.html#k"
	><span class="hs-identifier hs-var"
	  >k</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString
</span
	><a href="#local-6989586621682074086"
	><span class="hs-identifier hs-var"
	  >b</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-100"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.Class.html#decode"
	><span class="hs-pragma hs-type"
	  >decode</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-101"
      ></span
      ><span
      >
</span
      ><span id="line-102"
      ></span
      ><span class="hs-comment"
      >----------------------------------------------------------------------------------------------------</span
      ><span
      >
</span
      ><span id="line-103"
      ></span
      ><span class="hs-comment"
      >-- Quantity: Signed 128-bit Integer ----------------------------------------------------------------</span
      ><span
      >
</span
      ><span id="line-104"
      ></span
      ><span
      >
</span
      ><span id="line-105"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>-- | A signed 128-bit integer quantity.</span
	></span
      ><span
      >
</span
      ><span id="line-106"
      ></span
      ><span class="hs-keyword"
      >newtype</span
      ><span
      > </span
      ><span id="Quantity"
      ><span class="annot"
	><a href="PlutusCore.Value.html#Quantity"
	  ><span class="hs-identifier hs-var"
	    >Quantity</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span id="UnsafeQuantity"
      ><span class="annot"
	><a href="PlutusCore.Value.html#UnsafeQuantity"
	  ><span class="hs-identifier hs-var"
	    >UnsafeQuantity</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >{</span
      ><span id="unQuantity"
      ><span class="annot"
	><span class="annottext"
	  >Quantity -&gt; Integer
</span
	  ><a href="PlutusCore.Value.html#unQuantity"
	  ><span class="hs-identifier hs-var hs-var"
	    >unQuantity</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-bignum-1.3/docs/src/GHC.Num.Integer.html#Integer"
	><span class="hs-identifier hs-type"
	  >Integer</span
	  ></a
	></span
      ><span class="hs-special"
      >}</span
      ><span
      >
</span
      ><span id="line-107"
      ></span
      ><span
      >  </span
      ><span class="hs-keyword"
      >deriving</span
      ><span
      > </span
      ><span class="annot"
      ><span class="hs-keyword"
	>newtype</span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074089"
      ><span id="local-6989586621682074093"
	><span class="annot"
	  ><span class="annottext"
	    >Quantity -&gt; Quantity -&gt; Bool
(Quantity -&gt; Quantity -&gt; Bool)
-&gt; (Quantity -&gt; Quantity -&gt; Bool) -&gt; Eq Quantity
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Quantity -&gt; Quantity -&gt; Bool
== :: Quantity -&gt; Quantity -&gt; Bool
$c/= :: Quantity -&gt; Quantity -&gt; Bool
/= :: Quantity -&gt; Quantity -&gt; Bool
</span
	    ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#Eq"
	    ><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var"
	      >Eq</span
	      ></a
	    ></span
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074099"
      ><span id="local-6989586621682074103"
	><span id="local-6989586621682074107"
	  ><span id="local-6989586621682074111"
	    ><span id="local-6989586621682074115"
	      ><span id="local-6989586621682074119"
		><span id="local-6989586621682074123"
		  ><span class="annot"
		    ><span class="annottext"
		      >Eq Quantity
Eq Quantity =&gt;
(Quantity -&gt; Quantity -&gt; Ordering)
-&gt; (Quantity -&gt; Quantity -&gt; Bool)
-&gt; (Quantity -&gt; Quantity -&gt; Bool)
-&gt; (Quantity -&gt; Quantity -&gt; Bool)
-&gt; (Quantity -&gt; Quantity -&gt; Bool)
-&gt; (Quantity -&gt; Quantity -&gt; Quantity)
-&gt; (Quantity -&gt; Quantity -&gt; Quantity)
-&gt; Ord Quantity
Quantity -&gt; Quantity -&gt; Bool
Quantity -&gt; Quantity -&gt; Ordering
Quantity -&gt; Quantity -&gt; Quantity
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Quantity -&gt; Quantity -&gt; Ordering
compare :: Quantity -&gt; Quantity -&gt; Ordering
$c&lt; :: Quantity -&gt; Quantity -&gt; Bool
&lt; :: Quantity -&gt; Quantity -&gt; Bool
$c&lt;= :: Quantity -&gt; Quantity -&gt; Bool
&lt;= :: Quantity -&gt; Quantity -&gt; Bool
$c&gt; :: Quantity -&gt; Quantity -&gt; Bool
&gt; :: Quantity -&gt; Quantity -&gt; Bool
$c&gt;= :: Quantity -&gt; Quantity -&gt; Bool
&gt;= :: Quantity -&gt; Quantity -&gt; Bool
$cmax :: Quantity -&gt; Quantity -&gt; Quantity
max :: Quantity -&gt; Quantity -&gt; Quantity
$cmin :: Quantity -&gt; Quantity -&gt; Quantity
min :: Quantity -&gt; Quantity -&gt; Quantity
</span
		      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#Ord"
		      ><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var"
			>Ord</span
			></a
		      ></span
		    ></span
		  ></span
		></span
	      ></span
	    ></span
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074127"
      ><span id="local-6989586621682074131"
	><span id="local-6989586621682074135"
	  ><span class="annot"
	    ><span class="annottext"
	      >Int -&gt; Quantity -&gt; ShowS
[Quantity] -&gt; ShowS
Quantity -&gt; String
(Int -&gt; Quantity -&gt; ShowS)
-&gt; (Quantity -&gt; String) -&gt; ([Quantity] -&gt; ShowS) -&gt; Show Quantity
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Quantity -&gt; ShowS
showsPrec :: Int -&gt; Quantity -&gt; ShowS
$cshow :: Quantity -&gt; String
show :: Quantity -&gt; String
$cshowList :: [Quantity] -&gt; ShowS
showList :: [Quantity] -&gt; ShowS
</span
	      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Show.html#Show"
	      ><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var"
		>Show</span
		></a
	      ></span
	    ></span
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074140"
      ><span class="annot"
	><span class="annottext"
	  >Quantity -&gt; ()
(Quantity -&gt; ()) -&gt; NFData Quantity
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: Quantity -&gt; ()
rnf :: Quantity -&gt; ()
</span
	  ><a href="https://hackage.haskell.org/package/deepseq-1.4.8.1/docs/src/Control.DeepSeq.html#NFData"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >NFData</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074148"
      ><span id="local-6989586621682074153"
	><span class="annot"
	  ><span class="annottext"
	    >Eq Quantity
Eq Quantity =&gt;
(Int -&gt; Quantity -&gt; Int) -&gt; (Quantity -&gt; Int) -&gt; Hashable Quantity
Int -&gt; Quantity -&gt; Int
Quantity -&gt; Int
forall a. Eq a =&gt; (Int -&gt; a -&gt; Int) -&gt; (a -&gt; Int) -&gt; Hashable a
$chashWithSalt :: Int -&gt; Quantity -&gt; Int
hashWithSalt :: Int -&gt; Quantity -&gt; Int
$chash :: Quantity -&gt; Int
hash :: Quantity -&gt; Int
</span
	    ><a href="https://hackage.haskell.org/package/hashable-1.5.1.0/docs/src/Data.Hashable.Class.html#Hashable"
	    ><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var"
	      >Hashable</span
	      ></a
	    ></span
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-108"
      ></span
      ><span
      >  </span
      ><span class="hs-keyword"
      >deriving</span
      ><span
      > </span
      ><span class="annot"
      ><span class="hs-keyword"
	>stock</span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074158"
      ><span id="local-6989586621682074160"
	><span class="annot"
	  ><span class="annottext"
	    >(forall x. Quantity -&gt; Rep Quantity x)
-&gt; (forall x. Rep Quantity x -&gt; Quantity) -&gt; Generic Quantity
forall x. Rep Quantity x -&gt; Quantity
forall x. Quantity -&gt; Rep Quantity x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. Quantity -&gt; Rep Quantity x
from :: forall x. Quantity -&gt; Rep Quantity x
$cto :: forall x. Rep Quantity x -&gt; Quantity
to :: forall x. Rep Quantity x -&gt; Quantity
</span
	    ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Generics.html#Generic"
	    ><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var"
	      >Generic</span
	      ></a
	    ></span
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-109"
      ></span
      ><span
      >
</span
      ><span id="line-110"
      ></span
      ><span class="hs-keyword"
      >instance</span
      ><span
      > </span
      ><span id="local-6989586621682074165"
      ><span id="local-6989586621682074169"
	><span class="annot"
	  ><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.Class.html#Serialise"
	    ><span class="hs-identifier hs-type"
	      >CBOR.Serialise</span
	      ></a
	    ></span
	  ><span
	  > </span
	  ><span class="annot"
	  ><a href="PlutusCore.Value.html#Quantity"
	    ><span class="hs-identifier hs-type"
	      >Quantity</span
	      ></a
	    ></span
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-111"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621682074173"
      ><span class="annot"
	><span class="annottext"
	  >encode :: Quantity -&gt; Encoding
</span
	  ><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.Class.html#encode"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >encode</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#UnsafeQuantity"
	><span class="hs-identifier hs-type"
	  >UnsafeQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074174"
      ><span class="annot"
	><span class="annottext"
	  >Integer
</span
	  ><a href="#local-6989586621682074174"
	  ><span class="hs-identifier hs-var"
	    >i</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Encoding
forall a. Serialise a =&gt; a -&gt; Encoding
</span
	><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.Class.html#encode"
	><span class="hs-identifier hs-var"
	  >CBOR.encode</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074174"
	><span class="hs-identifier hs-var"
	  >i</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-112"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.Class.html#encode"
	><span class="hs-pragma hs-type"
	  >encode</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-113"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621682074181"
      ><span class="annot"
	><span class="annottext"
	  >decode :: forall s. Decoder s Quantity
</span
	  ><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.Class.html#decode"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >decode</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-keyword"
      >do</span
      ><span
      >
</span
      ><span id="line-114"
      ></span
      ><span
      >    </span
      ><span id="local-6989586621682074182"
      ><span class="annot"
	><span class="annottext"
	  >Integer
</span
	  ><a href="#local-6989586621682074182"
	  ><span class="hs-identifier hs-var"
	    >i</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >&lt;-</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Decoder s Integer
forall s. Decoder s Integer
forall a s. Serialise a =&gt; Decoder s a
</span
	><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.Class.html#decode"
	><span class="hs-identifier hs-var"
	  >CBOR.decode</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-115"
      ></span
      ><span
      >    </span
      ><span class="hs-keyword"
      >case</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Maybe Quantity
</span
	><a href="PlutusCore.Value.html#quantity"
	><span class="hs-identifier hs-var"
	  >quantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074182"
	><span class="hs-identifier hs-var"
	  >i</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >of</span
      ><span
      >
</span
      ><span id="line-116"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-type"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074183"
      ><span class="annot"
	><span class="annottext"
	  >Quantity
</span
	  ><a href="#local-6989586621682074183"
	  ><span class="hs-identifier hs-var"
	    >q</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Decoder s Quantity
forall a. a -&gt; Decoder s a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#pure"
	><span class="hs-identifier hs-var"
	  >pure</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074183"
	><span class="hs-identifier hs-var"
	  >q</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-117"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe Quantity
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; Decoder s Quantity
forall a. String -&gt; Decoder s a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(String -&gt; Decoder s Quantity) -&gt; String -&gt; Decoder s Quantity
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;Quantity out of signed 128-bit integer bounds: &quot;</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%3C%3E"
	><span class="hs-operator hs-var"
	  >&lt;&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Show.html#show"
	><span class="hs-identifier hs-var"
	  >show</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074182"
	><span class="hs-identifier hs-var"
	  >i</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-118"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.Class.html#decode"
	><span class="hs-pragma hs-type"
	  >decode</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-119"
      ></span
      ><span
      >
</span
      ><span id="line-120"
      ></span
      ><span class="hs-keyword"
      >instance</span
      ><span
      > </span
      ><span id="local-6989586621682074187"
      ><span class="annot"
	><a href="../../plutus-core/src/PlutusCore.Flat.Class.html#Flat"
	  ><span class="hs-identifier hs-type"
	    >Flat.Flat</span
	    ></a
	  ></span
	><span
	> </span
	><span class="annot"
	><a href="PlutusCore.Value.html#Quantity"
	  ><span class="hs-identifier hs-type"
	    >Quantity</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-121"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621682074199"
      ><span class="annot"
	><span class="annottext"
	  >encode :: Quantity -&gt; Encoding
</span
	  ><a href="../../plutus-core/src/PlutusCore.Flat.Class.html#encode"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >encode</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#UnsafeQuantity"
	><span class="hs-identifier hs-type"
	  >UnsafeQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074200"
      ><span class="annot"
	><span class="annottext"
	  >Integer
</span
	  ><a href="#local-6989586621682074200"
	  ><span class="hs-identifier hs-var"
	    >i</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Encoding
forall a. Flat a =&gt; a -&gt; Encoding
</span
	><a href="../../plutus-core/src/PlutusCore.Flat.Class.html#encode"
	><span class="hs-identifier hs-var"
	  >Flat.encode</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074200"
	><span class="hs-identifier hs-var"
	  >i</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-122"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="../../plutus-core/src/PlutusCore.Flat.Class.html#encode"
	><span class="hs-pragma hs-type"
	  >encode</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-123"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621682074207"
      ><span class="annot"
	><span class="annottext"
	  >decode :: Get Quantity
</span
	  ><a href="../../plutus-core/src/PlutusCore.Flat.Class.html#decode"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >decode</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-keyword"
      >do</span
      ><span
      >
</span
      ><span id="line-124"
      ></span
      ><span
      >    </span
      ><span id="local-6989586621682074208"
      ><span class="annot"
	><span class="annottext"
	  >Integer
</span
	  ><a href="#local-6989586621682074208"
	  ><span class="hs-identifier hs-var"
	    >i</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >&lt;-</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Get Integer
forall a. Flat a =&gt; Get a
</span
	><a href="../../plutus-core/src/PlutusCore.Flat.Class.html#decode"
	><span class="hs-identifier hs-var"
	  >Flat.decode</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-125"
      ></span
      ><span
      >    </span
      ><span class="hs-keyword"
      >case</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Maybe Quantity
</span
	><a href="PlutusCore.Value.html#quantity"
	><span class="hs-identifier hs-var"
	  >quantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074208"
	><span class="hs-identifier hs-var"
	  >i</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >of</span
      ><span
      >
</span
      ><span id="line-126"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-type"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074209"
      ><span class="annot"
	><span class="annottext"
	  >Quantity
</span
	  ><a href="#local-6989586621682074209"
	  ><span class="hs-identifier hs-var"
	    >q</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Get Quantity
forall a. a -&gt; Get a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#pure"
	><span class="hs-identifier hs-var"
	  >pure</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074209"
	><span class="hs-identifier hs-var"
	  >q</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-127"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe Quantity
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; Get Quantity
forall a. String -&gt; Get a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(String -&gt; Get Quantity) -&gt; String -&gt; Get Quantity
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;Quantity out of signed 128-bit integer bounds: &quot;</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%3C%3E"
	><span class="hs-operator hs-var"
	  >&lt;&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Show.html#show"
	><span class="hs-identifier hs-var"
	  >show</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074208"
	><span class="hs-identifier hs-var"
	  >i</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-128"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="../../plutus-core/src/PlutusCore.Flat.Class.html#decode"
	><span class="hs-pragma hs-type"
	  >decode</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-129"
      ></span
      ><span
      >
</span
      ><span id="line-130"
      ></span
      ><span class="hs-keyword"
      >instance</span
      ><span
      > </span
      ><span id="local-6989586621682074212"
      ><span class="annot"
	><a href="https://hackage.haskell.org/package/prettyprinter-1.7.1/docs/src/Prettyprinter.Internal.html#Pretty"
	  ><span class="hs-identifier hs-type"
	    >Pretty</span
	    ></a
	  ></span
	><span
	> </span
	><span class="annot"
	><a href="PlutusCore.Value.html#Quantity"
	  ><span class="hs-identifier hs-type"
	    >Quantity</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-131"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621682074218"
      ><span class="annot"
	><span class="annottext"
	  >pretty :: forall ann. Quantity -&gt; Doc ann
</span
	  ><a href="#local-6989586621682074218"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >pretty</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#UnsafeQuantity"
	><span class="hs-identifier hs-type"
	  >UnsafeQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074220"
      ><span class="annot"
	><span class="annottext"
	  >Integer
</span
	  ><a href="#local-6989586621682074220"
	  ><span class="hs-identifier hs-var"
	    >i</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Doc ann
forall ann. Integer -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span
	><a href="https://hackage.haskell.org/package/prettyprinter-1.7.1/docs/src/Prettyprinter.Internal.html#pretty"
	><span class="hs-identifier hs-var"
	  >pretty</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074220"
	><span class="hs-identifier hs-var"
	  >i</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-132"
      ></span
      ><span
      >
</span
      ><span id="line-133"
      ></span
      ><span class="hs-keyword"
      >instance</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Enum.html#Bounded"
	><span class="hs-identifier hs-type"
	  >Bounded</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-134"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621682074229"
      ><span class="annot"
	><span class="annottext"
	  >minBound :: Quantity
</span
	  ><a href="#local-6989586621682074229"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >minBound</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Quantity
</span
	><a href="PlutusCore.Value.html#UnsafeQuantity"
	><span class="hs-identifier hs-var"
	  >UnsafeQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="hs-glyph"
      >-</span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><span class="hs-number"
	>2</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Integer -&gt; Integer
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Real.html#%5E"
	><span class="hs-operator hs-var"
	  >^</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><span class="hs-number"
	>127</span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-bignum-1.3/docs/src/GHC.Num.Integer.html#Integer"
	><span class="hs-identifier hs-type"
	  >Integer</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-135"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Enum.html#minBound"
	><span class="hs-pragma hs-type"
	  >minBound</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-136"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621682074237"
      ><span class="annot"
	><span class="annottext"
	  >maxBound :: Quantity
</span
	  ><a href="#local-6989586621682074237"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >maxBound</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Quantity
</span
	><a href="PlutusCore.Value.html#UnsafeQuantity"
	><span class="hs-identifier hs-var"
	  >UnsafeQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><span class="hs-number"
	>2</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Integer -&gt; Integer
forall a b. (Num a, Integral b) =&gt; a -&gt; b -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Real.html#%5E"
	><span class="hs-operator hs-var"
	  >^</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><span class="hs-number"
	>127</span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-bignum-1.3/docs/src/GHC.Num.Integer.html#Integer"
	><span class="hs-identifier hs-type"
	  >Integer</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#-"
	><span class="hs-glyph hs-var"
	  >-</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><span class="hs-number"
	>1</span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-137"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Enum.html#maxBound"
	><span class="hs-pragma hs-type"
	  >maxBound</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-138"
      ></span
      ><span
      >
</span
      ><span id="line-139"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>-- | Smart constructor for Quantity that validates bounds.</span
	></span
      ><span
      >
</span
      ><span id="line-140"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#quantity"
	><span class="hs-identifier hs-type"
	  >quantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-bignum-1.3/docs/src/GHC.Num.Integer.html#Integer"
	><span class="hs-identifier hs-type"
	  >Integer</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Maybe"
	><span class="hs-identifier hs-type"
	  >Maybe</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-141"
      ></span
      ><span id="quantity"
      ><span class="annot"
	><span class="annottext"
	  >quantity :: Integer -&gt; Maybe Quantity
</span
	  ><a href="PlutusCore.Value.html#quantity"
	  ><span class="hs-identifier hs-var hs-var"
	    >quantity</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074239"
      ><span class="annot"
	><span class="annottext"
	  >Integer
</span
	  ><a href="#local-6989586621682074239"
	  ><span class="hs-identifier hs-var"
	    >i</span
	    ></a
	  ></span
	></span
      ><span
      >
</span
      ><span id="line-142"
      ></span
      ><span
      >  </span
      ><span class="hs-glyph"
      >|</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074239"
	><span class="hs-identifier hs-var"
	  >i</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3E%3D"
	><span class="hs-operator hs-var"
	  >&gt;=</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Integer
</span
	><a href="PlutusCore.Value.html#unQuantity"
	><span class="hs-identifier hs-var"
	  >unQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
forall a. Bounded a =&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Enum.html#minBound"
	><span class="hs-identifier hs-var"
	  >minBound</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Bool -&gt; Bool -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%26%26"
	><span class="hs-operator hs-var"
	  >&amp;&amp;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074239"
	><span class="hs-identifier hs-var"
	  >i</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3C%3D"
	><span class="hs-operator hs-var"
	  >&lt;=</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Integer
</span
	><a href="PlutusCore.Value.html#unQuantity"
	><span class="hs-identifier hs-var"
	  >unQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
forall a. Bounded a =&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Enum.html#maxBound"
	><span class="hs-identifier hs-var"
	  >maxBound</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Maybe Quantity
forall a. a -&gt; Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-var"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Quantity
</span
	><a href="PlutusCore.Value.html#UnsafeQuantity"
	><span class="hs-identifier hs-var"
	  >UnsafeQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074239"
	><span class="hs-identifier hs-var"
	  >i</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-143"
      ></span
      ><span
      >  </span
      ><span class="hs-glyph"
      >|</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Bool
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#otherwise"
	><span class="hs-identifier hs-var"
	  >otherwise</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe Quantity
forall a. Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-144"
      ></span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#quantity"
	><span class="hs-pragma hs-type"
	  >quantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-145"
      ></span
      ><span
      >
</span
      ><span id="line-146"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>-- | The zero quantity.</span
	></span
      ><span
      >
</span
      ><span id="line-147"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#zeroQuantity"
	><span class="hs-identifier hs-type"
	  >zeroQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-148"
      ></span
      ><span id="zeroQuantity"
      ><span class="annot"
	><span class="annottext"
	  >zeroQuantity :: Quantity
</span
	  ><a href="PlutusCore.Value.html#zeroQuantity"
	  ><span class="hs-identifier hs-var hs-var"
	    >zeroQuantity</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Quantity
</span
	><a href="PlutusCore.Value.html#UnsafeQuantity"
	><span class="hs-identifier hs-var"
	  >UnsafeQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><span class="hs-number"
	>0</span
	></span
      ><span
      >
</span
      ><span id="line-149"
      ></span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#zeroQuantity"
	><span class="hs-pragma hs-type"
	  >zeroQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-150"
      ></span
      ><span
      >
</span
      ><span id="line-151"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>-- | Safely add two quantities, checking for overflow.</span
	></span
      ><span
      >
</span
      ><span id="line-152"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#addQuantity"
	><span class="hs-identifier hs-type"
	  >addQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Maybe"
	><span class="hs-identifier hs-type"
	  >Maybe</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-153"
      ></span
      ><span id="addQuantity"
      ><span class="annot"
	><span class="annottext"
	  >addQuantity :: Quantity -&gt; Quantity -&gt; Maybe Quantity
</span
	  ><a href="PlutusCore.Value.html#addQuantity"
	  ><span class="hs-identifier hs-var hs-var"
	    >addQuantity</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#UnsafeQuantity"
	><span class="hs-identifier hs-type"
	  >UnsafeQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074241"
      ><span class="annot"
	><span class="annottext"
	  >Integer
</span
	  ><a href="#local-6989586621682074241"
	  ><span class="hs-identifier hs-var"
	    >x</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#UnsafeQuantity"
	><span class="hs-identifier hs-type"
	  >UnsafeQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074242"
      ><span class="annot"
	><span class="annottext"
	  >Integer
</span
	  ><a href="#local-6989586621682074242"
	  ><span class="hs-identifier hs-var"
	    >y</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Maybe Quantity
</span
	><a href="PlutusCore.Value.html#quantity"
	><span class="hs-identifier hs-var"
	  >quantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074241"
	><span class="hs-identifier hs-var"
	  >x</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#%2B"
	><span class="hs-operator hs-var"
	  >+</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074242"
	><span class="hs-identifier hs-var"
	  >y</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-154"
      ></span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#addQuantity"
	><span class="hs-pragma hs-type"
	  >addQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-155"
      ></span
      ><span
      >
</span
      ><span id="line-156"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>-- | Safely scale a quantity with given integer, checking for overflow.</span
	></span
      ><span
      >
</span
      ><span id="line-157"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#scaleQuantity"
	><span class="hs-identifier hs-type"
	  >scaleQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-bignum-1.3/docs/src/GHC.Num.Integer.html#Integer"
	><span class="hs-identifier hs-type"
	  >Integer</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Maybe"
	><span class="hs-identifier hs-type"
	  >Maybe</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-158"
      ></span
      ><span id="scaleQuantity"
      ><span class="annot"
	><span class="annottext"
	  >scaleQuantity :: Integer -&gt; Quantity -&gt; Maybe Quantity
</span
	  ><a href="PlutusCore.Value.html#scaleQuantity"
	  ><span class="hs-identifier hs-var hs-var"
	    >scaleQuantity</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074245"
      ><span class="annot"
	><span class="annottext"
	  >Integer
</span
	  ><a href="#local-6989586621682074245"
	  ><span class="hs-identifier hs-var"
	    >x</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#UnsafeQuantity"
	><span class="hs-identifier hs-type"
	  >UnsafeQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074246"
      ><span class="annot"
	><span class="annottext"
	  >Integer
</span
	  ><a href="#local-6989586621682074246"
	  ><span class="hs-identifier hs-var"
	    >y</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Maybe Quantity
</span
	><a href="PlutusCore.Value.html#quantity"
	><span class="hs-identifier hs-var"
	  >quantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074245"
	><span class="hs-identifier hs-var"
	  >x</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#%2A"
	><span class="hs-operator hs-var"
	  >*</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074246"
	><span class="hs-identifier hs-var"
	  >y</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-159"
      ></span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#scaleQuantity"
	><span class="hs-pragma hs-type"
	  >scaleQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-160"
      ></span
      ><span
      >
</span
      ><span id="line-161"
      ></span
      ><span class="hs-comment"
      >----------------------------------------------------------------------------------------------------</span
      ><span
      >
</span
      ><span id="line-162"
      ></span
      ><span class="hs-comment"
      >-- Builtin Value definition ------------------------------------------------------------------------</span
      ><span
      >
</span
      ><span id="line-163"
      ></span
      ><span
      >
</span
      ><span id="line-164"
      ></span
      ><span class="hs-keyword"
      >type</span
      ><span
      > </span
      ><span id="NestedMap"
      ><span class="annot"
	><a href="PlutusCore.Value.html#NestedMap"
	  ><span class="hs-identifier hs-var"
	    >NestedMap</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#Map"
	><span class="hs-identifier hs-type"
	  >Map</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier hs-type"
	  >K</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#Map"
	><span class="hs-identifier hs-type"
	  >Map</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier hs-type"
	  >K</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-165"
      ></span
      ><span
      >
</span
      ><span id="line-166"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>-- | The underlying type of the UPLC built-in type @Value@.</span
	></span
      ><span
      >
</span
      ><span id="line-167"
      ></span
      ><span class="hs-keyword"
      >data</span
      ><span
      > </span
      ><span id="Value"
      ><span class="annot"
	><a href="PlutusCore.Value.html#Value"
	  ><span class="hs-identifier hs-var"
	    >Value</span
	    ></a
	  ></span
	></span
      ><span
      >
</span
      ><span id="line-168"
      ></span
      ><span
      >  </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span id="Value"
      ><span class="annot"
	><a href="PlutusCore.Value.html#Value"
	  ><span class="hs-identifier hs-var"
	    >Value</span
	    ></a
	  ></span
	></span
      ><span
      >
</span
      ><span id="line-169"
      ></span
      ><span
      >      </span
      ><span class="hs-glyph"
      >!</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#NestedMap"
	><span class="hs-identifier hs-type"
	  >NestedMap</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-170"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><span class="hs-comment"
	>{-^ Map from (currency symbol, token name) to quantity.

      Invariants: no empty inner map, and no zero quantity. -}</span
	></span
      ><span
      >
</span
      ><span id="line-173"
      ></span
      ><span
      >      </span
      ><span class="hs-glyph"
      >!</span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.IntMap.Internal.html#IntMap"
	><span class="hs-identifier hs-type"
	  >IntMap</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-174"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><span class="hs-comment"
	>{-^ Map from size to the number of inner maps that have that size.
      This allows efficient retrieval of the size of the largest inner map,
      which is useful for costing of operations like `lookupCoin`.

      Invariant: all values are positive. -}</span
	></span
      ><span
      >
</span
      ><span id="line-179"
      ></span
      ><span
      >      </span
      ><span class="hs-pragma"
      >{-# UNPACK</span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      > </span
      ><span class="hs-glyph"
      >!</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-180"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><span class="hs-comment"
	>{-^ Total size, i.e., sum total of inner map sizes. This avoids recomputing
      the total size during the costing of operations like `unionValue`. -}</span
	></span
      ><span
      >
</span
      ><span id="line-182"
      ></span
      ><span
      >      </span
      ><span class="hs-pragma"
      >{-# UNPACK</span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      > </span
      ><span class="hs-glyph"
      >!</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-183"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><span class="hs-comment"
	>-- ^ The number of negative amounts it contains.</span
	></span
      ><span
      >
</span
      ><span id="line-184"
      ></span
      ><span
      >  </span
      ><span class="hs-keyword"
      >deriving</span
      ><span
      > </span
      ><span class="annot"
      ><span class="hs-keyword"
	>stock</span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074250"
      ><span id="local-6989586621682074260"
	><span class="annot"
	  ><span class="annottext"
	    >Value -&gt; Value -&gt; Bool
(Value -&gt; Value -&gt; Bool) -&gt; (Value -&gt; Value -&gt; Bool) -&gt; Eq Value
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Value -&gt; Value -&gt; Bool
== :: Value -&gt; Value -&gt; Bool
$c/= :: Value -&gt; Value -&gt; Bool
/= :: Value -&gt; Value -&gt; Bool
</span
	    ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#Eq"
	    ><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var"
	      >Eq</span
	      ></a
	    ></span
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074264"
      ><span id="local-6989586621682074275"
	><span id="local-6989586621682074279"
	  ><span class="annot"
	    ><span class="annottext"
	      >Int -&gt; Value -&gt; ShowS
[Value] -&gt; ShowS
Value -&gt; String
(Int -&gt; Value -&gt; ShowS)
-&gt; (Value -&gt; String) -&gt; ([Value] -&gt; ShowS) -&gt; Show Value
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Value -&gt; ShowS
showsPrec :: Int -&gt; Value -&gt; ShowS
$cshow :: Value -&gt; String
show :: Value -&gt; String
$cshowList :: [Value] -&gt; ShowS
showList :: [Value] -&gt; ShowS
</span
	      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Show.html#Show"
	      ><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var"
		>Show</span
		></a
	      ></span
	    ></span
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074283"
      ><span id="local-6989586621682074285"
	><span class="annot"
	  ><span class="annottext"
	    >(forall x. Value -&gt; Rep Value x)
-&gt; (forall x. Rep Value x -&gt; Value) -&gt; Generic Value
forall x. Rep Value x -&gt; Value
forall x. Value -&gt; Rep Value x
forall a.
(forall x. a -&gt; Rep a x) -&gt; (forall x. Rep a x -&gt; a) -&gt; Generic a
$cfrom :: forall x. Value -&gt; Rep Value x
from :: forall x. Value -&gt; Rep Value x
$cto :: forall x. Rep Value x -&gt; Value
to :: forall x. Rep Value x -&gt; Value
</span
	    ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Generics.html#Generic"
	    ><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var"
	      >Generic</span
	      ></a
	    ></span
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-185"
      ></span
      ><span
      >  </span
      ><span class="hs-keyword"
      >deriving</span
      ><span
      > </span
      ><span class="annot"
      ><span class="hs-keyword"
	>anyclass</span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074288"
      ><span class="annot"
	><span class="annottext"
	  >Value -&gt; ()
(Value -&gt; ()) -&gt; NFData Value
forall a. (a -&gt; ()) -&gt; NFData a
$crnf :: Value -&gt; ()
rnf :: Value -&gt; ()
</span
	  ><a href="https://hackage.haskell.org/package/deepseq-1.4.8.1/docs/src/Control.DeepSeq.html#NFData"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >NFData</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-186"
      ></span
      ><span
      >
</span
      ><span id="line-187"
      ></span
      ><span class="hs-keyword"
      >instance</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/hashable-1.5.1.0/docs/src/Data.Hashable.Class.html#Hashable"
	><span class="hs-identifier hs-type"
	  >Hashable</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-188"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621682074327"
      ><span class="annot"
	><span class="annottext"
	  >hash :: Value -&gt; Int
</span
	  ><a href="#local-6989586621682074327"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >hash</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; Int
forall a. Hashable a =&gt; a -&gt; Int
</span
	><a href="https://hackage.haskell.org/package/hashable-1.5.1.0/docs/src/Data.Hashable.Class.html#hash"
	><span class="hs-identifier hs-var"
	  >hash</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(NestedMap -&gt; Int) -&gt; (Value -&gt; NestedMap) -&gt; Value -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; NestedMap
</span
	><a href="PlutusCore.Value.html#unpack"
	><span class="hs-identifier hs-var"
	  >unpack</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-189"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/hashable-1.5.1.0/docs/src/Data.Hashable.Class.html#hash"
	><span class="hs-pragma hs-type"
	  >hash</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-190"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621682074334"
      ><span class="annot"
	><span class="annottext"
	  >hashWithSalt :: Int -&gt; Value -&gt; Int
</span
	  ><a href="#local-6989586621682074334"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >hashWithSalt</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074336"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074336"
	  ><span class="hs-identifier hs-var"
	    >salt</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; NestedMap -&gt; Int
forall a. Hashable a =&gt; Int -&gt; a -&gt; Int
</span
	><a href="https://hackage.haskell.org/package/hashable-1.5.1.0/docs/src/Data.Hashable.Class.html#hashWithSalt"
	><span class="hs-identifier hs-var"
	  >hashWithSalt</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074336"
	><span class="hs-identifier hs-var"
	  >salt</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(NestedMap -&gt; Int) -&gt; (Value -&gt; NestedMap) -&gt; Value -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; NestedMap
</span
	><a href="PlutusCore.Value.html#unpack"
	><span class="hs-identifier hs-var"
	  >unpack</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-191"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/hashable-1.5.1.0/docs/src/Data.Hashable.Class.html#hashWithSalt"
	><span class="hs-pragma hs-type"
	  >hashWithSalt</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-192"
      ></span
      ><span
      >
</span
      ><span id="line-193"
      ></span
      ><span class="hs-keyword"
      >instance</span
      ><span
      > </span
      ><span id="local-6989586621682074340"
      ><span id="local-6989586621682074344"
	><span class="annot"
	  ><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.Class.html#Serialise"
	    ><span class="hs-identifier hs-type"
	      >CBOR.Serialise</span
	      ></a
	    ></span
	  ><span
	  > </span
	  ><span class="annot"
	  ><a href="PlutusCore.Value.html#Value"
	    ><span class="hs-identifier hs-type"
	      >Value</span
	      ></a
	    ></span
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-194"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621682074351"
      ><span class="annot"
	><span class="annottext"
	  >encode :: Value -&gt; Encoding
</span
	  ><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.Class.html#encode"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >encode</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074352"
      ><span class="annot"
	><span class="annottext"
	  >NestedMap
</span
	  ><a href="#local-6989586621682074352"
	  ><span class="hs-identifier hs-var"
	    >v</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; Encoding
forall a. Serialise a =&gt; a -&gt; Encoding
</span
	><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.Class.html#encode"
	><span class="hs-identifier hs-var"
	  >CBOR.encode</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074352"
	><span class="hs-identifier hs-var"
	  >v</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-195"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.Class.html#encode"
	><span class="hs-pragma hs-type"
	  >encode</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-196"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621682074359"
      ><span class="annot"
	><span class="annottext"
	  >decode :: forall s. Decoder s Value
</span
	  ><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.Class.html#decode"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >decode</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; Value
</span
	><a href="PlutusCore.Value.html#pack"
	><span class="hs-identifier hs-var"
	  >pack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(NestedMap -&gt; Value) -&gt; Decoder s NestedMap -&gt; Decoder s Value
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Functor.html#%3C%24%3E"
	><span class="hs-operator hs-var"
	  >&lt;$&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Decoder s NestedMap
forall s. Decoder s NestedMap
forall a s. Serialise a =&gt; Decoder s a
</span
	><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.Class.html#decode"
	><span class="hs-identifier hs-var"
	  >CBOR.decode</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-197"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/serialise-0.2.6.1/docs/src/Codec.Serialise.Class.html#decode"
	><span class="hs-pragma hs-type"
	  >decode</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-198"
      ></span
      ><span
      >
</span
      ><span id="line-199"
      ></span
      ><span class="hs-keyword"
      >instance</span
      ><span
      > </span
      ><span id="local-6989586621682074364"
      ><span class="annot"
	><a href="../../plutus-core/src/PlutusCore.Flat.Class.html#Flat"
	  ><span class="hs-identifier hs-type"
	    >Flat.Flat</span
	    ></a
	  ></span
	><span
	> </span
	><span class="annot"
	><a href="PlutusCore.Value.html#Value"
	  ><span class="hs-identifier hs-type"
	    >Value</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-200"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621682074395"
      ><span class="annot"
	><span class="annottext"
	  >encode :: Value -&gt; Encoding
</span
	  ><a href="../../plutus-core/src/PlutusCore.Flat.Class.html#encode"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >encode</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074396"
      ><span class="annot"
	><span class="annottext"
	  >NestedMap
</span
	  ><a href="#local-6989586621682074396"
	  ><span class="hs-identifier hs-var"
	    >v</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; Encoding
forall a. Flat a =&gt; a -&gt; Encoding
</span
	><a href="../../plutus-core/src/PlutusCore.Flat.Class.html#encode"
	><span class="hs-identifier hs-var"
	  >Flat.encode</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074396"
	><span class="hs-identifier hs-var"
	  >v</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-201"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="../../plutus-core/src/PlutusCore.Flat.Class.html#encode"
	><span class="hs-pragma hs-type"
	  >encode</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-202"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621682074403"
      ><span class="annot"
	><span class="annottext"
	  >decode :: Get Value
</span
	  ><a href="../../plutus-core/src/PlutusCore.Flat.Class.html#decode"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >decode</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; Value
</span
	><a href="PlutusCore.Value.html#pack"
	><span class="hs-identifier hs-var"
	  >pack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(NestedMap -&gt; Value) -&gt; Get NestedMap -&gt; Get Value
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Functor.html#%3C%24%3E"
	><span class="hs-operator hs-var"
	  >&lt;$&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Get NestedMap
forall a. Flat a =&gt; Get a
</span
	><a href="../../plutus-core/src/PlutusCore.Flat.Class.html#decode"
	><span class="hs-identifier hs-var"
	  >Flat.decode</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-203"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="../../plutus-core/src/PlutusCore.Flat.Class.html#decode"
	><span class="hs-pragma hs-type"
	  >decode</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-204"
      ></span
      ><span
      >
</span
      ><span id="line-205"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>{-| Unpack a `Value` into a map from (currency symbol, token name) to quantity.

The map is guaranteed to not contain empty inner map or zero quantity. -}</span
	></span
      ><span
      >
</span
      ><span id="line-208"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#unpack"
	><span class="hs-identifier hs-type"
	  >unpack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#NestedMap"
	><span class="hs-identifier hs-type"
	  >NestedMap</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-209"
      ></span
      ><span id="unpack"
      ><span class="annot"
	><span class="annottext"
	  >unpack :: Value -&gt; NestedMap
</span
	  ><a href="PlutusCore.Value.html#unpack"
	  ><span class="hs-identifier hs-var hs-var"
	    >unpack</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074404"
      ><span class="annot"
	><span class="annottext"
	  >NestedMap
</span
	  ><a href="#local-6989586621682074404"
	  ><span class="hs-identifier hs-var"
	    >v</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074404"
	><span class="hs-identifier hs-var"
	  >v</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-210"
      ></span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#unpack"
	><span class="hs-pragma hs-type"
	  >unpack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-211"
      ></span
      ><span
      >
</span
      ><span id="line-212"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>{-| Pack a map from (currency symbol, token name) to quantity into a `Value`.

The map will be filtered so that it does not contain empty inner map or zero quantity. -}</span
	></span
      ><span
      >
</span
      ><span id="line-215"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#pack"
	><span class="hs-identifier hs-type"
	  >pack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#NestedMap"
	><span class="hs-identifier hs-type"
	  >NestedMap</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-216"
      ></span
      ><span id="pack"
      ><span class="annot"
	><span class="annottext"
	  >pack :: NestedMap -&gt; Value
</span
	  ><a href="PlutusCore.Value.html#pack"
	  ><span class="hs-identifier hs-var hs-var"
	    >pack</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; Value
</span
	><a href="PlutusCore.Value.html#pack%27"
	><span class="hs-identifier hs-var"
	  >pack'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(NestedMap -&gt; Value)
-&gt; (NestedMap -&gt; NestedMap) -&gt; NestedMap -&gt; Value
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; NestedMap
</span
	><a href="PlutusCore.Value.html#normalize"
	><span class="hs-identifier hs-var"
	  >normalize</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-217"
      ></span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#pack"
	><span class="hs-pragma hs-type"
	  >pack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-218"
      ></span
      ><span
      >
</span
      ><span id="line-219"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>-- | Like `pack` but does not normalize.</span
	></span
      ><span
      >
</span
      ><span id="line-220"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#pack%27"
	><span class="hs-identifier hs-type"
	  >pack'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#NestedMap"
	><span class="hs-identifier hs-type"
	  >NestedMap</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-221"
      ></span
      ><span id="pack%27"
      ><span class="annot"
	><span class="annottext"
	  >pack' :: NestedMap -&gt; Value
</span
	  ><a href="PlutusCore.Value.html#pack%27"
	  ><span class="hs-identifier hs-var hs-var"
	    >pack'</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074407"
      ><span class="annot"
	><span class="annottext"
	  >NestedMap
</span
	  ><a href="#local-6989586621682074407"
	  ><span class="hs-identifier hs-var"
	    >v</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; IntMap Int -&gt; Int -&gt; Int -&gt; Value
</span
	><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-var"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074407"
	><span class="hs-identifier hs-var"
	  >v</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int
</span
	><a href="#local-6989586621682074408"
	><span class="hs-identifier hs-var"
	  >sizes</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074409"
	><span class="hs-identifier hs-var"
	  >total</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074410"
	><span class="hs-identifier hs-var"
	  >neg</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-222"
      ></span
      ><span
      >  </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-223"
      ></span
      ><span
      >    </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074408"
      ><span class="annot"
	><span class="annottext"
	  >IntMap Int
</span
	  ><a href="#local-6989586621682074408"
	  ><span class="hs-identifier hs-var"
	    >sizes</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074409"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074409"
	  ><span class="hs-identifier hs-var"
	    >total</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074410"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074410"
	  ><span class="hs-identifier hs-var"
	    >neg</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>((IntMap Int, Int, Int)
 -&gt; Map K Quantity -&gt; (IntMap Int, Int, Int))
-&gt; (IntMap Int, Int, Int) -&gt; NestedMap -&gt; (IntMap Int, Int, Int)
forall a b k. (a -&gt; b -&gt; a) -&gt; a -&gt; Map k b -&gt; a
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#foldl%27"
	><span class="hs-identifier hs-var"
	  >Map.foldl'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(IntMap Int, Int, Int) -&gt; Map K Quantity -&gt; (IntMap Int, Int, Int)
forall {a} {k}.
Num a =&gt;
(IntMap a, Int, Int) -&gt; Map k Quantity -&gt; (IntMap a, Int, Int)
</span
	><a href="#local-6989586621682074414"
	><span class="hs-identifier hs-var"
	  >alg</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int
forall a. Monoid a =&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#mempty"
	><span class="hs-identifier hs-var"
	  >mempty</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>0</span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>0</span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074407"
	><span class="hs-identifier hs-var"
	  >v</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-224"
      ></span
      ><span
      >    </span
      ><span id="local-6989586621682074414"
      ><span class="annot"
	><span class="annottext"
	  >alg :: (IntMap a, Int, Int) -&gt; Map k Quantity -&gt; (IntMap a, Int, Int)
</span
	  ><a href="#local-6989586621682074414"
	  ><span class="hs-identifier hs-var hs-var"
	    >alg</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074422"
      ><span class="annot"
	><span class="annottext"
	  >IntMap a
</span
	  ><a href="#local-6989586621682074422"
	  ><span class="hs-identifier hs-var"
	    >ss</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074423"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074423"
	  ><span class="hs-identifier hs-var"
	    >t</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074424"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074424"
	  ><span class="hs-identifier hs-var"
	    >n</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span id="local-6989586621682074425"
      ><span class="annot"
	><span class="annottext"
	  >Map k Quantity
</span
	  ><a href="#local-6989586621682074425"
	  ><span class="hs-identifier hs-var"
	    >inner</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      >
</span
      ><span id="line-225"
      ></span
      ><span
      >      </span
      ><span class="hs-special"
      >(</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Maybe a -&gt; Maybe a) -&gt; Int -&gt; IntMap a -&gt; IntMap a
forall a. (Maybe a -&gt; Maybe a) -&gt; Int -&gt; IntMap a -&gt; IntMap a
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.IntMap.Strict.Internal.html#alter"
	><span class="hs-identifier hs-var"
	  >IntMap.alter</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Maybe a -&gt; (a -&gt; Maybe a) -&gt; Maybe a -&gt; Maybe a
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Maybe.html#maybe"
	><span class="hs-identifier hs-var"
	  >maybe</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-var"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>a
</span
	><span class="hs-number"
	>1</span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-var"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(a -&gt; Maybe a) -&gt; (a -&gt; a) -&gt; a -&gt; Maybe a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#%2B"
	><span class="hs-operator hs-var"
	  >+</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>a
</span
	><span class="hs-number"
	>1</span
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Map k Quantity -&gt; Int
forall k a. Map k a -&gt; Int
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#size"
	><span class="hs-identifier hs-var"
	  >Map.size</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map k Quantity
</span
	><a href="#local-6989586621682074425"
	><span class="hs-identifier hs-var"
	  >inner</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap a
</span
	><a href="#local-6989586621682074422"
	><span class="hs-identifier hs-var"
	  >ss</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-226"
      ></span
      ><span
      >      </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074423"
	><span class="hs-identifier hs-var"
	  >t</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#%2B"
	><span class="hs-operator hs-var"
	  >+</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map k Quantity -&gt; Int
forall k a. Map k a -&gt; Int
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#size"
	><span class="hs-identifier hs-var"
	  >Map.size</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map k Quantity
</span
	><a href="#local-6989586621682074425"
	><span class="hs-identifier hs-var"
	  >inner</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-227"
      ></span
      ><span
      >      </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074424"
	><span class="hs-identifier hs-var"
	  >n</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#%2B"
	><span class="hs-operator hs-var"
	  >+</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map k Quantity -&gt; Int
forall k a. Map k a -&gt; Int
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#size"
	><span class="hs-identifier hs-var"
	  >Map.size</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>(Quantity -&gt; Bool) -&gt; Map k Quantity -&gt; Map k Quantity
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#filter"
	><span class="hs-identifier hs-var"
	  >Map.filter</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Quantity -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3C"
	><span class="hs-operator hs-var"
	  >&lt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="PlutusCore.Value.html#zeroQuantity"
	><span class="hs-identifier hs-var"
	  >zeroQuantity</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map k Quantity
</span
	><a href="#local-6989586621682074425"
	><span class="hs-identifier hs-var"
	  >inner</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-228"
      ></span
      ><span
      >      </span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-229"
      ></span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#pack%27"
	><span class="hs-pragma hs-type"
	  >pack'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-230"
      ></span
      ><span
      >
</span
      ><span id="line-231"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>{-| Total size, i.e., the number of distinct `(currency symbol, token name)` pairs
contained in the `Value`. -}</span
	></span
      ><span
      >
</span
      ><span id="line-233"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#totalSize"
	><span class="hs-identifier hs-type"
	  >totalSize</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-234"
      ></span
      ><span id="totalSize"
      ><span class="annot"
	><span class="annottext"
	  >totalSize :: Value -&gt; Int
</span
	  ><a href="PlutusCore.Value.html#totalSize"
	  ><span class="hs-identifier hs-var hs-var"
	    >totalSize</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074430"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074430"
	  ><span class="hs-identifier hs-var"
	    >total</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074430"
	><span class="hs-identifier hs-var"
	  >total</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-235"
      ></span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#totalSize"
	><span class="hs-pragma hs-type"
	  >totalSize</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-236"
      ></span
      ><span
      >
</span
      ><span id="line-237"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>-- | Size of the largest inner map.</span
	></span
      ><span
      >
</span
      ><span id="line-238"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#maxInnerSize"
	><span class="hs-identifier hs-type"
	  >maxInnerSize</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-239"
      ></span
      ><span id="maxInnerSize"
      ><span class="annot"
	><span class="annottext"
	  >maxInnerSize :: Value -&gt; Int
</span
	  ><a href="PlutusCore.Value.html#maxInnerSize"
	  ><span class="hs-identifier hs-var hs-var"
	    >maxInnerSize</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074431"
      ><span class="annot"
	><span class="annottext"
	  >IntMap Int
</span
	  ><a href="#local-6989586621682074431"
	  ><span class="hs-identifier hs-var"
	    >sizes</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; ((Int, Int) -&gt; Int) -&gt; Maybe (Int, Int) -&gt; Int
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Maybe.html#maybe"
	><span class="hs-identifier hs-var"
	  >maybe</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>0</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Int, Int) -&gt; Int
forall a b. (a, b) -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Tuple.html#fst"
	><span class="hs-identifier hs-var"
	  >fst</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int -&gt; Maybe (Int, Int)
forall a. IntMap a -&gt; Maybe (Int, a)
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.IntMap.Internal.html#lookupMax"
	><span class="hs-identifier hs-var"
	  >IntMap.lookupMax</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int
</span
	><a href="#local-6989586621682074431"
	><span class="hs-identifier hs-var"
	  >sizes</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-240"
      ></span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#maxInnerSize"
	><span class="hs-pragma hs-type"
	  >maxInnerSize</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-241"
      ></span
      ><span
      >
</span
      ><span id="line-242"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#negativeAmounts"
	><span class="hs-identifier hs-type"
	  >negativeAmounts</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-243"
      ></span
      ><span id="negativeAmounts"
      ><span class="annot"
	><span class="annottext"
	  >negativeAmounts :: Value -&gt; Int
</span
	  ><a href="PlutusCore.Value.html#negativeAmounts"
	  ><span class="hs-identifier hs-var hs-var"
	    >negativeAmounts</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074434"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074434"
	  ><span class="hs-identifier hs-var"
	    >neg</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074434"
	><span class="hs-identifier hs-var"
	  >neg</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-244"
      ></span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#negativeAmounts"
	><span class="hs-pragma hs-type"
	  >negativeAmounts</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-245"
      ></span
      ><span
      >
</span
      ><span id="line-246"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#empty"
	><span class="hs-identifier hs-type"
	  >empty</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-247"
      ></span
      ><span id="empty"
      ><span class="annot"
	><span class="annottext"
	  >empty :: Value
</span
	  ><a href="PlutusCore.Value.html#empty"
	  ><span class="hs-identifier hs-var hs-var"
	    >empty</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; IntMap Int -&gt; Int -&gt; Int -&gt; Value
</span
	><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-var"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
forall a. Monoid a =&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#mempty"
	><span class="hs-identifier hs-var"
	  >mempty</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int
forall a. Monoid a =&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#mempty"
	><span class="hs-identifier hs-var"
	  >mempty</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>0</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>0</span
	></span
      ><span
      >
</span
      ><span id="line-248"
      ></span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#empty"
	><span class="hs-pragma hs-type"
	  >empty</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-249"
      ></span
      ><span
      >
</span
      ><span id="line-250"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#toList"
	><span class="hs-identifier hs-type"
	  >toList</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="hs-special"
      >[</span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier hs-type"
	  >K</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="hs-special"
      >[</span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier hs-type"
	  >K</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >]</span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >]</span
      ><span
      >
</span
      ><span id="line-251"
      ></span
      ><span id="toList"
      ><span class="annot"
	><span class="annottext"
	  >toList :: Value -&gt; [(K, [(K, Quantity)])]
</span
	  ><a href="PlutusCore.Value.html#toList"
	  ><span class="hs-identifier hs-var hs-var"
	    >toList</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K [(K, Quantity)] -&gt; [(K, [(K, Quantity)])]
forall k a. Map k a -&gt; [(k, a)]
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#toList"
	><span class="hs-identifier hs-var"
	  >Map.toList</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Map K [(K, Quantity)] -&gt; [(K, [(K, Quantity)])])
-&gt; (Value -&gt; Map K [(K, Quantity)])
-&gt; Value
-&gt; [(K, [(K, Quantity)])]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Map K Quantity -&gt; [(K, Quantity)])
-&gt; NestedMap -&gt; Map K [(K, Quantity)]
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Strict.Internal.html#map"
	><span class="hs-identifier hs-var"
	  >Map.map</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity -&gt; [(K, Quantity)]
forall k a. Map k a -&gt; [(k, a)]
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#toList"
	><span class="hs-identifier hs-var"
	  >Map.toList</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(NestedMap -&gt; Map K [(K, Quantity)])
-&gt; (Value -&gt; NestedMap) -&gt; Value -&gt; Map K [(K, Quantity)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; NestedMap
</span
	><a href="PlutusCore.Value.html#unpack"
	><span class="hs-identifier hs-var"
	  >unpack</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-252"
      ></span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#toList"
	><span class="hs-pragma hs-type"
	  >toList</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-253"
      ></span
      ><span
      >
</span
      ><span id="line-254"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#toFlatList"
	><span class="hs-identifier hs-type"
	  >toFlatList</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="hs-special"
      >[</span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier hs-type"
	  >K</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier hs-type"
	  >K</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >]</span
      ><span
      >
</span
      ><span id="line-255"
      ></span
      ><span id="toFlatList"
      ><span class="annot"
	><span class="annottext"
	  >toFlatList :: Value -&gt; [(K, K, Quantity)]
</span
	  ><a href="PlutusCore.Value.html#toFlatList"
	  ><span class="hs-identifier hs-var hs-var"
	    >toFlatList</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; [(K, [(K, Quantity)])]
</span
	><a href="PlutusCore.Value.html#toList"
	><span class="hs-identifier hs-var"
	  >toList</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span id="local-6989586621682074437"
      ><span class="annot"
	><span class="annottext"
	  >[(K, [(K, Quantity)])]
</span
	  ><a href="#local-6989586621682074437"
	  ><span class="hs-identifier hs-var"
	    >xs</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-special"
      >[</span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><a href="#local-6989586621682074438"
	><span class="hs-identifier hs-var"
	  >c</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><a href="#local-6989586621682074439"
	><span class="hs-identifier hs-var"
	  >t</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074440"
	><span class="hs-identifier hs-var"
	  >a</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >|</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074438"
      ><span class="annot"
	><span class="annottext"
	  >K
</span
	  ><a href="#local-6989586621682074438"
	  ><span class="hs-identifier hs-var"
	    >c</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074441"
      ><span class="annot"
	><span class="annottext"
	  >[(K, Quantity)]
</span
	  ><a href="#local-6989586621682074441"
	  ><span class="hs-identifier hs-var"
	    >ys</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >&lt;-</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(K, [(K, Quantity)])]
</span
	><a href="#local-6989586621682074437"
	><span class="hs-identifier hs-var"
	  >xs</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074439"
      ><span class="annot"
	><span class="annottext"
	  >K
</span
	  ><a href="#local-6989586621682074439"
	  ><span class="hs-identifier hs-var"
	    >t</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074440"
      ><span class="annot"
	><span class="annottext"
	  >Quantity
</span
	  ><a href="#local-6989586621682074440"
	  ><span class="hs-identifier hs-var"
	    >a</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >&lt;-</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(K, Quantity)]
</span
	><a href="#local-6989586621682074441"
	><span class="hs-identifier hs-var"
	  >ys</span
	  ></a
	></span
      ><span class="hs-special"
      >]</span
      ><span
      >
</span
      ><span id="line-256"
      ></span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#toFlatList"
	><span class="hs-pragma hs-type"
	  >toFlatList</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-257"
      ></span
      ><span
      >
</span
      ><span id="line-258"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#fromList"
	><span class="hs-identifier hs-type"
	  >fromList</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="hs-special"
      >[</span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier hs-type"
	  >K</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="hs-special"
      >[</span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier hs-type"
	  >K</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >]</span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >]</span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Builtin.Result.html#BuiltinResult"
	><span class="hs-identifier hs-type"
	  >BuiltinResult</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-259"
      ></span
      ><span id="fromList"
      ><span class="annot"
	><span class="annottext"
	  >fromList :: [(K, [(K, Quantity)])] -&gt; BuiltinResult Value
</span
	  ><a href="PlutusCore.Value.html#fromList"
	  ><span class="hs-identifier hs-var hs-var"
	    >fromList</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074442"
      ><span class="annot"
	><span class="annottext"
	  >[(K, [(K, Quantity)])]
</span
	  ><a href="#local-6989586621682074442"
	  ><span class="hs-identifier hs-var"
	    >xs</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-keyword"
      >do</span
      ><span
      >
</span
      ><span id="line-260"
      ></span
      ><span
      >  </span
      ><span class="hs-comment"
      >-- Use unchecked addition during construction</span
      ><span
      >
</span
      ><span id="line-261"
      ></span
      ><span
      >  </span
      ><span class="hs-keyword"
      >let</span
      ><span
      > </span
      ><span id="local-6989586621682074448"
      ><span class="annot"
	><span class="annottext"
	  >outerMap :: NestedMap
</span
	  ><a href="#local-6989586621682074448"
	  ><span class="hs-identifier hs-var hs-var"
	    >outerMap</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      >
</span
      ><span id="line-262"
      ></span
      ><span
      >        </span
      ><span class="annot"
      ><span class="annottext"
	>(Map K Quantity -&gt; Map K Quantity -&gt; Map K Quantity)
-&gt; [(K, Map K Quantity)] -&gt; NestedMap
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Strict.Internal.html#fromListWith"
	><span class="hs-identifier hs-var"
	  >Map.fromListWith</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-263"
      ></span
      ><span
      >          </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>(Quantity -&gt; Quantity -&gt; Quantity)
-&gt; Map K Quantity -&gt; Map K Quantity -&gt; Map K Quantity
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; Map k a -&gt; Map k a -&gt; Map k a
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Strict.Internal.html#unionWith"
	><span class="hs-identifier hs-var"
	  >Map.unionWith</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Quantity -&gt; Quantity
</span
	><a href="PlutusCore.Value.html#unsafeAddQuantity"
	><span class="hs-identifier hs-var"
	  >unsafeAddQuantity</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-comment"
      >-- combine inner maps with unchecked addition</span
      ><span
      >
</span
      ><span id="line-264"
      ></span
      ><span
      >          </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>([(K, Quantity)] -&gt; Map K Quantity)
-&gt; (K, [(K, Quantity)]) -&gt; (K, Map K Quantity)
forall b c a. (b -&gt; c) -&gt; (a, b) -&gt; (a, c)
forall (p :: * -&gt; * -&gt; *) b c a.
Bifunctor p =&gt;
(b -&gt; c) -&gt; p a b -&gt; p a c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Bifunctor.html#second"
	><span class="hs-identifier hs-var"
	  >second</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>(Quantity -&gt; Quantity -&gt; Quantity)
-&gt; [(K, Quantity)] -&gt; Map K Quantity
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Strict.Internal.html#fromListWith"
	><span class="hs-identifier hs-var"
	  >Map.fromListWith</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Quantity -&gt; Quantity
</span
	><a href="PlutusCore.Value.html#unsafeAddQuantity"
	><span class="hs-identifier hs-var"
	  >unsafeAddQuantity</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>((K, [(K, Quantity)]) -&gt; (K, Map K Quantity))
-&gt; [(K, [(K, Quantity)])] -&gt; [(K, Map K Quantity)]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Functor.html#%3C%24%3E"
	><span class="hs-operator hs-var"
	  >&lt;$&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(K, [(K, Quantity)])]
</span
	><a href="#local-6989586621682074442"
	><span class="hs-identifier hs-var"
	  >xs</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-265"
      ></span
      ><span
      >  </span
      ><span class="hs-comment"
      >-- Validate all quantities are within bounds</span
      ><span
      >
</span
      ><span id="line-266"
      ></span
      ><span
      >  </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; Value
</span
	><a href="PlutusCore.Value.html#pack"
	><span class="hs-identifier hs-var"
	  >pack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(NestedMap -&gt; Value)
-&gt; BuiltinResult NestedMap -&gt; BuiltinResult Value
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Functor.html#%3C%24%3E"
	><span class="hs-operator hs-var"
	  >&lt;$&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>HasCallStack =&gt; NestedMap -&gt; BuiltinResult NestedMap
NestedMap -&gt; BuiltinResult NestedMap
</span
	><a href="PlutusCore.Value.html#validateQuantities"
	><span class="hs-identifier hs-var"
	  >validateQuantities</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074448"
	><span class="hs-identifier hs-var"
	  >outerMap</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-267"
      ></span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#fromList"
	><span class="hs-pragma hs-type"
	  >fromList</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-268"
      ></span
      ><span
      >
</span
      ><span id="line-269"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>-- | Unsafe addition of quantities without bounds checking.</span
	></span
      ><span
      >
</span
      ><span id="line-270"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#unsafeAddQuantity"
	><span class="hs-identifier hs-type"
	  >unsafeAddQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-271"
      ></span
      ><span id="unsafeAddQuantity"
      ><span class="annot"
	><span class="annottext"
	  >unsafeAddQuantity :: Quantity -&gt; Quantity -&gt; Quantity
</span
	  ><a href="PlutusCore.Value.html#unsafeAddQuantity"
	  ><span class="hs-identifier hs-var hs-var"
	    >unsafeAddQuantity</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#UnsafeQuantity"
	><span class="hs-identifier hs-type"
	  >UnsafeQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074454"
      ><span class="annot"
	><span class="annottext"
	  >Integer
</span
	  ><a href="#local-6989586621682074454"
	  ><span class="hs-identifier hs-var"
	    >x</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#UnsafeQuantity"
	><span class="hs-identifier hs-type"
	  >UnsafeQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074455"
      ><span class="annot"
	><span class="annottext"
	  >Integer
</span
	  ><a href="#local-6989586621682074455"
	  ><span class="hs-identifier hs-var"
	    >y</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Quantity
</span
	><a href="PlutusCore.Value.html#UnsafeQuantity"
	><span class="hs-identifier hs-var"
	  >UnsafeQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074454"
	><span class="hs-identifier hs-var"
	  >x</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Integer -&gt; Integer
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#%2B"
	><span class="hs-operator hs-var"
	  >+</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074455"
	><span class="hs-identifier hs-var"
	  >y</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-272"
      ></span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#unsafeAddQuantity"
	><span class="hs-pragma hs-type"
	  >unsafeAddQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-273"
      ></span
      ><span
      >
</span
      ><span id="line-274"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>-- | Validate all quantities in a nested map are within bounds.</span
	></span
      ><span
      >
</span
      ><span id="line-275"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#validateQuantities"
	><span class="hs-identifier hs-type"
	  >validateQuantities</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Stack.Types.html#HasCallStack"
	><span class="hs-identifier hs-type"
	  >HasCallStack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#NestedMap"
	><span class="hs-identifier hs-type"
	  >NestedMap</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Builtin.Result.html#BuiltinResult"
	><span class="hs-identifier hs-type"
	  >BuiltinResult</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#NestedMap"
	><span class="hs-identifier hs-type"
	  >NestedMap</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-276"
      ></span
      ><span id="validateQuantities"
      ><span class="annot"
	><span class="annottext"
	  >validateQuantities :: HasCallStack =&gt; NestedMap -&gt; BuiltinResult NestedMap
</span
	  ><a href="PlutusCore.Value.html#validateQuantities"
	  ><span class="hs-identifier hs-var hs-var"
	    >validateQuantities</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074463"
      ><span class="annot"
	><span class="annottext"
	  >NestedMap
</span
	  ><a href="#local-6989586621682074463"
	  ><span class="hs-identifier hs-var"
	    >nestedMap</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      >
</span
      ><span id="line-277"
      ></span
      ><span
      >  </span
      ><span class="hs-keyword"
      >case</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Quantity -&gt; Bool) -&gt; [Quantity] -&gt; Maybe Quantity
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Foldable.html#find"
	><span class="hs-identifier hs-var"
	  >find</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Bool
</span
	><a href="#local-6989586621682074464"
	><span class="hs-identifier hs-var"
	  >isOutOfBounds</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[Quantity]
</span
	><a href="#local-6989586621682074465"
	><span class="hs-identifier hs-var"
	  >allQuantities</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >of</span
      ><span
      >
</span
      ><span id="line-278"
      ></span
      ><span
      >    </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-type"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#UnsafeQuantity"
	><span class="hs-identifier hs-type"
	  >UnsafeQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074466"
      ><span class="annot"
	><span class="annottext"
	  >Integer
</span
	  ><a href="#local-6989586621682074466"
	  ><span class="hs-identifier hs-var"
	    >i</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; BuiltinResult NestedMap
forall a. String -&gt; BuiltinResult a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(String -&gt; BuiltinResult NestedMap)
-&gt; String -&gt; BuiltinResult NestedMap
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><a href="#local-6989586621682074467"
	><span class="hs-identifier hs-var"
	  >context</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%3C%3E"
	><span class="hs-operator hs-var"
	  >&lt;&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;: quantity out of bounds: &quot;</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%3C%3E"
	><span class="hs-operator hs-var"
	  >&lt;&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Show.html#show"
	><span class="hs-identifier hs-var"
	  >show</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074466"
	><span class="hs-identifier hs-var"
	  >i</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-279"
      ></span
      ><span
      >    </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe Quantity
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; BuiltinResult NestedMap
forall a. a -&gt; BuiltinResult a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#pure"
	><span class="hs-identifier hs-var"
	  >pure</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074463"
	><span class="hs-identifier hs-var"
	  >nestedMap</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-280"
      ></span
      ><span
      >  </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-281"
      ></span
      ><span
      >    </span
      ><span id="local-6989586621682074465"
      ><span class="annot"
	><span class="annottext"
	  >allQuantities :: [Quantity]
</span
	  ><a href="#local-6989586621682074465"
	  ><span class="hs-identifier hs-var hs-var"
	    >allQuantities</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Map K Quantity -&gt; [Quantity]) -&gt; [Map K Quantity] -&gt; [Quantity]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Foldable.html#concatMap"
	><span class="hs-identifier hs-var"
	  >concatMap</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity -&gt; [Quantity]
forall k a. Map k a -&gt; [a]
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#elems"
	><span class="hs-identifier hs-var"
	  >Map.elems</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>([Map K Quantity] -&gt; [Quantity]) -&gt; [Map K Quantity] -&gt; [Quantity]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; [Map K Quantity]
forall k a. Map k a -&gt; [a]
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#elems"
	><span class="hs-identifier hs-var"
	  >Map.elems</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074463"
	><span class="hs-identifier hs-var"
	  >nestedMap</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-282"
      ></span
      ><span
      >    </span
      ><span id="local-6989586621682074464"
      ><span class="annot"
	><span class="annottext"
	  >isOutOfBounds :: Quantity -&gt; Bool
</span
	  ><a href="#local-6989586621682074464"
	  ><span class="hs-identifier hs-var hs-var"
	    >isOutOfBounds</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#UnsafeQuantity"
	><span class="hs-identifier hs-type"
	  >UnsafeQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074475"
      ><span class="annot"
	><span class="annottext"
	  >Integer
</span
	  ><a href="#local-6989586621682074475"
	  ><span class="hs-identifier hs-var"
	    >i</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      >
</span
      ><span id="line-283"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074475"
	><span class="hs-identifier hs-var"
	  >i</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3C"
	><span class="hs-operator hs-var"
	  >&lt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Integer
</span
	><a href="PlutusCore.Value.html#unQuantity"
	><span class="hs-identifier hs-var"
	  >unQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
forall a. Bounded a =&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Enum.html#minBound"
	><span class="hs-identifier hs-var"
	  >minBound</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Bool -&gt; Bool -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%7C%7C"
	><span class="hs-operator hs-var"
	  >||</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074475"
	><span class="hs-identifier hs-var"
	  >i</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3E"
	><span class="hs-operator hs-var"
	  >&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Integer
</span
	><a href="PlutusCore.Value.html#unQuantity"
	><span class="hs-identifier hs-var"
	  >unQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
forall a. Bounded a =&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Enum.html#maxBound"
	><span class="hs-identifier hs-var"
	  >maxBound</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-284"
      ></span
      ><span
      >    </span
      ><span id="local-6989586621682074467"
      ><span class="annot"
	><span class="annottext"
	  >context :: String
</span
	  ><a href="#local-6989586621682074467"
	  ><span class="hs-identifier hs-var hs-var"
	    >context</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-keyword"
      >case</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>CallStack -&gt; [(String, SrcLoc)]
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Stack.Types.html#getCallStack"
	><span class="hs-identifier hs-var"
	  >getCallStack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>CallStack
HasCallStack =&gt; CallStack
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Stack.html#callStack"
	><span class="hs-identifier hs-var"
	  >callStack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >of</span
      ><span
      >
</span
      ><span id="line-285"
      ></span
      ><span
      >      </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074480"
      ><span class="annot"
	><span class="annottext"
	  >String
</span
	  ><a href="#local-6989586621682074480"
	  ><span class="hs-identifier hs-var"
	    >fnName</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>SrcLoc
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#%3A"
	><span class="hs-glyph hs-type"
	  >:</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(String, SrcLoc)]
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><a href="#local-6989586621682074480"
	><span class="hs-identifier hs-var"
	  >fnName</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-286"
      ></span
      ><span
      >      </span
      ><span class="hs-special"
      >[</span
      ><span class="hs-special"
      >]</span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;&lt;unknown&gt;&quot;</span
	></span
      ><span
      >
</span
      ><span id="line-287"
      ></span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#validateQuantities"
	><span class="hs-pragma hs-type"
	  >validateQuantities</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-288"
      ></span
      ><span
      >
</span
      ><span id="line-289"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#normalize"
	><span class="hs-identifier hs-type"
	  >normalize</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#NestedMap"
	><span class="hs-identifier hs-type"
	  >NestedMap</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#NestedMap"
	><span class="hs-identifier hs-type"
	  >NestedMap</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-290"
      ></span
      ><span id="normalize"
      ><span class="annot"
	><span class="annottext"
	  >normalize :: NestedMap -&gt; NestedMap
</span
	  ><a href="PlutusCore.Value.html#normalize"
	  ><span class="hs-identifier hs-var hs-var"
	    >normalize</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Map K Quantity -&gt; Bool) -&gt; NestedMap -&gt; NestedMap
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#filter"
	><span class="hs-identifier hs-var"
	  >Map.filter</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Bool -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#not"
	><span class="hs-identifier hs-var"
	  >not</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Bool -&gt; Bool)
-&gt; (Map K Quantity -&gt; Bool) -&gt; Map K Quantity -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity -&gt; Bool
forall k a. Map k a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#null"
	><span class="hs-identifier hs-var"
	  >Map.null</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(NestedMap -&gt; NestedMap)
-&gt; (NestedMap -&gt; NestedMap) -&gt; NestedMap -&gt; NestedMap
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Map K Quantity -&gt; Map K Quantity) -&gt; NestedMap -&gt; NestedMap
forall a b k. (a -&gt; b) -&gt; Map k a -&gt; Map k b
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Strict.Internal.html#map"
	><span class="hs-identifier hs-var"
	  >Map.map</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>(Quantity -&gt; Bool) -&gt; Map K Quantity -&gt; Map K Quantity
forall a k. (a -&gt; Bool) -&gt; Map k a -&gt; Map k a
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#filter"
	><span class="hs-identifier hs-var"
	  >Map.filter</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Quantity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%2F%3D"
	><span class="hs-operator hs-var"
	  >/=</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="PlutusCore.Value.html#zeroQuantity"
	><span class="hs-identifier hs-var"
	  >zeroQuantity</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-291"
      ></span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#normalize"
	><span class="hs-pragma hs-type"
	  >normalize</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-292"
      ></span
      ><span
      >
</span
      ><span id="line-293"
      ></span
      ><span class="hs-keyword"
      >instance</span
      ><span
      > </span
      ><span id="local-6989586621682074486"
      ><span class="annot"
	><a href="https://hackage.haskell.org/package/prettyprinter-1.7.1/docs/src/Prettyprinter.Internal.html#Pretty"
	  ><span class="hs-identifier hs-type"
	    >Pretty</span
	    ></a
	  ></span
	><span
	> </span
	><span class="annot"
	><a href="PlutusCore.Value.html#Value"
	  ><span class="hs-identifier hs-type"
	    >Value</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-294"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621682074502"
      ><span class="annot"
	><span class="annottext"
	  >pretty :: forall ann. Value -&gt; Doc ann
</span
	  ><a href="https://hackage.haskell.org/package/prettyprinter-1.7.1/docs/src/Prettyprinter.Internal.html#pretty"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >pretty</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(Text, [(Text, Quantity)])] -&gt; Doc ann
forall ann. [(Text, [(Text, Quantity)])] -&gt; Doc ann
forall a ann. Pretty a =&gt; a -&gt; Doc ann
</span
	><a href="https://hackage.haskell.org/package/prettyprinter-1.7.1/docs/src/Prettyprinter.Internal.html#pretty"
	><span class="hs-identifier hs-var"
	  >pretty</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>([(Text, [(Text, Quantity)])] -&gt; Doc ann)
-&gt; (Value -&gt; [(Text, [(Text, Quantity)])]) -&gt; Value -&gt; Doc ann
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>((K, [(K, Quantity)]) -&gt; (Text, [(Text, Quantity)]))
-&gt; [(K, [(K, Quantity)])] -&gt; [(Text, [(Text, Quantity)])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#fmap"
	><span class="hs-identifier hs-var"
	  >fmap</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>(K -&gt; Text)
-&gt; ([(K, Quantity)] -&gt; [(Text, Quantity)])
-&gt; (K, [(K, Quantity)])
-&gt; (Text, [(Text, Quantity)])
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; (a, c) -&gt; (b, d)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Bifunctor.html#bimap"
	><span class="hs-identifier hs-var"
	  >bimap</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K -&gt; Text
</span
	><a href="#local-6989586621682074504"
	><span class="hs-identifier hs-var"
	  >toText</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>((K, Quantity) -&gt; (Text, Quantity))
-&gt; [(K, Quantity)] -&gt; [(Text, Quantity)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#fmap"
	><span class="hs-identifier hs-var"
	  >fmap</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>(K -&gt; Text) -&gt; (K, Quantity) -&gt; (Text, Quantity)
forall a b c. (a -&gt; b) -&gt; (a, c) -&gt; (b, c)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Bifunctor.html#first"
	><span class="hs-identifier hs-var"
	  >first</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K -&gt; Text
</span
	><a href="#local-6989586621682074504"
	><span class="hs-identifier hs-var"
	  >toText</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>([(K, [(K, Quantity)])] -&gt; [(Text, [(Text, Quantity)])])
-&gt; (Value -&gt; [(K, [(K, Quantity)])])
-&gt; Value
-&gt; [(Text, [(Text, Quantity)])]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; [(K, [(K, Quantity)])]
</span
	><a href="PlutusCore.Value.html#toList"
	><span class="hs-identifier hs-var"
	  >toList</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-295"
      ></span
      ><span
      >    </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-296"
      ></span
      ><span
      >      </span
      ><span id="local-6989586621682074504"
      ><span class="annot"
	><span class="annottext"
	  >toText :: K -&gt; Text
</span
	  ><a href="#local-6989586621682074504"
	  ><span class="hs-identifier hs-var hs-var"
	    >toText</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; Text
</span
	><a href="https://hackage.haskell.org/package/text-2.0.2/docs/src/Data.Text.Encoding.html#decodeLatin1"
	><span class="hs-identifier hs-var"
	  >Text.decodeLatin1</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(ByteString -&gt; Text) -&gt; (K -&gt; ByteString) -&gt; K -&gt; Text
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; ByteString
</span
	><span class="hs-identifier hs-var"
	>Base64.encode</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(ByteString -&gt; ByteString) -&gt; (K -&gt; ByteString) -&gt; K -&gt; ByteString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K -&gt; ByteString
</span
	><a href="PlutusCore.Value.html#unK"
	><span class="hs-identifier hs-var"
	  >unK</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-297"
      ></span
      ><span
      >
</span
      ><span id="line-298"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>{-| \(O(\log \max(m, k))\), where \(m\) is the size of the outer map, and \(k\) is
the size of the largest inner map. -}</span
	></span
      ><span
      >
</span
      ><span id="line-300"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#insertCoin"
	><span class="hs-identifier hs-type"
	  >insertCoin</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/bytestring-0.11.5.4/docs/src/Data.ByteString.Internal.Type.html#ByteString"
	><span class="hs-identifier hs-type"
	  >ByteString</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/bytestring-0.11.5.4/docs/src/Data.ByteString.Internal.Type.html#ByteString"
	><span class="hs-identifier hs-type"
	  >ByteString</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-bignum-1.3/docs/src/GHC.Num.Integer.html#Integer"
	><span class="hs-identifier hs-type"
	  >Integer</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Builtin.Result.html#BuiltinResult"
	><span class="hs-identifier hs-type"
	  >BuiltinResult</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-301"
      ></span
      ><span id="insertCoin"
      ><span class="annot"
	><span class="annottext"
	  >insertCoin :: ByteString -&gt; ByteString -&gt; Integer -&gt; Value -&gt; BuiltinResult Value
</span
	  ><a href="PlutusCore.Value.html#insertCoin"
	  ><span class="hs-identifier hs-var hs-var"
	    >insertCoin</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074508"
      ><span class="annot"
	><span class="annottext"
	  >ByteString
</span
	  ><a href="#local-6989586621682074508"
	  ><span class="hs-identifier hs-var"
	    >unsafeCurrency</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074509"
      ><span class="annot"
	><span class="annottext"
	  >ByteString
</span
	  ><a href="#local-6989586621682074509"
	  ><span class="hs-identifier hs-var"
	    >unsafeToken</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074510"
      ><span class="annot"
	><span class="annottext"
	  >Integer
</span
	  ><a href="#local-6989586621682074510"
	  ><span class="hs-identifier hs-var"
	    >unsafeAmount</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074511"
      ><span class="annot"
	><span class="annottext"
	  >v :: Value
</span
	  ><a href="#local-6989586621682074511"
	  ><span class="hs-identifier hs-var"
	    >v</span
	    ></a
	  ></span
	></span
      ><span class="hs-glyph"
      >@</span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074512"
      ><span class="annot"
	><span class="annottext"
	  >NestedMap
</span
	  ><a href="#local-6989586621682074512"
	  ><span class="hs-identifier hs-var"
	    >outer</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074513"
      ><span class="annot"
	><span class="annottext"
	  >IntMap Int
</span
	  ><a href="#local-6989586621682074513"
	  ><span class="hs-identifier hs-var"
	    >sizes</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074514"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074514"
	  ><span class="hs-identifier hs-var"
	    >total</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074515"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074515"
	  ><span class="hs-identifier hs-var"
	    >neg</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-302"
      ></span
      ><span
      >  </span
      ><span class="hs-glyph"
      >|</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074510"
	><span class="hs-identifier hs-var"
	  >unsafeAmount</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3D%3D"
	><span class="hs-operator hs-var"
	  >==</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><span class="hs-number"
	>0</span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; BuiltinResult Value
forall a. a -&gt; BuiltinResult a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#pure"
	><span class="hs-identifier hs-var"
	  >pure</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Value -&gt; BuiltinResult Value) -&gt; Value -&gt; BuiltinResult Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; ByteString -&gt; Value -&gt; Value
</span
	><a href="PlutusCore.Value.html#deleteCoin"
	><span class="hs-identifier hs-var"
	  >deleteCoin</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString
</span
	><a href="#local-6989586621682074508"
	><span class="hs-identifier hs-var"
	  >unsafeCurrency</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString
</span
	><a href="#local-6989586621682074509"
	><span class="hs-identifier hs-var"
	  >unsafeToken</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="#local-6989586621682074511"
	><span class="hs-identifier hs-var"
	  >v</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-303"
      ></span
      ><span
      >  </span
      ><span class="hs-glyph"
      >|</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Bool
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#otherwise"
	><span class="hs-identifier hs-var"
	  >otherwise</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-keyword"
      >case</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; Maybe K
</span
	><a href="PlutusCore.Value.html#k"
	><span class="hs-identifier hs-var"
	  >k</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString
</span
	><a href="#local-6989586621682074508"
	><span class="hs-identifier hs-var"
	  >unsafeCurrency</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; Maybe K
</span
	><a href="PlutusCore.Value.html#k"
	><span class="hs-identifier hs-var"
	  >k</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString
</span
	><a href="#local-6989586621682074509"
	><span class="hs-identifier hs-var"
	  >unsafeToken</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Maybe Quantity
</span
	><a href="PlutusCore.Value.html#quantity"
	><span class="hs-identifier hs-var"
	  >quantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074510"
	><span class="hs-identifier hs-var"
	  >unsafeAmount</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-keyword"
      >of</span
      ><span
      >
</span
      ><span id="line-304"
      ></span
      ><span
      >      </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Maybe K
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe K
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe Quantity
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; BuiltinResult Value
forall a. String -&gt; BuiltinResult a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(String -&gt; BuiltinResult Value) -&gt; String -&gt; BuiltinResult Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;insertCoin: invalid currency: &quot;</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%3C%3E"
	><span class="hs-operator hs-var"
	  >&lt;&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[Word8] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Show.html#show"
	><span class="hs-identifier hs-var"
	  >show</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; [Word8]
</span
	><a href="https://hackage.haskell.org/package/bytestring-0.11.5.4/docs/src/Data.ByteString.html#unpack"
	><span class="hs-identifier hs-var"
	  >B.unpack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString
</span
	><a href="#local-6989586621682074508"
	><span class="hs-identifier hs-var"
	  >unsafeCurrency</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-305"
      ></span
      ><span
      >      </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Maybe K
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe K
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe Quantity
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; BuiltinResult Value
forall a. String -&gt; BuiltinResult a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(String -&gt; BuiltinResult Value) -&gt; String -&gt; BuiltinResult Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;insertCoin: invalid token: &quot;</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%3C%3E"
	><span class="hs-operator hs-var"
	  >&lt;&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[Word8] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Show.html#show"
	><span class="hs-identifier hs-var"
	  >show</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; [Word8]
</span
	><a href="https://hackage.haskell.org/package/bytestring-0.11.5.4/docs/src/Data.ByteString.html#unpack"
	><span class="hs-identifier hs-var"
	  >B.unpack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString
</span
	><a href="#local-6989586621682074509"
	><span class="hs-identifier hs-var"
	  >unsafeToken</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-306"
      ></span
      ><span
      >      </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Maybe K
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe K
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe Quantity
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; BuiltinResult Value
forall a. String -&gt; BuiltinResult a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(String -&gt; BuiltinResult Value) -&gt; String -&gt; BuiltinResult Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;insertCoin: quantity out of bounds: &quot;</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%3C%3E"
	><span class="hs-operator hs-var"
	  >&lt;&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Show.html#show"
	><span class="hs-identifier hs-var"
	  >show</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074510"
	><span class="hs-identifier hs-var"
	  >unsafeAmount</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-307"
      ></span
      ><span
      >      </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-type"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074516"
      ><span class="annot"
	><span class="annottext"
	  >K
</span
	  ><a href="#local-6989586621682074516"
	  ><span class="hs-identifier hs-var"
	    >currency</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-type"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074517"
      ><span class="annot"
	><span class="annottext"
	  >K
</span
	  ><a href="#local-6989586621682074517"
	  ><span class="hs-identifier hs-var"
	    >token</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-type"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074518"
      ><span class="annot"
	><span class="annottext"
	  >Quantity
</span
	  ><a href="#local-6989586621682074518"
	  ><span class="hs-identifier hs-var"
	    >qty</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      >
</span
      ><span id="line-308"
      ></span
      ><span
      >        </span
      ><span class="hs-keyword"
      >let</span
      ><span
      > </span
      ><span class="annot"
      ><a href="#local-6989586621682074519"
	><span class="hs-identifier hs-type"
	  >f</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-309"
      ></span
      ><span
      >              </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Maybe"
	><span class="hs-identifier hs-type"
	  >Maybe</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#Map"
	><span class="hs-identifier hs-type"
	  >Map</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier hs-type"
	  >K</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-310"
      ></span
      ><span
      >              </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span
      > </span
      ><span class="hs-comment"
      >-- Left (old size of inner map) if the total size grows by 1,</span
      ><span
      >
</span
      ><span id="line-311"
      ></span
      ><span
      >                   </span
      ><span class="hs-comment"
      >-- otherwise, Right (old quantity)</span
      ><span
      >
</span
      ><span id="line-312"
      ></span
      ><span
      >                   </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Either.html#Either"
	><span class="hs-identifier hs-type"
	  >Either</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-313"
      ></span
      ><span
      >                 </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Maybe"
	><span class="hs-identifier hs-type"
	  >Maybe</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#Map"
	><span class="hs-identifier hs-type"
	  >Map</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier hs-type"
	  >K</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-314"
      ></span
      ><span
      >                 </span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-315"
      ></span
      ><span
      >            </span
      ><span id="local-6989586621682074519"
      ><span class="annot"
	><span class="annottext"
	  >f :: Maybe (Map K Quantity)
-&gt; (Either Int Quantity, Maybe (Map K Quantity))
</span
	  ><a href="#local-6989586621682074519"
	  ><span class="hs-identifier hs-var hs-var"
	    >f</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-glyph"
      >\</span
      ><span class="hs-glyph"
      >case</span
      ><span
      >
</span
      ><span id="line-316"
      ></span
      ><span
      >              </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe (Map K Quantity)
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Either Int Quantity
forall a b. a -&gt; Either a b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Either.html#Left"
	><span class="hs-identifier hs-var"
	  >Left</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>0</span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity -&gt; Maybe (Map K Quantity)
forall a. a -&gt; Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-var"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>K -&gt; Quantity -&gt; Map K Quantity
forall k a. k -&gt; a -&gt; Map k a
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Strict.Internal.html#singleton"
	><span class="hs-identifier hs-var"
	  >Map.singleton</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><a href="#local-6989586621682074517"
	><span class="hs-identifier hs-var"
	  >token</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074518"
	><span class="hs-identifier hs-var"
	  >qty</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-317"
      ></span
      ><span
      >              </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-type"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074521"
      ><span class="annot"
	><span class="annottext"
	  >Map K Quantity
</span
	  ><a href="#local-6989586621682074521"
	  ><span class="hs-identifier hs-var"
	    >inner</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      >
</span
      ><span id="line-318"
      ></span
      ><span
      >                </span
      ><span class="hs-keyword"
      >let</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074523"
      ><span class="annot"
	><span class="annottext"
	  >Maybe Quantity
</span
	  ><a href="#local-6989586621682074523"
	  ><span class="hs-identifier hs-var"
	    >mOldQuantity</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074524"
      ><span class="annot"
	><span class="annottext"
	  >Map K Quantity
</span
	  ><a href="#local-6989586621682074524"
	  ><span class="hs-identifier hs-var"
	    >inner'</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      >
</span
      ><span id="line-319"
      ></span
      ><span
      >                      </span
      ><span class="annot"
      ><span class="annottext"
	>(K -&gt; Quantity -&gt; Quantity -&gt; Quantity)
-&gt; K
-&gt; Quantity
-&gt; Map K Quantity
-&gt; (Maybe Quantity, Map K Quantity)
forall k a.
Ord k =&gt;
(k -&gt; a -&gt; a -&gt; a) -&gt; k -&gt; a -&gt; Map k a -&gt; (Maybe a, Map k a)
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Strict.Internal.html#insertLookupWithKey"
	><span class="hs-identifier hs-var"
	  >Map.insertLookupWithKey</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="hs-glyph"
      >\</span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074518"
	><span class="hs-identifier hs-var"
	  >qty</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><a href="#local-6989586621682074517"
	><span class="hs-identifier hs-var"
	  >token</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074518"
	><span class="hs-identifier hs-var"
	  >qty</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity
</span
	><a href="#local-6989586621682074521"
	><span class="hs-identifier hs-var"
	  >inner</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-320"
      ></span
      ><span
      >                 </span
      ><span class="hs-keyword"
      >in</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Either Int Quantity
-&gt; (Quantity -&gt; Either Int Quantity)
-&gt; Maybe Quantity
-&gt; Either Int Quantity
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Maybe.html#maybe"
	><span class="hs-identifier hs-var"
	  >maybe</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Either Int Quantity
forall a b. a -&gt; Either a b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Either.html#Left"
	><span class="hs-identifier hs-var"
	  >Left</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity -&gt; Int
forall k a. Map k a -&gt; Int
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#size"
	><span class="hs-identifier hs-var"
	  >Map.size</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity
</span
	><a href="#local-6989586621682074521"
	><span class="hs-identifier hs-var"
	  >inner</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Either Int Quantity
forall a b. b -&gt; Either a b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Either.html#Right"
	><span class="hs-identifier hs-var"
	  >Right</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe Quantity
</span
	><a href="#local-6989586621682074523"
	><span class="hs-identifier hs-var"
	  >mOldQuantity</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity -&gt; Maybe (Map K Quantity)
forall a. a -&gt; Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-var"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity
</span
	><a href="#local-6989586621682074524"
	><span class="hs-identifier hs-var"
	  >inner'</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-321"
      ></span
      ><span
      >            </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074529"
      ><span class="annot"
	><span class="annottext"
	  >Either Int Quantity
</span
	  ><a href="#local-6989586621682074529"
	  ><span class="hs-identifier hs-var"
	    >res</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074530"
      ><span class="annot"
	><span class="annottext"
	  >NestedMap
</span
	  ><a href="#local-6989586621682074530"
	  ><span class="hs-identifier hs-var"
	    >outer'</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Maybe (Map K Quantity)
 -&gt; (Either Int Quantity, Maybe (Map K Quantity)))
-&gt; K -&gt; NestedMap -&gt; (Either Int Quantity, NestedMap)
forall (f :: * -&gt; *) k a.
(Functor f, Ord k) =&gt;
(Maybe a -&gt; f (Maybe a)) -&gt; k -&gt; Map k a -&gt; f (Map k a)
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Strict.Internal.html#alterF"
	><span class="hs-identifier hs-var"
	  >Map.alterF</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe (Map K Quantity)
-&gt; (Either Int Quantity, Maybe (Map K Quantity))
</span
	><a href="#local-6989586621682074519"
	><span class="hs-identifier hs-var"
	  >f</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><a href="#local-6989586621682074516"
	><span class="hs-identifier hs-var"
	  >currency</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074512"
	><span class="hs-identifier hs-var"
	  >outer</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-322"
      ></span
      ><span
      >            </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074547"
      ><span class="annot"
	><span class="annottext"
	  >IntMap Int
</span
	  ><a href="#local-6989586621682074547"
	  ><span class="hs-identifier hs-var"
	    >sizes'</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074548"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074548"
	  ><span class="hs-identifier hs-var"
	    >total'</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074549"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074549"
	  ><span class="hs-identifier hs-var"
	    >neg'</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-keyword"
      >case</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Either Int Quantity
</span
	><a href="#local-6989586621682074529"
	><span class="hs-identifier hs-var"
	  >res</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >of</span
      ><span
      >
</span
      ><span id="line-323"
      ></span
      ><span
      >              </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Either.html#Left"
	><span class="hs-identifier hs-type"
	  >Left</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074550"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074550"
	  ><span class="hs-identifier hs-var"
	    >oldSize</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      >
</span
      ><span id="line-324"
      ></span
      ><span
      >                </span
      ><span class="hs-special"
      >(</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; IntMap Int -&gt; IntMap Int
</span
	><a href="PlutusCore.Value.html#updateSizes"
	><span class="hs-identifier hs-var"
	  >updateSizes</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074550"
	><span class="hs-identifier hs-var"
	  >oldSize</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074550"
	><span class="hs-identifier hs-var"
	  >oldSize</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#%2B"
	><span class="hs-operator hs-var"
	  >+</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>1</span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int
</span
	><a href="#local-6989586621682074513"
	><span class="hs-identifier hs-var"
	  >sizes</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-325"
      ></span
      ><span
      >                </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074514"
	><span class="hs-identifier hs-var"
	  >total</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#%2B"
	><span class="hs-operator hs-var"
	  >+</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>1</span
	></span
      ><span
      >
</span
      ><span id="line-326"
      ></span
      ><span
      >                </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="hs-keyword"
      >if</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074518"
	><span class="hs-identifier hs-var"
	  >qty</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Quantity -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3C"
	><span class="hs-operator hs-var"
	  >&lt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="PlutusCore.Value.html#zeroQuantity"
	><span class="hs-identifier hs-var"
	  >zeroQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >then</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074515"
	><span class="hs-identifier hs-var"
	  >neg</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#%2B"
	><span class="hs-operator hs-var"
	  >+</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>1</span
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >else</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074515"
	><span class="hs-identifier hs-var"
	  >neg</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-327"
      ></span
      ><span
      >                </span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-328"
      ></span
      ><span
      >              </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Either.html#Right"
	><span class="hs-identifier hs-type"
	  >Right</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074552"
      ><span class="annot"
	><span class="annottext"
	  >Quantity
</span
	  ><a href="#local-6989586621682074552"
	  ><span class="hs-identifier hs-var"
	    >oldQuantity</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      >
</span
      ><span id="line-329"
      ></span
      ><span
      >                </span
      ><span class="hs-special"
      >(</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int
</span
	><a href="#local-6989586621682074513"
	><span class="hs-identifier hs-var"
	  >sizes</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-330"
      ></span
      ><span
      >                </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074514"
	><span class="hs-identifier hs-var"
	  >total</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-331"
      ></span
      ><span
      >                </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="hs-keyword"
      >if</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074552"
	><span class="hs-identifier hs-var"
	  >oldQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Quantity -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3C"
	><span class="hs-operator hs-var"
	  >&lt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="PlutusCore.Value.html#zeroQuantity"
	><span class="hs-identifier hs-var"
	  >zeroQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Bool -&gt; Bool -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%26%26"
	><span class="hs-operator hs-var"
	  >&amp;&amp;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074518"
	><span class="hs-identifier hs-var"
	  >qty</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Quantity -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3E"
	><span class="hs-operator hs-var"
	  >&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="PlutusCore.Value.html#zeroQuantity"
	><span class="hs-identifier hs-var"
	  >zeroQuantity</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-332"
      ></span
      ><span
      >                    </span
      ><span class="hs-keyword"
      >then</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074515"
	><span class="hs-identifier hs-var"
	  >neg</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#-"
	><span class="hs-glyph hs-var"
	  >-</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>1</span
	></span
      ><span
      >
</span
      ><span id="line-333"
      ></span
      ><span
      >                    </span
      ><span class="hs-keyword"
      >else</span
      ><span
      >
</span
      ><span id="line-334"
      ></span
      ><span
      >                      </span
      ><span class="hs-keyword"
      >if</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074552"
	><span class="hs-identifier hs-var"
	  >oldQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Quantity -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3E"
	><span class="hs-operator hs-var"
	  >&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="PlutusCore.Value.html#zeroQuantity"
	><span class="hs-identifier hs-var"
	  >zeroQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Bool -&gt; Bool -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%26%26"
	><span class="hs-operator hs-var"
	  >&amp;&amp;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074518"
	><span class="hs-identifier hs-var"
	  >qty</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Quantity -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3C"
	><span class="hs-operator hs-var"
	  >&lt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="PlutusCore.Value.html#zeroQuantity"
	><span class="hs-identifier hs-var"
	  >zeroQuantity</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-335"
      ></span
      ><span
      >                        </span
      ><span class="hs-keyword"
      >then</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074515"
	><span class="hs-identifier hs-var"
	  >neg</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#%2B"
	><span class="hs-operator hs-var"
	  >+</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>1</span
	></span
      ><span
      >
</span
      ><span id="line-336"
      ></span
      ><span
      >                        </span
      ><span class="hs-keyword"
      >else</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074515"
	><span class="hs-identifier hs-var"
	  >neg</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-337"
      ></span
      ><span
      >                </span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-338"
      ></span
      ><span
      >         </span
      ><span class="hs-keyword"
      >in</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; BuiltinResult Value
forall a. a -&gt; BuiltinResult a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#pure"
	><span class="hs-identifier hs-var"
	  >pure</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Value -&gt; BuiltinResult Value) -&gt; Value -&gt; BuiltinResult Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; IntMap Int -&gt; Int -&gt; Int -&gt; Value
</span
	><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-var"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074530"
	><span class="hs-identifier hs-var"
	  >outer'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int
</span
	><a href="#local-6989586621682074547"
	><span class="hs-identifier hs-var"
	  >sizes'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074548"
	><span class="hs-identifier hs-var"
	  >total'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074549"
	><span class="hs-identifier hs-var"
	  >neg'</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-339"
      ></span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#insertCoin"
	><span class="hs-pragma hs-type"
	  >insertCoin</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-340"
      ></span
      ><span
      >
</span
      ><span id="line-341"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>-- | \(O(\log \max(m, k))\)</span
	></span
      ><span
      >
</span
      ><span id="line-342"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#deleteCoin"
	><span class="hs-identifier hs-type"
	  >deleteCoin</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/bytestring-0.11.5.4/docs/src/Data.ByteString.Internal.Type.html#ByteString"
	><span class="hs-identifier hs-type"
	  >ByteString</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/bytestring-0.11.5.4/docs/src/Data.ByteString.Internal.Type.html#ByteString"
	><span class="hs-identifier hs-type"
	  >ByteString</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-343"
      ></span
      ><span id="deleteCoin"
      ><span class="annot"
	><span class="annottext"
	  >deleteCoin :: ByteString -&gt; ByteString -&gt; Value -&gt; Value
</span
	  ><a href="PlutusCore.Value.html#deleteCoin"
	  ><span class="hs-identifier hs-var hs-var"
	    >deleteCoin</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; K
</span
	><a href="PlutusCore.Value.html#UnsafeK"
	><span class="hs-identifier hs-var"
	  >UnsafeK</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span id="local-6989586621682074553"
      ><span class="annot"
	><span class="annottext"
	  >K
</span
	  ><a href="#local-6989586621682074553"
	  ><span class="hs-identifier hs-var"
	    >currency</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; K
</span
	><a href="PlutusCore.Value.html#UnsafeK"
	><span class="hs-identifier hs-var"
	  >UnsafeK</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span id="local-6989586621682074554"
      ><span class="annot"
	><span class="annottext"
	  >K
</span
	  ><a href="#local-6989586621682074554"
	  ><span class="hs-identifier hs-var"
	    >token</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074555"
      ><span class="annot"
	><span class="annottext"
	  >NestedMap
</span
	  ><a href="#local-6989586621682074555"
	  ><span class="hs-identifier hs-var"
	    >outer</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074556"
      ><span class="annot"
	><span class="annottext"
	  >IntMap Int
</span
	  ><a href="#local-6989586621682074556"
	  ><span class="hs-identifier hs-var"
	    >sizes</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074557"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074557"
	  ><span class="hs-identifier hs-var"
	    >total</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074558"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074558"
	  ><span class="hs-identifier hs-var"
	    >neg</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      >
</span
      ><span id="line-344"
      ></span
      ><span
      >  </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; IntMap Int -&gt; Int -&gt; Int -&gt; Value
</span
	><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-var"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074559"
	><span class="hs-identifier hs-var"
	  >outer'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int
</span
	><a href="#local-6989586621682074560"
	><span class="hs-identifier hs-var"
	  >sizes'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074561"
	><span class="hs-identifier hs-var"
	  >total'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074562"
	><span class="hs-identifier hs-var"
	  >neg'</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-345"
      ></span
      ><span
      >  </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-346"
      ></span
      ><span
      >    </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074565"
      ><span class="annot"
	><span class="annottext"
	  >Maybe (Int, Quantity)
</span
	  ><a href="#local-6989586621682074565"
	  ><span class="hs-identifier hs-var"
	    >mold</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074559"
      ><span class="annot"
	><span class="annottext"
	  >NestedMap
</span
	  ><a href="#local-6989586621682074559"
	  ><span class="hs-identifier hs-var"
	    >outer'</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Maybe (Map K Quantity)
 -&gt; (Maybe (Int, Quantity), Maybe (Map K Quantity)))
-&gt; K -&gt; NestedMap -&gt; (Maybe (Int, Quantity), NestedMap)
forall (f :: * -&gt; *) k a.
(Functor f, Ord k) =&gt;
(Maybe a -&gt; f (Maybe a)) -&gt; k -&gt; Map k a -&gt; f (Map k a)
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Strict.Internal.html#alterF"
	><span class="hs-identifier hs-var"
	  >Map.alterF</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe (Map K Quantity)
-&gt; (Maybe (Int, Quantity), Maybe (Map K Quantity))
</span
	><a href="#local-6989586621682074566"
	><span class="hs-identifier hs-var"
	  >f</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><a href="#local-6989586621682074553"
	><span class="hs-identifier hs-var"
	  >currency</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074555"
	><span class="hs-identifier hs-var"
	  >outer</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-347"
      ></span
      ><span
      >    </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074560"
      ><span class="annot"
	><span class="annottext"
	  >IntMap Int
</span
	  ><a href="#local-6989586621682074560"
	  ><span class="hs-identifier hs-var"
	    >sizes'</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074561"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074561"
	  ><span class="hs-identifier hs-var"
	    >total'</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074562"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074562"
	  ><span class="hs-identifier hs-var"
	    >neg'</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-keyword"
      >case</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe (Int, Quantity)
</span
	><a href="#local-6989586621682074565"
	><span class="hs-identifier hs-var"
	  >mold</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >of</span
      ><span
      >
</span
      ><span id="line-348"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-type"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074574"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074574"
	  ><span class="hs-identifier hs-var"
	    >oldSize</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074575"
      ><span class="annot"
	><span class="annottext"
	  >Quantity
</span
	  ><a href="#local-6989586621682074575"
	  ><span class="hs-identifier hs-var"
	    >oldQuantity</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      >
</span
      ><span id="line-349"
      ></span
      ><span
      >        </span
      ><span class="hs-special"
      >(</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; IntMap Int -&gt; IntMap Int
</span
	><a href="PlutusCore.Value.html#updateSizes"
	><span class="hs-identifier hs-var"
	  >updateSizes</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074574"
	><span class="hs-identifier hs-var"
	  >oldSize</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074574"
	><span class="hs-identifier hs-var"
	  >oldSize</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#-"
	><span class="hs-glyph hs-var"
	  >-</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>1</span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int
</span
	><a href="#local-6989586621682074556"
	><span class="hs-identifier hs-var"
	  >sizes</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-350"
      ></span
      ><span
      >        </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074557"
	><span class="hs-identifier hs-var"
	  >total</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#-"
	><span class="hs-glyph hs-var"
	  >-</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>1</span
	></span
      ><span
      >
</span
      ><span id="line-351"
      ></span
      ><span
      >        </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="hs-keyword"
      >if</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074575"
	><span class="hs-identifier hs-var"
	  >oldQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Quantity -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3C"
	><span class="hs-operator hs-var"
	  >&lt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="PlutusCore.Value.html#zeroQuantity"
	><span class="hs-identifier hs-var"
	  >zeroQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >then</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074558"
	><span class="hs-identifier hs-var"
	  >neg</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#-"
	><span class="hs-glyph hs-var"
	  >-</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>1</span
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >else</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074558"
	><span class="hs-identifier hs-var"
	  >neg</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-352"
      ></span
      ><span
      >        </span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-353"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe (Int, Quantity)
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int
</span
	><a href="#local-6989586621682074556"
	><span class="hs-identifier hs-var"
	  >sizes</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074557"
	><span class="hs-identifier hs-var"
	  >total</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074558"
	><span class="hs-identifier hs-var"
	  >neg</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-354"
      ></span
      ><span
      >    </span
      ><span class="annot"
      ><a href="#local-6989586621682074566"
	><span class="hs-identifier hs-type"
	  >f</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-355"
      ></span
      ><span
      >      </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Maybe"
	><span class="hs-identifier hs-type"
	  >Maybe</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#Map"
	><span class="hs-identifier hs-type"
	  >Map</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier hs-type"
	  >K</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-356"
      ></span
      ><span
      >      </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span
      > </span
      ><span class="hs-comment"
      >-- Just (old size of inner map, old quantity) if the total size shrinks by 1,</span
      ><span
      >
</span
      ><span id="line-357"
      ></span
      ><span
      >           </span
      ><span class="hs-comment"
      >-- otherwise Nothing</span
      ><span
      >
</span
      ><span id="line-358"
      ></span
      ><span
      >           </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Maybe"
	><span class="hs-identifier hs-type"
	  >Maybe</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-359"
      ></span
      ><span
      >         </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Maybe"
	><span class="hs-identifier hs-type"
	  >Maybe</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#Map"
	><span class="hs-identifier hs-type"
	  >Map</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier hs-type"
	  >K</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-360"
      ></span
      ><span
      >         </span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-361"
      ></span
      ><span
      >    </span
      ><span id="local-6989586621682074566"
      ><span class="annot"
	><span class="annottext"
	  >f :: Maybe (Map K Quantity)
-&gt; (Maybe (Int, Quantity), Maybe (Map K Quantity))
</span
	  ><a href="#local-6989586621682074566"
	  ><span class="hs-identifier hs-var hs-var"
	    >f</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-glyph"
      >\</span
      ><span class="hs-glyph"
      >case</span
      ><span
      >
</span
      ><span id="line-362"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe (Map K Quantity)
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Maybe (Int, Quantity)
forall a. Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe (Map K Quantity)
forall a. Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-363"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-type"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074576"
      ><span class="annot"
	><span class="annottext"
	  >Map K Quantity
</span
	  ><a href="#local-6989586621682074576"
	  ><span class="hs-identifier hs-var"
	    >inner</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      >
</span
      ><span id="line-364"
      ></span
      ><span
      >        </span
      ><span class="hs-keyword"
      >let</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074578"
      ><span class="annot"
	><span class="annottext"
	  >Maybe Quantity
</span
	  ><a href="#local-6989586621682074578"
	  ><span class="hs-identifier hs-var"
	    >qty</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074579"
      ><span class="annot"
	><span class="annottext"
	  >Map K Quantity
</span
	  ><a href="#local-6989586621682074579"
	  ><span class="hs-identifier hs-var"
	    >inner'</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(K -&gt; Quantity -&gt; Maybe Quantity)
-&gt; K -&gt; Map K Quantity -&gt; (Maybe Quantity, Map K Quantity)
forall k a.
Ord k =&gt;
(k -&gt; a -&gt; Maybe a) -&gt; k -&gt; Map k a -&gt; (Maybe a, Map k a)
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Strict.Internal.html#updateLookupWithKey"
	><span class="hs-identifier hs-var"
	  >Map.updateLookupWithKey</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="hs-glyph"
      >\</span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe Quantity
forall a. Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><a href="#local-6989586621682074554"
	><span class="hs-identifier hs-var"
	  >token</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity
</span
	><a href="#local-6989586621682074576"
	><span class="hs-identifier hs-var"
	  >inner</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-365"
      ></span
      ><span
      >         </span
      ><span class="hs-keyword"
      >in</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity -&gt; Int
forall k a. Map k a -&gt; Int
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#size"
	><span class="hs-identifier hs-var"
	  >Map.size</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity
</span
	><a href="#local-6989586621682074576"
	><span class="hs-identifier hs-var"
	  >inner</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Quantity -&gt; (Int, Quantity))
-&gt; Maybe Quantity -&gt; Maybe (Int, Quantity)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Functor.html#%3C%24%3E"
	><span class="hs-operator hs-var"
	  >&lt;$&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe Quantity
</span
	><a href="#local-6989586621682074578"
	><span class="hs-identifier hs-var"
	  >qty</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="hs-keyword"
      >if</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity -&gt; Bool
forall k a. Map k a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#null"
	><span class="hs-identifier hs-var"
	  >Map.null</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity
</span
	><a href="#local-6989586621682074579"
	><span class="hs-identifier hs-var"
	  >inner'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >then</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe (Map K Quantity)
forall a. Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >else</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity -&gt; Maybe (Map K Quantity)
forall a. a -&gt; Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-var"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity
</span
	><a href="#local-6989586621682074579"
	><span class="hs-identifier hs-var"
	  >inner'</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-366"
      ></span
      ><span
      >
</span
      ><span id="line-367"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>-- | \(O(\log \max(m, k))\)</span
	></span
      ><span
      >
</span
      ><span id="line-368"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#lookupCoin"
	><span class="hs-identifier hs-type"
	  >lookupCoin</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/bytestring-0.11.5.4/docs/src/Data.ByteString.Internal.Type.html#ByteString"
	><span class="hs-identifier hs-type"
	  >ByteString</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/bytestring-0.11.5.4/docs/src/Data.ByteString.Internal.Type.html#ByteString"
	><span class="hs-identifier hs-type"
	  >ByteString</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-bignum-1.3/docs/src/GHC.Num.Integer.html#Integer"
	><span class="hs-identifier hs-type"
	  >Integer</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-369"
      ></span
      ><span id="lookupCoin"
      ><span class="annot"
	><span class="annottext"
	  >lookupCoin :: ByteString -&gt; ByteString -&gt; Value -&gt; Integer
</span
	  ><a href="PlutusCore.Value.html#lookupCoin"
	  ><span class="hs-identifier hs-var hs-var"
	    >lookupCoin</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; K
</span
	><a href="PlutusCore.Value.html#UnsafeK"
	><span class="hs-identifier hs-var"
	  >UnsafeK</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span id="local-6989586621682074581"
      ><span class="annot"
	><span class="annottext"
	  >K
</span
	  ><a href="#local-6989586621682074581"
	  ><span class="hs-identifier hs-var"
	    >currency</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; K
</span
	><a href="PlutusCore.Value.html#UnsafeK"
	><span class="hs-identifier hs-var"
	  >UnsafeK</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span id="local-6989586621682074582"
      ><span class="annot"
	><span class="annottext"
	  >K
</span
	  ><a href="#local-6989586621682074582"
	  ><span class="hs-identifier hs-var"
	    >token</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; NestedMap
</span
	><a href="PlutusCore.Value.html#unpack"
	><span class="hs-identifier hs-var"
	  >unpack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span id="local-6989586621682074583"
      ><span class="annot"
	><span class="annottext"
	  >NestedMap
</span
	  ><a href="#local-6989586621682074583"
	  ><span class="hs-identifier hs-var"
	    >outer</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      >
</span
      ><span id="line-370"
      ></span
      ><span
      >  </span
      ><span class="hs-keyword"
      >case</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K -&gt; NestedMap -&gt; Maybe (Map K Quantity)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#lookup"
	><span class="hs-identifier hs-var"
	  >Map.lookup</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><a href="#local-6989586621682074581"
	><span class="hs-identifier hs-var"
	  >currency</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074583"
	><span class="hs-identifier hs-var"
	  >outer</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >of</span
      ><span
      >
</span
      ><span id="line-371"
      ></span
      ><span
      >    </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe (Map K Quantity)
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><span class="hs-number"
	>0</span
	></span
      ><span
      >
</span
      ><span id="line-372"
      ></span
      ><span
      >    </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-type"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074585"
      ><span class="annot"
	><span class="annottext"
	  >Map K Quantity
</span
	  ><a href="#local-6989586621682074585"
	  ><span class="hs-identifier hs-var"
	    >inner</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Integer
</span
	><a href="PlutusCore.Value.html#unQuantity"
	><span class="hs-identifier hs-var"
	  >unQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Quantity -&gt; Integer) -&gt; Quantity -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; K -&gt; Map K Quantity -&gt; Quantity
forall k a. Ord k =&gt; a -&gt; k -&gt; Map k a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Strict.Internal.html#findWithDefault"
	><span class="hs-identifier hs-var"
	  >Map.findWithDefault</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="PlutusCore.Value.html#zeroQuantity"
	><span class="hs-identifier hs-var"
	  >zeroQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><a href="#local-6989586621682074582"
	><span class="hs-identifier hs-var"
	  >token</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity
</span
	><a href="#local-6989586621682074585"
	><span class="hs-identifier hs-var"
	  >inner</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-373"
      ></span
      ><span
      >
</span
      ><span id="line-374"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>{-| \(O(n_{2}\log \max(m_{1}, k_{1}))\), where \(n_{2}\) is the total size of the second
`Value`, \(m_{1}\) is the size of the outer map in the first `Value` and \(k_{1}\) is
the size of the largest inner map in the first `Value`.

@a@ contains @b@ if for each @(currency, token, quantity)@ in @b@,
@lookup currency token a &gt;= quantity@.

Both values must not contain negative amounts. -}</span
	></span
      ><span
      >
</span
      ><span id="line-382"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#valueContains"
	><span class="hs-identifier hs-type"
	  >valueContains</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Builtin.Result.html#BuiltinResult"
	><span class="hs-identifier hs-type"
	  >BuiltinResult</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Bool"
	><span class="hs-identifier hs-type"
	  >Bool</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-383"
      ></span
      ><span id="valueContains"
      ><span class="annot"
	><span class="annottext"
	  >valueContains :: Value -&gt; Value -&gt; BuiltinResult Bool
</span
	  ><a href="PlutusCore.Value.html#valueContains"
	  ><span class="hs-identifier hs-var hs-var"
	    >valueContains</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074587"
      ><span class="annot"
	><span class="annottext"
	  >Value
</span
	  ><a href="#local-6989586621682074587"
	  ><span class="hs-identifier hs-var"
	    >v1</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074588"
      ><span class="annot"
	><span class="annottext"
	  >Value
</span
	  ><a href="#local-6989586621682074588"
	  ><span class="hs-identifier hs-var"
	    >v2</span
	    ></a
	  ></span
	></span
      ><span
      >
</span
      ><span id="line-384"
      ></span
      ><span
      >  </span
      ><span class="hs-glyph"
      >|</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; Int
</span
	><a href="PlutusCore.Value.html#negativeAmounts"
	><span class="hs-identifier hs-var"
	  >negativeAmounts</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="#local-6989586621682074587"
	><span class="hs-identifier hs-var"
	  >v1</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3E"
	><span class="hs-operator hs-var"
	  >&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>0</span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; BuiltinResult Bool
forall a. String -&gt; BuiltinResult a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;valueContains: first value contains negative amounts&quot;</span
	></span
      ><span
      >
</span
      ><span id="line-385"
      ></span
      ><span
      >  </span
      ><span class="hs-glyph"
      >|</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; Int
</span
	><a href="PlutusCore.Value.html#negativeAmounts"
	><span class="hs-identifier hs-var"
	  >negativeAmounts</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="#local-6989586621682074588"
	><span class="hs-identifier hs-var"
	  >v2</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3E"
	><span class="hs-operator hs-var"
	  >&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>0</span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; BuiltinResult Bool
forall a. String -&gt; BuiltinResult a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;valueContains: second value contains negative amounts&quot;</span
	></span
      ><span
      >
</span
      ><span id="line-386"
      ></span
      ><span
      >  </span
      ><span class="hs-glyph"
      >|</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; Int
</span
	><a href="PlutusCore.Value.html#totalSize"
	><span class="hs-identifier hs-var"
	  >totalSize</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="#local-6989586621682074587"
	><span class="hs-identifier hs-var"
	  >v1</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3C"
	><span class="hs-operator hs-var"
	  >&lt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; Int
</span
	><a href="PlutusCore.Value.html#totalSize"
	><span class="hs-identifier hs-var"
	  >totalSize</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="#local-6989586621682074588"
	><span class="hs-identifier hs-var"
	  >v2</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Bool -&gt; BuiltinResult Bool
forall a. a -&gt; BuiltinResult a
</span
	><a href="PlutusCore.Builtin.Result.html#BuiltinSuccess"
	><span class="hs-identifier hs-var"
	  >BuiltinSuccess</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#False"
	><span class="hs-identifier hs-var"
	  >False</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-387"
      ></span
      ><span
      >  </span
      ><span class="hs-comment"
      >-- \^ v2 is too big to be contained in v1: `isSubmapOfBy` has a similar check,</span
      ><span
      >
</span
      ><span id="line-388"
      ></span
      ><span
      >  </span
      ><span class="hs-comment"
      >-- but that only applies to the top-level structure of the map, so v1 can</span
      ><span
      >
</span
      ><span id="line-389"
      ></span
      ><span
      >  </span
      ><span class="hs-comment"
      >-- have a larger outer map than v2 but a smaller number of total entries, and</span
      ><span
      >
</span
      ><span id="line-390"
      ></span
      ><span
      >  </span
      ><span class="hs-comment"
      >-- without this check the outer call of `isSubmapOfBy` would carry on and</span
      ><span
      >
</span
      ><span id="line-391"
      ></span
      ><span
      >  </span
      ><span class="hs-comment"
      >-- compare the inner maps even though v2 can't fit inside v1.</span
      ><span
      >
</span
      ><span id="line-392"
      ></span
      ><span
      >  </span
      ><span class="hs-glyph"
      >|</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Bool
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#otherwise"
	><span class="hs-identifier hs-var"
	  >otherwise</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Bool -&gt; BuiltinResult Bool
forall a. a -&gt; BuiltinResult a
</span
	><a href="PlutusCore.Builtin.Result.html#BuiltinSuccess"
	><span class="hs-identifier hs-var"
	  >BuiltinSuccess</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Bool -&gt; BuiltinResult Bool) -&gt; Bool -&gt; BuiltinResult Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Map K Quantity -&gt; Map K Quantity -&gt; Bool)
-&gt; NestedMap -&gt; NestedMap -&gt; Bool
forall k a b.
Ord k =&gt;
(a -&gt; b -&gt; Bool) -&gt; Map k a -&gt; Map k b -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#isSubmapOfBy"
	><span class="hs-identifier hs-var"
	  >Map.isSubmapOfBy</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>(Quantity -&gt; Quantity -&gt; Bool)
-&gt; Map K Quantity -&gt; Map K Quantity -&gt; Bool
forall k a b.
Ord k =&gt;
(a -&gt; b -&gt; Bool) -&gt; Map k a -&gt; Map k b -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#isSubmapOfBy"
	><span class="hs-identifier hs-var"
	  >Map.isSubmapOfBy</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Quantity -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3C%3D"
	><span class="hs-operator hs-var"
	  >(&lt;=)</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; NestedMap
</span
	><a href="PlutusCore.Value.html#unpack"
	><span class="hs-identifier hs-var"
	  >unpack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="#local-6989586621682074588"
	><span class="hs-identifier hs-var"
	  >v2</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; NestedMap
</span
	><a href="PlutusCore.Value.html#unpack"
	><span class="hs-identifier hs-var"
	  >unpack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="#local-6989586621682074587"
	><span class="hs-identifier hs-var"
	  >v1</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-393"
      ></span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#valueContains"
	><span class="hs-pragma hs-type"
	  >valueContains</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-394"
      ></span
      ><span
      >
</span
      ><span id="line-395"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>{-| \(O(n_{1}) + O(n_{2})\), where \(n_{1}\) and \(n_{2}\) are the total sizes
(i.e., sum of inner map sizes) of the two maps.

Shortcircuits if either value is empty.

Since 'unionValue' is commutative, we switch the arguments whenever the second
value is larger in total size than the first one. We have found through experimentation
that this results in better performance in practice. -}</span
	></span
      ><span
      >
</span
      ><span id="line-403"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#unionValue"
	><span class="hs-identifier hs-type"
	  >unionValue</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Builtin.Result.html#BuiltinResult"
	><span class="hs-identifier hs-type"
	  >BuiltinResult</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-404"
      ></span
      ><span id="unionValue"
      ><span class="annot"
	><span class="annottext"
	  >unionValue :: Value -&gt; Value -&gt; BuiltinResult Value
</span
	  ><a href="PlutusCore.Value.html#unionValue"
	  ><span class="hs-identifier hs-var hs-var"
	    >unionValue</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074591"
      ><span class="annot"
	><span class="annottext"
	  >Value
</span
	  ><a href="#local-6989586621682074591"
	  ><span class="hs-identifier hs-var"
	    >vA</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074592"
      ><span class="annot"
	><span class="annottext"
	  >Value
</span
	  ><a href="#local-6989586621682074592"
	  ><span class="hs-identifier hs-var"
	    >vB</span
	    ></a
	  ></span
	></span
      ><span
      >
</span
      ><span id="line-405"
      ></span
      ><span
      >  </span
      ><span class="hs-glyph"
      >|</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; Int
</span
	><a href="PlutusCore.Value.html#totalSize"
	><span class="hs-identifier hs-var"
	  >totalSize</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="#local-6989586621682074591"
	><span class="hs-identifier hs-var"
	  >vA</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3D%3D"
	><span class="hs-operator hs-var"
	  >==</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>0</span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; BuiltinResult Value
forall a. a -&gt; BuiltinResult a
</span
	><a href="PlutusCore.Builtin.Result.html#BuiltinSuccess"
	><span class="hs-identifier hs-var"
	  >BuiltinSuccess</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="#local-6989586621682074592"
	><span class="hs-identifier hs-var"
	  >vB</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-406"
      ></span
      ><span
      >  </span
      ><span class="hs-glyph"
      >|</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; Int
</span
	><a href="PlutusCore.Value.html#totalSize"
	><span class="hs-identifier hs-var"
	  >totalSize</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="#local-6989586621682074592"
	><span class="hs-identifier hs-var"
	  >vB</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3D%3D"
	><span class="hs-operator hs-var"
	  >==</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>0</span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; BuiltinResult Value
forall a. a -&gt; BuiltinResult a
</span
	><a href="PlutusCore.Builtin.Result.html#BuiltinSuccess"
	><span class="hs-identifier hs-var"
	  >BuiltinSuccess</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="#local-6989586621682074591"
	><span class="hs-identifier hs-var"
	  >vA</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-407"
      ></span
      ><span
      >  </span
      ><span class="hs-glyph"
      >|</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Bool
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#otherwise"
	><span class="hs-identifier hs-var"
	  >otherwise</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      >
</span
      ><span id="line-408"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; Value
</span
	><a href="PlutusCore.Value.html#pack%27"
	><span class="hs-identifier hs-var"
	  >pack'</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-409"
      ></span
      ><span
      >        </span
      ><span class="annot"
      ><span class="annottext"
	>(NestedMap -&gt; Value)
-&gt; BuiltinResult NestedMap -&gt; BuiltinResult Value
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Functor.html#%3C%24%3E"
	><span class="hs-operator hs-var"
	  >&lt;$&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>WhenMissing BuiltinResult K (Map K Quantity) (Map K Quantity)
-&gt; WhenMissing BuiltinResult K (Map K Quantity) (Map K Quantity)
-&gt; WhenMatched
     BuiltinResult K (Map K Quantity) (Map K Quantity) (Map K Quantity)
-&gt; NestedMap
-&gt; NestedMap
-&gt; BuiltinResult NestedMap
forall (f :: * -&gt; *) k a c b.
(Applicative f, Ord k) =&gt;
WhenMissing f k a c
-&gt; WhenMissing f k b c
-&gt; WhenMatched f k a b c
-&gt; Map k a
-&gt; Map k b
-&gt; f (Map k c)
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#mergeA"
	><span class="hs-identifier hs-var"
	  >M.mergeA</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-410"
      ></span
      ><span
      >          </span
      ><span class="annot"
      ><span class="annottext"
	>WhenMissing BuiltinResult K (Map K Quantity) (Map K Quantity)
forall (f :: * -&gt; *) k x. Applicative f =&gt; WhenMissing f k x x
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#preserveMissing"
	><span class="hs-identifier hs-var"
	  >M.preserveMissing</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-411"
      ></span
      ><span
      >          </span
      ><span class="annot"
      ><span class="annottext"
	>WhenMissing BuiltinResult K (Map K Quantity) (Map K Quantity)
forall (f :: * -&gt; *) k x. Applicative f =&gt; WhenMissing f k x x
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#preserveMissing"
	><span class="hs-identifier hs-var"
	  >M.preserveMissing</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-412"
      ></span
      ><span
      >          </span
      ><span class="hs-special"
      >(</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(K
 -&gt; Map K Quantity
 -&gt; Map K Quantity
 -&gt; BuiltinResult (Maybe (Map K Quantity)))
-&gt; WhenMatched
     BuiltinResult K (Map K Quantity) (Map K Quantity) (Map K Quantity)
forall (f :: * -&gt; *) k x y z.
Applicative f =&gt;
(k -&gt; x -&gt; y -&gt; f (Maybe z)) -&gt; WhenMatched f k x y z
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Strict.Internal.html#zipWithMaybeAMatched"
	><span class="hs-identifier hs-var"
	  >M.zipWithMaybeAMatched</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >\</span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074596"
      ><span class="annot"
	><span class="annottext"
	  >Map K Quantity
</span
	  ><a href="#local-6989586621682074596"
	  ><span class="hs-identifier hs-var"
	    >innerA</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074597"
      ><span class="annot"
	><span class="annottext"
	  >Map K Quantity
</span
	  ><a href="#local-6989586621682074597"
	  ><span class="hs-identifier hs-var"
	    >innerB</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      >
</span
      ><span id="line-413"
      ></span
      ><span
      >              </span
      ><span class="annot"
      ><span class="annottext"
	>(Map K Quantity -&gt; Maybe (Map K Quantity))
-&gt; BuiltinResult (Map K Quantity)
-&gt; BuiltinResult (Maybe (Map K Quantity))
forall a b. (a -&gt; b) -&gt; BuiltinResult a -&gt; BuiltinResult b
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#fmap"
	><span class="hs-identifier hs-var"
	  >fmap</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="hs-glyph"
      >\</span
      ><span id="local-6989586621682074598"
      ><span class="annot"
	><span class="annottext"
	  >Map K Quantity
</span
	  ><a href="#local-6989586621682074598"
	  ><span class="hs-identifier hs-var"
	    >inner</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="hs-keyword"
      >if</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity -&gt; Bool
forall k a. Map k a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#null"
	><span class="hs-identifier hs-var"
	  >Map.null</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity
</span
	><a href="#local-6989586621682074598"
	><span class="hs-identifier hs-var"
	  >inner</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >then</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe (Map K Quantity)
forall a. Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >else</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity -&gt; Maybe (Map K Quantity)
forall a. a -&gt; Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-var"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity
</span
	><a href="#local-6989586621682074598"
	><span class="hs-identifier hs-var"
	  >inner</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(BuiltinResult (Map K Quantity)
 -&gt; BuiltinResult (Maybe (Map K Quantity)))
-&gt; BuiltinResult (Map K Quantity)
-&gt; BuiltinResult (Maybe (Map K Quantity))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-414"
      ></span
      ><span
      >                </span
      ><span class="annot"
      ><span class="annottext"
	>WhenMissing BuiltinResult K Quantity Quantity
-&gt; WhenMissing BuiltinResult K Quantity Quantity
-&gt; WhenMatched BuiltinResult K Quantity Quantity Quantity
-&gt; Map K Quantity
-&gt; Map K Quantity
-&gt; BuiltinResult (Map K Quantity)
forall (f :: * -&gt; *) k a c b.
(Applicative f, Ord k) =&gt;
WhenMissing f k a c
-&gt; WhenMissing f k b c
-&gt; WhenMatched f k a b c
-&gt; Map k a
-&gt; Map k b
-&gt; f (Map k c)
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#mergeA"
	><span class="hs-identifier hs-var"
	  >M.mergeA</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-415"
      ></span
      ><span
      >                  </span
      ><span class="annot"
      ><span class="annottext"
	>WhenMissing BuiltinResult K Quantity Quantity
forall (f :: * -&gt; *) k x. Applicative f =&gt; WhenMissing f k x x
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#preserveMissing"
	><span class="hs-identifier hs-var"
	  >M.preserveMissing</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-416"
      ></span
      ><span
      >                  </span
      ><span class="annot"
      ><span class="annottext"
	>WhenMissing BuiltinResult K Quantity Quantity
forall (f :: * -&gt; *) k x. Applicative f =&gt; WhenMissing f k x x
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#preserveMissing"
	><span class="hs-identifier hs-var"
	  >M.preserveMissing</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-417"
      ></span
      ><span
      >                  </span
      ><span class="hs-special"
      >(</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(K -&gt; Quantity -&gt; Quantity -&gt; BuiltinResult (Maybe Quantity))
-&gt; WhenMatched BuiltinResult K Quantity Quantity Quantity
forall (f :: * -&gt; *) k x y z.
Applicative f =&gt;
(k -&gt; x -&gt; y -&gt; f (Maybe z)) -&gt; WhenMatched f k x y z
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Strict.Internal.html#zipWithMaybeAMatched"
	><span class="hs-identifier hs-var"
	  >M.zipWithMaybeAMatched</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >\</span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074599"
      ><span class="annot"
	><span class="annottext"
	  >Quantity
</span
	  ><a href="#local-6989586621682074599"
	  ><span class="hs-identifier hs-var"
	    >x</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074600"
      ><span class="annot"
	><span class="annottext"
	  >Quantity
</span
	  ><a href="#local-6989586621682074600"
	  ><span class="hs-identifier hs-var"
	    >y</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      >
</span
      ><span id="line-418"
      ></span
      ><span
      >                      </span
      ><span class="hs-keyword"
      >case</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Quantity -&gt; Maybe Quantity
</span
	><a href="PlutusCore.Value.html#addQuantity"
	><span class="hs-identifier hs-var"
	  >addQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074599"
	><span class="hs-identifier hs-var"
	  >x</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074600"
	><span class="hs-identifier hs-var"
	  >y</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >of</span
      ><span
      >
</span
      ><span id="line-419"
      ></span
      ><span
      >                        </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-type"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074601"
      ><span class="annot"
	><span class="annottext"
	  >Quantity
</span
	  ><a href="#local-6989586621682074601"
	  ><span class="hs-identifier hs-var"
	    >z</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe Quantity -&gt; BuiltinResult (Maybe Quantity)
forall a. a -&gt; BuiltinResult a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#pure"
	><span class="hs-identifier hs-var"
	  >pure</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >if</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074601"
	><span class="hs-identifier hs-var"
	  >z</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Quantity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3D%3D"
	><span class="hs-operator hs-var"
	  >==</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="PlutusCore.Value.html#zeroQuantity"
	><span class="hs-identifier hs-var"
	  >zeroQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >then</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe Quantity
forall a. Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >else</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Maybe Quantity
forall a. a -&gt; Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-var"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074601"
	><span class="hs-identifier hs-var"
	  >z</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-420"
      ></span
      ><span
      >                        </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe Quantity
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      >
</span
      ><span id="line-421"
      ></span
      ><span
      >                          </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; BuiltinResult (Maybe Quantity)
forall a. String -&gt; BuiltinResult a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;unionValue: quantity is out of the signed 128-bit integer bounds&quot;</span
	></span
      ><span
      >
</span
      ><span id="line-422"
      ></span
      ><span
      >                  </span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-423"
      ></span
      ><span
      >                  </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity
</span
	><a href="#local-6989586621682074596"
	><span class="hs-identifier hs-var"
	  >innerA</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-424"
      ></span
      ><span
      >                  </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity
</span
	><a href="#local-6989586621682074597"
	><span class="hs-identifier hs-var"
	  >innerB</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-425"
      ></span
      ><span
      >          </span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-426"
      ></span
      ><span
      >          </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074602"
	><span class="hs-identifier hs-var"
	  >v1</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-427"
      ></span
      ><span
      >          </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074603"
	><span class="hs-identifier hs-var"
	  >v2</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-428"
      ></span
      ><span
      >  </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-429"
      ></span
      ><span
      >    </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074602"
      ><span class="annot"
	><span class="annottext"
	  >NestedMap
</span
	  ><a href="#local-6989586621682074602"
	  ><span class="hs-identifier hs-var"
	    >v1</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074603"
      ><span class="annot"
	><span class="annottext"
	  >NestedMap
</span
	  ><a href="#local-6989586621682074603"
	  ><span class="hs-identifier hs-var"
	    >v2</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      >
</span
      ><span id="line-430"
      ></span
      ><span
      >      </span
      ><span class="hs-keyword"
      >if</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; Int
</span
	><a href="PlutusCore.Value.html#totalSize"
	><span class="hs-identifier hs-var"
	  >totalSize</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="#local-6989586621682074592"
	><span class="hs-identifier hs-var"
	  >vB</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3E"
	><span class="hs-operator hs-var"
	  >&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; Int
</span
	><a href="PlutusCore.Value.html#totalSize"
	><span class="hs-identifier hs-var"
	  >totalSize</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="#local-6989586621682074591"
	><span class="hs-identifier hs-var"
	  >vA</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-431"
      ></span
      ><span
      >        </span
      ><span class="hs-keyword"
      >then</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; NestedMap
</span
	><a href="PlutusCore.Value.html#unpack"
	><span class="hs-identifier hs-var"
	  >unpack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="#local-6989586621682074592"
	><span class="hs-identifier hs-var"
	  >vB</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; NestedMap
</span
	><a href="PlutusCore.Value.html#unpack"
	><span class="hs-identifier hs-var"
	  >unpack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="#local-6989586621682074591"
	><span class="hs-identifier hs-var"
	  >vA</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-432"
      ></span
      ><span
      >        </span
      ><span class="hs-keyword"
      >else</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; NestedMap
</span
	><a href="PlutusCore.Value.html#unpack"
	><span class="hs-identifier hs-var"
	  >unpack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="#local-6989586621682074591"
	><span class="hs-identifier hs-var"
	  >vA</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; NestedMap
</span
	><a href="PlutusCore.Value.html#unpack"
	><span class="hs-identifier hs-var"
	  >unpack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="#local-6989586621682074592"
	><span class="hs-identifier hs-var"
	  >vB</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-433"
      ></span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#unionValue"
	><span class="hs-pragma hs-type"
	  >unionValue</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-434"
      ></span
      ><span
      >
</span
      ><span id="line-435"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#valueDataMaxSize"
	><span class="hs-identifier hs-type"
	  >valueDataMaxSize</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-436"
      ></span
      ><span id="valueDataMaxSize"
      ><span class="annot"
	><span class="annottext"
	  >valueDataMaxSize :: Int
</span
	  ><a href="PlutusCore.Value.html#valueDataMaxSize"
	  ><span class="hs-identifier hs-var hs-var"
	    >valueDataMaxSize</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>40000</span
	></span
      ><span
      >
</span
      ><span id="line-437"
      ></span
      ><span
      >
</span
      ><span id="line-438"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>{-| \(O(n)\). Encodes `Value` as `Data`, in the same way as non-builtin @Value@.
This is the denotation of @ValueData@ in Plutus V1, V2 and V3. -}</span
	></span
      ><span
      >
</span
      ><span id="line-440"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#valueData"
	><span class="hs-identifier hs-type"
	  >valueData</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Builtin.Result.html#BuiltinResult"
	><span class="hs-identifier hs-type"
	  >BuiltinResult</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Data.html#Data"
	><span class="hs-identifier hs-type"
	  >Data</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-441"
      ></span
      ><span id="valueData"
      ><span class="annot"
	><span class="annottext"
	  >valueData :: Value -&gt; BuiltinResult Data
</span
	  ><a href="PlutusCore.Value.html#valueData"
	  ><span class="hs-identifier hs-var hs-var"
	    >valueData</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074606"
      ><span class="annot"
	><span class="annottext"
	  >Value
</span
	  ><a href="#local-6989586621682074606"
	  ><span class="hs-identifier hs-var"
	    >v</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      >
</span
      ><span id="line-442"
      ></span
      ><span
      >  </span
      ><span class="hs-keyword"
      >if</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; Int
</span
	><a href="PlutusCore.Value.html#totalSize"
	><span class="hs-identifier hs-var"
	  >totalSize</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="#local-6989586621682074606"
	><span class="hs-identifier hs-var"
	  >v</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3C%3D"
	><span class="hs-operator hs-var"
	  >&lt;=</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="PlutusCore.Value.html#valueDataMaxSize"
	><span class="hs-identifier hs-var"
	  >valueDataMaxSize</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-443"
      ></span
      ><span
      >    </span
      ><span class="hs-keyword"
      >then</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Data -&gt; BuiltinResult Data
forall a. a -&gt; BuiltinResult a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#pure"
	><span class="hs-identifier hs-var"
	  >pure</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Data -&gt; BuiltinResult Data) -&gt; Data -&gt; BuiltinResult Data
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(Data, Data)] -&gt; Data
</span
	><a href="PlutusCore.Data.html#Map"
	><span class="hs-identifier hs-var"
	  >Map</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>([(Data, Data)] -&gt; Data)
-&gt; (Value -&gt; [(Data, Data)]) -&gt; Value -&gt; Data
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>((K, Map K Quantity) -&gt; (Data, Data))
-&gt; [(K, Map K Quantity)] -&gt; [(Data, Data)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#fmap"
	><span class="hs-identifier hs-var"
	  >fmap</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>(K -&gt; Data)
-&gt; (Map K Quantity -&gt; Data) -&gt; (K, Map K Quantity) -&gt; (Data, Data)
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; (a, c) -&gt; (b, d)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Bifunctor.html#bimap"
	><span class="hs-identifier hs-var"
	  >bimap</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; Data
</span
	><a href="PlutusCore.Data.html#B"
	><span class="hs-identifier hs-var"
	  >B</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(ByteString -&gt; Data) -&gt; (K -&gt; ByteString) -&gt; K -&gt; Data
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K -&gt; ByteString
</span
	><a href="PlutusCore.Value.html#unK"
	><span class="hs-identifier hs-var"
	  >unK</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity -&gt; Data
</span
	><a href="#local-6989586621682074609"
	><span class="hs-identifier hs-var"
	  >tokensData</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>([(K, Map K Quantity)] -&gt; [(Data, Data)])
-&gt; (Value -&gt; [(K, Map K Quantity)]) -&gt; Value -&gt; [(Data, Data)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; [(K, Map K Quantity)]
forall k a. Map k a -&gt; [(k, a)]
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#toList"
	><span class="hs-identifier hs-var"
	  >Map.toList</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(NestedMap -&gt; [(K, Map K Quantity)])
-&gt; (Value -&gt; NestedMap) -&gt; Value -&gt; [(K, Map K Quantity)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; NestedMap
</span
	><a href="PlutusCore.Value.html#unpack"
	><span class="hs-identifier hs-var"
	  >unpack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Value -&gt; Data) -&gt; Value -&gt; Data
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="#local-6989586621682074606"
	><span class="hs-identifier hs-var"
	  >v</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-444"
      ></span
      ><span
      >    </span
      ><span class="hs-keyword"
      >else</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; BuiltinResult Data
forall a. String -&gt; BuiltinResult a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(String -&gt; BuiltinResult Data) -&gt; String -&gt; BuiltinResult Data
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;valueData: maximum input size (&quot;</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%2B%2B"
	><span class="hs-operator hs-var"
	  >++</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Show.html#show"
	><span class="hs-identifier hs-var"
	  >show</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="PlutusCore.Value.html#valueDataMaxSize"
	><span class="hs-identifier hs-var"
	  >valueDataMaxSize</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; ShowS
forall a. [a] -&gt; [a] -&gt; [a]
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%2B%2B"
	><span class="hs-operator hs-var"
	  >++</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;) exceeded&quot;</span
	></span
      ><span
      >
</span
      ><span id="line-445"
      ></span
      ><span
      >  </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-446"
      ></span
      ><span
      >    </span
      ><span class="annot"
      ><a href="#local-6989586621682074609"
	><span class="hs-identifier hs-type"
	  >tokensData</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#Map"
	><span class="hs-identifier hs-type"
	  >Map</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier hs-type"
	  >K</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Data.html#Data"
	><span class="hs-identifier hs-type"
	  >Data</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-447"
      ></span
      ><span
      >    </span
      ><span id="local-6989586621682074609"
      ><span class="annot"
	><span class="annottext"
	  >tokensData :: Map K Quantity -&gt; Data
</span
	  ><a href="#local-6989586621682074609"
	  ><span class="hs-identifier hs-var hs-var"
	    >tokensData</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(Data, Data)] -&gt; Data
</span
	><a href="PlutusCore.Data.html#Map"
	><span class="hs-identifier hs-var"
	  >Map</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>([(Data, Data)] -&gt; Data)
-&gt; (Map K Quantity -&gt; [(Data, Data)]) -&gt; Map K Quantity -&gt; Data
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>((K, Quantity) -&gt; (Data, Data))
-&gt; [(K, Quantity)] -&gt; [(Data, Data)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#fmap"
	><span class="hs-identifier hs-var"
	  >fmap</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>(K -&gt; Data) -&gt; (Quantity -&gt; Data) -&gt; (K, Quantity) -&gt; (Data, Data)
forall a b c d. (a -&gt; b) -&gt; (c -&gt; d) -&gt; (a, c) -&gt; (b, d)
forall (p :: * -&gt; * -&gt; *) a b c d.
Bifunctor p =&gt;
(a -&gt; b) -&gt; (c -&gt; d) -&gt; p a c -&gt; p b d
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Bifunctor.html#bimap"
	><span class="hs-identifier hs-var"
	  >bimap</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; Data
</span
	><a href="PlutusCore.Data.html#B"
	><span class="hs-identifier hs-var"
	  >B</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(ByteString -&gt; Data) -&gt; (K -&gt; ByteString) -&gt; K -&gt; Data
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K -&gt; ByteString
</span
	><a href="PlutusCore.Value.html#unK"
	><span class="hs-identifier hs-var"
	  >unK</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Data
</span
	><a href="PlutusCore.Data.html#I"
	><span class="hs-identifier hs-var"
	  >I</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Integer -&gt; Data) -&gt; (Quantity -&gt; Integer) -&gt; Quantity -&gt; Data
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Integer
</span
	><a href="PlutusCore.Value.html#unQuantity"
	><span class="hs-identifier hs-var"
	  >unQuantity</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>([(K, Quantity)] -&gt; [(Data, Data)])
-&gt; (Map K Quantity -&gt; [(K, Quantity)])
-&gt; Map K Quantity
-&gt; [(Data, Data)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity -&gt; [(K, Quantity)]
forall k a. Map k a -&gt; [(k, a)]
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#toList"
	><span class="hs-identifier hs-var"
	  >Map.toList</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-448"
      ></span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#valueData"
	><span class="hs-pragma hs-type"
	  >valueData</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-449"
      ></span
      ><span
      >
</span
      ><span id="line-450"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>{-| \(O(n)\). Decodes `Data` into `Value`.
This is the denotation of @UnValueData@ in Plutus V1, V2 and V3. -}</span
	></span
      ><span
      >
</span
      ><span id="line-452"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#unValueData"
	><span class="hs-identifier hs-type"
	  >unValueData</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Data.html#Data"
	><span class="hs-identifier hs-type"
	  >Data</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Builtin.Result.html#BuiltinResult"
	><span class="hs-identifier hs-type"
	  >BuiltinResult</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-453"
      ></span
      ><span id="unValueData"
      ><span class="annot"
	><span class="annottext"
	  >unValueData :: Data -&gt; BuiltinResult Value
</span
	  ><a href="PlutusCore.Value.html#unValueData"
	  ><span class="hs-identifier hs-var hs-var"
	    >unValueData</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-glyph"
      >\</span
      ><span class="hs-glyph"
      >case</span
      ><span
      >
</span
      ><span id="line-454"
      ></span
      ><span
      >  </span
      ><span class="annot"
      ><a href="PlutusCore.Data.html#Map"
	><span class="hs-identifier hs-type"
	  >Map</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074611"
      ><span class="annot"
	><span class="annottext"
	  >[(Data, Data)]
</span
	  ><a href="#local-6989586621682074611"
	  ><span class="hs-identifier hs-var"
	    >cs</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="hs-keyword"
      >do</span
      ><span
      >
</span
      ><span id="line-455"
      ></span
      ><span
      >    </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074612"
      ><span class="annot"
	><span class="annottext"
	  >[(K, Map K Quantity)]
</span
	  ><a href="#local-6989586621682074612"
	  ><span class="hs-identifier hs-var"
	    >outerList</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074613"
      ><span class="annot"
	><span class="annottext"
	  >IntMap Int
</span
	  ><a href="#local-6989586621682074613"
	  ><span class="hs-identifier hs-var"
	    >sizes</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074614"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074614"
	  ><span class="hs-identifier hs-var"
	    >total</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074615"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074615"
	  ><span class="hs-identifier hs-var"
	    >neg</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >&lt;-</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(Data, Data)]
-&gt; BuiltinResult ([(K, Map K Quantity)], IntMap Int, Int, Int)
</span
	><a href="#local-6989586621682074616"
	><span class="hs-identifier hs-var"
	  >goCurrencies</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(Data, Data)]
</span
	><a href="#local-6989586621682074611"
	><span class="hs-identifier hs-var"
	  >cs</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-456"
      ></span
      ><span
      >    </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; BuiltinResult Value
forall a. a -&gt; BuiltinResult a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#pure"
	><span class="hs-identifier hs-var"
	  >pure</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Value -&gt; BuiltinResult Value) -&gt; Value -&gt; BuiltinResult Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; IntMap Int -&gt; Int -&gt; Int -&gt; Value
</span
	><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-var"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>[(K, Map K Quantity)] -&gt; NestedMap
forall k a. [(k, a)] -&gt; Map k a
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Strict.Internal.html#fromDistinctDescList"
	><span class="hs-identifier hs-var"
	  >Map.fromDistinctDescList</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(K, Map K Quantity)]
</span
	><a href="#local-6989586621682074612"
	><span class="hs-identifier hs-var"
	  >outerList</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int
</span
	><a href="#local-6989586621682074613"
	><span class="hs-identifier hs-var"
	  >sizes</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074614"
	><span class="hs-identifier hs-var"
	  >total</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074615"
	><span class="hs-identifier hs-var"
	  >neg</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-457"
      ></span
      ><span
      >  </span
      ><span class="annot"
      ><span class="annottext"
	>Data
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; BuiltinResult Value
forall a. String -&gt; BuiltinResult a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;unValueData: non-Map constructor&quot;</span
	></span
      ><span
      >
</span
      ><span id="line-458"
      ></span
      ><span
      >  </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-459"
      ></span
      ><span
      >    </span
      ><span class="annot"
      ><a href="#local-6989586621682074618"
	><span class="hs-identifier hs-type"
	  >unB</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Data.html#Data"
	><span class="hs-identifier hs-type"
	  >Data</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Builtin.Result.html#BuiltinResult"
	><span class="hs-identifier hs-type"
	  >BuiltinResult</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier hs-type"
	  >K</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-460"
      ></span
      ><span
      >    </span
      ><span id="local-6989586621682074618"
      ><span class="annot"
	><span class="annottext"
	  >unB :: Data -&gt; BuiltinResult K
</span
	  ><a href="#local-6989586621682074618"
	  ><span class="hs-identifier hs-var hs-var"
	    >unB</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-glyph"
      >\</span
      ><span class="hs-glyph"
      >case</span
      ><span
      >
</span
      ><span id="line-461"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><a href="PlutusCore.Data.html#B"
	><span class="hs-identifier hs-type"
	  >B</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074619"
      ><span class="annot"
	><span class="annottext"
	  >ByteString
</span
	  ><a href="#local-6989586621682074619"
	  ><span class="hs-identifier hs-var"
	    >b</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>BuiltinResult K
-&gt; (K -&gt; BuiltinResult K) -&gt; Maybe K -&gt; BuiltinResult K
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Maybe.html#maybe"
	><span class="hs-identifier hs-var"
	  >maybe</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; BuiltinResult K
forall a. String -&gt; BuiltinResult a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(String -&gt; BuiltinResult K) -&gt; String -&gt; BuiltinResult K
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;unValueData: invalid key: &quot;</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%3C%3E"
	><span class="hs-operator hs-var"
	  >&lt;&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[Word8] -&gt; String
forall a. Show a =&gt; a -&gt; String
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Show.html#show"
	><span class="hs-identifier hs-var"
	  >show</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; [Word8]
</span
	><a href="https://hackage.haskell.org/package/bytestring-0.11.5.4/docs/src/Data.ByteString.html#unpack"
	><span class="hs-identifier hs-var"
	  >B.unpack</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString
</span
	><a href="#local-6989586621682074619"
	><span class="hs-identifier hs-var"
	  >b</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K -&gt; BuiltinResult K
forall a. a -&gt; BuiltinResult a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#pure"
	><span class="hs-identifier hs-var"
	  >pure</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>ByteString -&gt; Maybe K
</span
	><a href="PlutusCore.Value.html#k"
	><span class="hs-identifier hs-var"
	  >k</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>ByteString
</span
	><a href="#local-6989586621682074619"
	><span class="hs-identifier hs-var"
	  >b</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-462"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><span class="annottext"
	>Data
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; BuiltinResult K
forall a. String -&gt; BuiltinResult a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;unValueData: non-B constructor&quot;</span
	></span
      ><span
      >
</span
      ><span id="line-463"
      ></span
      ><span
      >    </span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="#local-6989586621682074618"
	><span class="hs-pragma hs-type"
	  >unB</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-464"
      ></span
      ><span
      >
</span
      ><span id="line-465"
      ></span
      ><span
      >    </span
      ><span class="annot"
      ><a href="#local-6989586621682074620"
	><span class="hs-identifier hs-type"
	  >unQ</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Data.html#Data"
	><span class="hs-identifier hs-type"
	  >Data</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Builtin.Result.html#BuiltinResult"
	><span class="hs-identifier hs-type"
	  >BuiltinResult</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-466"
      ></span
      ><span
      >    </span
      ><span id="local-6989586621682074620"
      ><span class="annot"
	><span class="annottext"
	  >unQ :: Data -&gt; BuiltinResult Quantity
</span
	  ><a href="#local-6989586621682074620"
	  ><span class="hs-identifier hs-var hs-var"
	    >unQ</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-glyph"
      >\</span
      ><span class="hs-glyph"
      >case</span
      ><span
      >
</span
      ><span id="line-467"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><a href="PlutusCore.Data.html#I"
	><span class="hs-identifier hs-type"
	  >I</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074621"
      ><span class="annot"
	><span class="annottext"
	  >Integer
</span
	  ><a href="#local-6989586621682074621"
	  ><span class="hs-identifier hs-var"
	    >i</span
	    ></a
	  ></span
	></span
      ><span
      >
</span
      ><span id="line-468"
      ></span
      ><span
      >        </span
      ><span class="hs-glyph"
      >|</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074621"
	><span class="hs-identifier hs-var"
	  >i</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Integer -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3D%3D"
	><span class="hs-operator hs-var"
	  >==</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><span class="hs-number"
	>0</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Bool -&gt; Bool -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%7C%7C"
	><span class="hs-operator hs-var"
	  >||</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074621"
	><span class="hs-identifier hs-var"
	  >i</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3C"
	><span class="hs-operator hs-var"
	  >&lt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Integer
</span
	><a href="PlutusCore.Value.html#unQuantity"
	><span class="hs-identifier hs-var"
	  >unQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
forall a. Bounded a =&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Enum.html#minBound"
	><span class="hs-identifier hs-var"
	  >minBound</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Bool -&gt; Bool -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%7C%7C"
	><span class="hs-operator hs-var"
	  >||</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074621"
	><span class="hs-identifier hs-var"
	  >i</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3E"
	><span class="hs-operator hs-var"
	  >&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Integer
</span
	><a href="PlutusCore.Value.html#unQuantity"
	><span class="hs-identifier hs-var"
	  >unQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
forall a. Bounded a =&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Enum.html#maxBound"
	><span class="hs-identifier hs-var"
	  >maxBound</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      >
</span
      ><span id="line-469"
      ></span
      ><span
      >            </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; BuiltinResult Quantity
forall a. String -&gt; BuiltinResult a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;unValueData: invalid quantity&quot;</span
	></span
      ><span
      >
</span
      ><span id="line-470"
      ></span
      ><span
      >        </span
      ><span class="hs-glyph"
      >|</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Bool
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#otherwise"
	><span class="hs-identifier hs-var"
	  >otherwise</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; BuiltinResult Quantity
forall a. a -&gt; BuiltinResult a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#pure"
	><span class="hs-identifier hs-var"
	  >pure</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Quantity
</span
	><a href="PlutusCore.Value.html#UnsafeQuantity"
	><span class="hs-identifier hs-var"
	  >UnsafeQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074621"
	><span class="hs-identifier hs-var"
	  >i</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-471"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><span class="annottext"
	>Data
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; BuiltinResult Quantity
forall a. String -&gt; BuiltinResult a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;unValueData: non-I constructor&quot;</span
	></span
      ><span
      >
</span
      ><span id="line-472"
      ></span
      ><span
      >    </span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="#local-6989586621682074620"
	><span class="hs-pragma hs-type"
	  >unQ</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-473"
      ></span
      ><span
      >
</span
      ><span id="line-474"
      ></span
      ><span
      >    </span
      ><span class="hs-comment"
      >-- Returns the inner map and the number of negative quantities in it.</span
      ><span
      >
</span
      ><span id="line-475"
      ></span
      ><span
      >    </span
      ><span class="annot"
      ><a href="#local-6989586621682074622"
	><span class="hs-identifier hs-type"
	  >unTokens</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Data.html#Data"
	><span class="hs-identifier hs-type"
	  >Data</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Builtin.Result.html#BuiltinResult"
	><span class="hs-identifier hs-type"
	  >BuiltinResult</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#Map"
	><span class="hs-identifier hs-type"
	  >Map</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier hs-type"
	  >K</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-476"
      ></span
      ><span
      >    </span
      ><span id="local-6989586621682074622"
      ><span class="annot"
	><span class="annottext"
	  >unTokens :: Data -&gt; BuiltinResult (Map K Quantity, Int)
</span
	  ><a href="#local-6989586621682074622"
	  ><span class="hs-identifier hs-var hs-var"
	    >unTokens</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-glyph"
      >\</span
      ><span class="hs-glyph"
      >case</span
      ><span
      >
</span
      ><span id="line-477"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><a href="PlutusCore.Data.html#Map"
	><span class="hs-identifier hs-type"
	  >Map</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074623"
      ><span class="annot"
	><span class="annottext"
	  >[(Data, Data)]
</span
	  ><a href="#local-6989586621682074623"
	  ><span class="hs-identifier hs-var"
	    >ts</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="hs-keyword"
      >do</span
      ><span
      >
</span
      ><span id="line-478"
      ></span
      ><span
      >        </span
      ><span class="annot"
      ><span class="annottext"
	>Bool -&gt; BuiltinResult () -&gt; BuiltinResult ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#when"
	><span class="hs-identifier hs-var"
	  >when</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>[(Data, Data)] -&gt; Bool
forall a. [a] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Foldable.html#null"
	><span class="hs-identifier hs-var"
	  >null</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(Data, Data)]
</span
	><a href="#local-6989586621682074623"
	><span class="hs-identifier hs-var"
	  >ts</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(BuiltinResult () -&gt; BuiltinResult ())
-&gt; BuiltinResult () -&gt; BuiltinResult ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; BuiltinResult ()
forall a. String -&gt; BuiltinResult a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;unValueData: empty inner map&quot;</span
	></span
      ><span
      >
</span
      ><span id="line-479"
      ></span
      ><span
      >        </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074625"
      ><span class="annot"
	><span class="annottext"
	  >[(K, Quantity)]
</span
	  ><a href="#local-6989586621682074625"
	  ><span class="hs-identifier hs-var"
	    >innerList</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074626"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074626"
	  ><span class="hs-identifier hs-var"
	    >neg</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >&lt;-</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(Data, Data)] -&gt; BuiltinResult ([(K, Quantity)], Int)
</span
	><a href="#local-6989586621682074627"
	><span class="hs-identifier hs-var"
	  >goTokens</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(Data, Data)]
</span
	><a href="#local-6989586621682074623"
	><span class="hs-identifier hs-var"
	  >ts</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-480"
      ></span
      ><span
      >        </span
      ><span class="annot"
      ><span class="annottext"
	>(Map K Quantity, Int) -&gt; BuiltinResult (Map K Quantity, Int)
forall a. a -&gt; BuiltinResult a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#pure"
	><span class="hs-identifier hs-var"
	  >pure</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>[(K, Quantity)] -&gt; Map K Quantity
forall k a. [(k, a)] -&gt; Map k a
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Strict.Internal.html#fromDistinctDescList"
	><span class="hs-identifier hs-var"
	  >Map.fromDistinctDescList</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(K, Quantity)]
</span
	><a href="#local-6989586621682074625"
	><span class="hs-identifier hs-var"
	  >innerList</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074626"
	><span class="hs-identifier hs-var"
	  >neg</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-481"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><span class="annottext"
	>Data
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; BuiltinResult (Map K Quantity, Int)
forall a. String -&gt; BuiltinResult a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;unValueData: non-Map constructor&quot;</span
	></span
      ><span
      >
</span
      ><span id="line-482"
      ></span
      ><span
      >    </span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="#local-6989586621682074622"
	><span class="hs-pragma hs-type"
	  >unTokens</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-483"
      ></span
      ><span
      >
</span
      ><span id="line-484"
      ></span
      ><span
      >    </span
      ><span class="hs-comment"
      >-- Returns outer map's list, plus stats (sizes, total, neg).</span
      ><span
      >
</span
      ><span id="line-485"
      ></span
      ><span
      >    </span
      ><span class="annot"
      ><a href="#local-6989586621682074616"
	><span class="hs-identifier hs-type"
	  >goCurrencies</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-486"
      ></span
      ><span
      >      </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="hs-special"
      >[</span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Data.html#Data"
	><span class="hs-identifier hs-type"
	  >Data</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Data.html#Data"
	><span class="hs-identifier hs-type"
	  >Data</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >]</span
      ><span
      >
</span
      ><span id="line-487"
      ></span
      ><span
      >      </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Builtin.Result.html#BuiltinResult"
	><span class="hs-identifier hs-type"
	  >BuiltinResult</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="hs-special"
      >[</span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier hs-type"
	  >K</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#Map"
	><span class="hs-identifier hs-type"
	  >Map</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier hs-type"
	  >K</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >]</span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.IntMap.Internal.html#IntMap"
	><span class="hs-identifier hs-type"
	  >IntMap</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-488"
      ></span
      ><span
      >    </span
      ><span id="local-6989586621682074616"
      ><span class="annot"
	><span class="annottext"
	  >goCurrencies :: [(Data, Data)]
-&gt; BuiltinResult ([(K, Map K Quantity)], IntMap Int, Int, Int)
</span
	  ><a href="#local-6989586621682074616"
	  ><span class="hs-identifier hs-var hs-var"
	    >goCurrencies</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe K
-&gt; [(K, Map K Quantity)]
-&gt; IntMap Int
-&gt; Int
-&gt; Int
-&gt; [(Data, Data)]
-&gt; BuiltinResult ([(K, Map K Quantity)], IntMap Int, Int, Int)
forall {a}.
Num a =&gt;
Maybe K
-&gt; [(K, Map K Quantity)]
-&gt; IntMap a
-&gt; Int
-&gt; Int
-&gt; [(Data, Data)]
-&gt; BuiltinResult ([(K, Map K Quantity)], IntMap a, Int, Int)
</span
	><a href="#local-6989586621682074628"
	><span class="hs-identifier hs-var"
	  >go</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe K
forall a. Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(K, Map K Quantity)]
forall a. Monoid a =&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#mempty"
	><span class="hs-identifier hs-var"
	  >mempty</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int
forall a. Monoid a =&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#mempty"
	><span class="hs-identifier hs-var"
	  >mempty</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>0</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>0</span
	></span
      ><span
      >
</span
      ><span id="line-489"
      ></span
      ><span
      >      </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-490"
      ></span
      ><span
      >        </span
      ><span id="local-6989586621682074628"
      ><span class="annot"
	><span class="annottext"
	  >go :: Maybe K
-&gt; [(K, Map K Quantity)]
-&gt; IntMap a
-&gt; Int
-&gt; Int
-&gt; [(Data, Data)]
-&gt; BuiltinResult ([(K, Map K Quantity)], IntMap a, Int, Int)
</span
	  ><a href="#local-6989586621682074628"
	  ><span class="hs-identifier hs-var hs-var"
	    >go</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >!</span
      ><span id="local-6989586621682074638"
      ><span class="annot"
	><span class="annottext"
	  >Maybe K
</span
	  ><a href="#local-6989586621682074638"
	  ><span class="hs-identifier hs-var"
	    >prev</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >!</span
      ><span id="local-6989586621682074639"
      ><span class="annot"
	><span class="annottext"
	  >[(K, Map K Quantity)]
</span
	  ><a href="#local-6989586621682074639"
	  ><span class="hs-identifier hs-var"
	    >acc</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >!</span
      ><span id="local-6989586621682074640"
      ><span class="annot"
	><span class="annottext"
	  >IntMap a
</span
	  ><a href="#local-6989586621682074640"
	  ><span class="hs-identifier hs-var"
	    >sizes</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >!</span
      ><span id="local-6989586621682074641"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074641"
	  ><span class="hs-identifier hs-var"
	    >total</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >!</span
      ><span id="local-6989586621682074642"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074642"
	  ><span class="hs-identifier hs-var"
	    >neg</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-glyph"
      >\</span
      ><span class="hs-glyph"
      >case</span
      ><span
      >
</span
      ><span id="line-491"
      ></span
      ><span
      >          </span
      ><span class="hs-special"
      >[</span
      ><span class="hs-special"
      >]</span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>([(K, Map K Quantity)], IntMap a, Int, Int)
-&gt; BuiltinResult ([(K, Map K Quantity)], IntMap a, Int, Int)
forall a. a -&gt; BuiltinResult a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#pure"
	><span class="hs-identifier hs-var"
	  >pure</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>[(K, Map K Quantity)]
</span
	><a href="#local-6989586621682074639"
	><span class="hs-identifier hs-var"
	  >acc</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap a
</span
	><a href="#local-6989586621682074640"
	><span class="hs-identifier hs-var"
	  >sizes</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074641"
	><span class="hs-identifier hs-var"
	  >total</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074642"
	><span class="hs-identifier hs-var"
	  >neg</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-492"
      ></span
      ><span
      >          </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074643"
      ><span class="annot"
	><span class="annottext"
	  >Data
</span
	  ><a href="#local-6989586621682074643"
	  ><span class="hs-identifier hs-var"
	    >cData</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074644"
      ><span class="annot"
	><span class="annottext"
	  >Data
</span
	  ><a href="#local-6989586621682074644"
	  ><span class="hs-identifier hs-var"
	    >tsData</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#%3A"
	><span class="hs-glyph hs-type"
	  >:</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074645"
      ><span class="annot"
	><span class="annottext"
	  >[(Data, Data)]
</span
	  ><a href="#local-6989586621682074645"
	  ><span class="hs-identifier hs-var"
	    >rest</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="hs-keyword"
      >do</span
      ><span
      >
</span
      ><span id="line-493"
      ></span
      ><span
      >            </span
      ><span class="hs-glyph"
      >!</span
      ><span id="local-6989586621682074646"
      ><span class="annot"
	><span class="annottext"
	  >K
</span
	  ><a href="#local-6989586621682074646"
	  ><span class="hs-identifier hs-var"
	    >c</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >&lt;-</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Data -&gt; BuiltinResult K
</span
	><a href="#local-6989586621682074618"
	><span class="hs-identifier hs-var"
	  >unB</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Data
</span
	><a href="#local-6989586621682074643"
	><span class="hs-identifier hs-var"
	  >cData</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-494"
      ></span
      ><span
      >            </span
      ><span class="hs-comment"
      >-- Verify that currencies are strictly ascending</span
      ><span
      >
</span
      ><span id="line-495"
      ></span
      ><span
      >            </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe K -&gt; (K -&gt; BuiltinResult ()) -&gt; BuiltinResult ()
forall (m :: * -&gt; *) a.
Applicative m =&gt;
Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span
	><a href="https://hackage.haskell.org/package/extra-1.8.1/docs/src/Control.Monad.Extra.html#whenJust"
	><span class="hs-identifier hs-var"
	  >whenJust</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-496"
      ></span
      ><span
      >              </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe K
</span
	><a href="#local-6989586621682074638"
	><span class="hs-identifier hs-var"
	  >prev</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-497"
      ></span
      ><span
      >              </span
      ><span class="hs-special"
      >(</span
      ><span
      > </span
      ><span class="hs-glyph"
      >\</span
      ><span id="local-6989586621682074647"
      ><span class="annot"
	><span class="annottext"
	  >K
</span
	  ><a href="#local-6989586621682074647"
	  ><span class="hs-identifier hs-var"
	    >p</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      >
</span
      ><span id="line-498"
      ></span
      ><span
      >                  </span
      ><span class="annot"
      ><span class="annottext"
	>Bool -&gt; BuiltinResult () -&gt; BuiltinResult ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.html#unless"
	><span class="hs-identifier hs-var"
	  >unless</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-499"
      ></span
      ><span
      >                    </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><a href="#local-6989586621682074647"
	><span class="hs-identifier hs-var"
	  >p</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K -&gt; K -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3C"
	><span class="hs-operator hs-var"
	  >&lt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><a href="#local-6989586621682074646"
	><span class="hs-identifier hs-var"
	  >c</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-500"
      ></span
      ><span
      >                    </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; BuiltinResult ()
forall a. String -&gt; BuiltinResult a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;unValueData: currency symbols not strictly ascending&quot;</span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-501"
      ></span
      ><span
      >              </span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-502"
      ></span
      ><span
      >            </span
      ><span class="hs-special"
      >(</span
      ><span class="hs-glyph"
      >!</span
      ><span id="local-6989586621682074648"
      ><span class="annot"
	><span class="annottext"
	  >Map K Quantity
</span
	  ><a href="#local-6989586621682074648"
	  ><span class="hs-identifier hs-var"
	    >inner</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="hs-glyph"
      >!</span
      ><span id="local-6989586621682074649"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074649"
	  ><span class="hs-identifier hs-var"
	    >innerNeg</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >&lt;-</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Data -&gt; BuiltinResult (Map K Quantity, Int)
</span
	><a href="#local-6989586621682074622"
	><span class="hs-identifier hs-var"
	  >unTokens</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Data
</span
	><a href="#local-6989586621682074644"
	><span class="hs-identifier hs-var"
	  >tsData</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-503"
      ></span
      ><span
      >            </span
      ><span class="hs-keyword"
      >let</span
      ><span
      > </span
      ><span id="local-6989586621682074653"
      ><span class="annot"
	><span class="annottext"
	  >sizes' :: IntMap a
</span
	  ><a href="#local-6989586621682074653"
	  ><span class="hs-identifier hs-var hs-var"
	    >sizes'</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Maybe a -&gt; Maybe a) -&gt; Int -&gt; IntMap a -&gt; IntMap a
forall a. (Maybe a -&gt; Maybe a) -&gt; Int -&gt; IntMap a -&gt; IntMap a
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.IntMap.Strict.Internal.html#alter"
	><span class="hs-identifier hs-var"
	  >IntMap.alter</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Maybe a -&gt; (a -&gt; Maybe a) -&gt; Maybe a -&gt; Maybe a
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Maybe.html#maybe"
	><span class="hs-identifier hs-var"
	  >maybe</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-var"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>a
</span
	><span class="hs-number"
	>1</span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-var"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(a -&gt; Maybe a) -&gt; (a -&gt; a) -&gt; a -&gt; Maybe a
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>a -&gt; a -&gt; a
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#%2B"
	><span class="hs-operator hs-var"
	  >+</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>a
</span
	><span class="hs-number"
	>1</span
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity -&gt; Int
forall k a. Map k a -&gt; Int
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#size"
	><span class="hs-identifier hs-var"
	  >Map.size</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity
</span
	><a href="#local-6989586621682074648"
	><span class="hs-identifier hs-var"
	  >inner</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap a
</span
	><a href="#local-6989586621682074640"
	><span class="hs-identifier hs-var"
	  >sizes</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-504"
      ></span
      ><span
      >                </span
      ><span id="local-6989586621682074655"
      ><span class="annot"
	><span class="annottext"
	  >total' :: Int
</span
	  ><a href="#local-6989586621682074655"
	  ><span class="hs-identifier hs-var hs-var"
	    >total'</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074641"
	><span class="hs-identifier hs-var"
	  >total</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#%2B"
	><span class="hs-operator hs-var"
	  >+</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity -&gt; Int
forall k a. Map k a -&gt; Int
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.Map.Internal.html#size"
	><span class="hs-identifier hs-var"
	  >Map.size</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity
</span
	><a href="#local-6989586621682074648"
	><span class="hs-identifier hs-var"
	  >inner</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-505"
      ></span
      ><span
      >                </span
      ><span id="local-6989586621682074657"
      ><span class="annot"
	><span class="annottext"
	  >neg' :: Int
</span
	  ><a href="#local-6989586621682074657"
	  ><span class="hs-identifier hs-var hs-var"
	    >neg'</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074642"
	><span class="hs-identifier hs-var"
	  >neg</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#%2B"
	><span class="hs-operator hs-var"
	  >+</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074649"
	><span class="hs-identifier hs-var"
	  >innerNeg</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-506"
      ></span
      ><span
      >                </span
      ><span id="local-6989586621682074658"
      ><span class="annot"
	><span class="annottext"
	  >acc' :: [(K, Map K Quantity)]
</span
	  ><a href="#local-6989586621682074658"
	  ><span class="hs-identifier hs-var hs-var"
	    >acc'</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><a href="#local-6989586621682074646"
	><span class="hs-identifier hs-var"
	  >c</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Map K Quantity
</span
	><a href="#local-6989586621682074648"
	><span class="hs-identifier hs-var"
	  >inner</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(K, Map K Quantity)
-&gt; [(K, Map K Quantity)] -&gt; [(K, Map K Quantity)]
forall a. a -&gt; [a] -&gt; [a]
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#%3A"
	><span class="hs-glyph hs-var"
	  >:</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(K, Map K Quantity)]
</span
	><a href="#local-6989586621682074639"
	><span class="hs-identifier hs-var"
	  >acc</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-507"
      ></span
      ><span
      >            </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe K
-&gt; [(K, Map K Quantity)]
-&gt; IntMap a
-&gt; Int
-&gt; Int
-&gt; [(Data, Data)]
-&gt; BuiltinResult ([(K, Map K Quantity)], IntMap a, Int, Int)
</span
	><a href="#local-6989586621682074628"
	><span class="hs-identifier hs-var"
	  >go</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>K -&gt; Maybe K
forall a. a -&gt; Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-var"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><a href="#local-6989586621682074646"
	><span class="hs-identifier hs-var"
	  >c</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(K, Map K Quantity)]
</span
	><a href="#local-6989586621682074658"
	><span class="hs-identifier hs-var"
	  >acc'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap a
</span
	><a href="#local-6989586621682074653"
	><span class="hs-identifier hs-var"
	  >sizes'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074655"
	><span class="hs-identifier hs-var"
	  >total'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074657"
	><span class="hs-identifier hs-var"
	  >neg'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(Data, Data)]
</span
	><a href="#local-6989586621682074645"
	><span class="hs-identifier hs-var"
	  >rest</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-508"
      ></span
      ><span
      >
</span
      ><span id="line-509"
      ></span
      ><span
      >    </span
      ><span class="hs-comment"
      >-- Returns inner map's list, plus the number of negative quantities in the inner map.</span
      ><span
      >
</span
      ><span id="line-510"
      ></span
      ><span
      >    </span
      ><span class="annot"
      ><a href="#local-6989586621682074627"
	><span class="hs-identifier hs-type"
	  >goTokens</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="hs-special"
      >[</span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Data.html#Data"
	><span class="hs-identifier hs-type"
	  >Data</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Data.html#Data"
	><span class="hs-identifier hs-type"
	  >Data</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >]</span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Builtin.Result.html#BuiltinResult"
	><span class="hs-identifier hs-type"
	  >BuiltinResult</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="hs-special"
      >[</span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#K"
	><span class="hs-identifier hs-type"
	  >K</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >]</span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-511"
      ></span
      ><span
      >    </span
      ><span id="local-6989586621682074627"
      ><span class="annot"
	><span class="annottext"
	  >goTokens :: [(Data, Data)] -&gt; BuiltinResult ([(K, Quantity)], Int)
</span
	  ><a href="#local-6989586621682074627"
	  ><span class="hs-identifier hs-var hs-var"
	    >goTokens</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe K
-&gt; [(K, Quantity)]
-&gt; Int
-&gt; [(Data, Data)]
-&gt; BuiltinResult ([(K, Quantity)], Int)
forall {t}.
Num t =&gt;
Maybe K
-&gt; [(K, Quantity)]
-&gt; t
-&gt; [(Data, Data)]
-&gt; BuiltinResult ([(K, Quantity)], t)
</span
	><a href="#local-6989586621682074659"
	><span class="hs-identifier hs-var"
	  >go</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe K
forall a. Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(K, Quantity)]
forall a. Monoid a =&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#mempty"
	><span class="hs-identifier hs-var"
	  >mempty</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>0</span
	></span
      ><span
      >
</span
      ><span id="line-512"
      ></span
      ><span
      >      </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-513"
      ></span
      ><span
      >        </span
      ><span id="local-6989586621682074659"
      ><span class="annot"
	><span class="annottext"
	  >go :: Maybe K
-&gt; [(K, Quantity)]
-&gt; t
-&gt; [(Data, Data)]
-&gt; BuiltinResult ([(K, Quantity)], t)
</span
	  ><a href="#local-6989586621682074659"
	  ><span class="hs-identifier hs-var hs-var"
	    >go</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >!</span
      ><span id="local-6989586621682074669"
      ><span class="annot"
	><span class="annottext"
	  >Maybe K
</span
	  ><a href="#local-6989586621682074669"
	  ><span class="hs-identifier hs-var"
	    >prev</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >!</span
      ><span id="local-6989586621682074670"
      ><span class="annot"
	><span class="annottext"
	  >[(K, Quantity)]
</span
	  ><a href="#local-6989586621682074670"
	  ><span class="hs-identifier hs-var"
	    >acc</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >!</span
      ><span id="local-6989586621682074671"
      ><span class="annot"
	><span class="annottext"
	  >t
</span
	  ><a href="#local-6989586621682074671"
	  ><span class="hs-identifier hs-var"
	    >neg</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-glyph"
      >\</span
      ><span class="hs-glyph"
      >case</span
      ><span
      >
</span
      ><span id="line-514"
      ></span
      ><span
      >          </span
      ><span class="hs-special"
      >[</span
      ><span class="hs-special"
      >]</span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>([(K, Quantity)], t) -&gt; BuiltinResult ([(K, Quantity)], t)
forall a. a -&gt; BuiltinResult a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#pure"
	><span class="hs-identifier hs-var"
	  >pure</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>[(K, Quantity)]
</span
	><a href="#local-6989586621682074670"
	><span class="hs-identifier hs-var"
	  >acc</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>t
</span
	><a href="#local-6989586621682074671"
	><span class="hs-identifier hs-var"
	  >neg</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-515"
      ></span
      ><span
      >          </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621682074672"
      ><span class="annot"
	><span class="annottext"
	  >Data
</span
	  ><a href="#local-6989586621682074672"
	  ><span class="hs-identifier hs-var"
	    >tData</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span id="local-6989586621682074673"
      ><span class="annot"
	><span class="annottext"
	  >Data
</span
	  ><a href="#local-6989586621682074673"
	  ><span class="hs-identifier hs-var"
	    >qData</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#%3A"
	><span class="hs-glyph hs-type"
	  >:</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074674"
      ><span class="annot"
	><span class="annottext"
	  >[(Data, Data)]
</span
	  ><a href="#local-6989586621682074674"
	  ><span class="hs-identifier hs-var"
	    >rest</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="hs-keyword"
      >do</span
      ><span
      >
</span
      ><span id="line-516"
      ></span
      ><span
      >            </span
      ><span class="hs-glyph"
      >!</span
      ><span id="local-6989586621682074675"
      ><span class="annot"
	><span class="annottext"
	  >K
</span
	  ><a href="#local-6989586621682074675"
	  ><span class="hs-identifier hs-var"
	    >t</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >&lt;-</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Data -&gt; BuiltinResult K
</span
	><a href="#local-6989586621682074618"
	><span class="hs-identifier hs-var"
	  >unB</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Data
</span
	><a href="#local-6989586621682074672"
	><span class="hs-identifier hs-var"
	  >tData</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-517"
      ></span
      ><span
      >            </span
      ><span class="hs-comment"
      >-- Verify that token names within an inner map are strictly ascending</span
      ><span
      >
</span
      ><span id="line-518"
      ></span
      ><span
      >            </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe K -&gt; (K -&gt; BuiltinResult ()) -&gt; BuiltinResult ()
forall (m :: * -&gt; *) a.
Applicative m =&gt;
Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span
	><a href="https://hackage.haskell.org/package/extra-1.8.1/docs/src/Control.Monad.Extra.html#whenJust"
	><span class="hs-identifier hs-var"
	  >whenJust</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-519"
      ></span
      ><span
      >              </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe K
</span
	><a href="#local-6989586621682074669"
	><span class="hs-identifier hs-var"
	  >prev</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-520"
      ></span
      ><span
      >              </span
      ><span class="hs-special"
      >(</span
      ><span
      > </span
      ><span class="hs-glyph"
      >\</span
      ><span id="local-6989586621682074676"
      ><span class="annot"
	><span class="annottext"
	  >K
</span
	  ><a href="#local-6989586621682074676"
	  ><span class="hs-identifier hs-var"
	    >p</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      >
</span
      ><span id="line-521"
      ></span
      ><span
      >                  </span
      ><span class="annot"
      ><span class="annottext"
	>Bool -&gt; BuiltinResult () -&gt; BuiltinResult ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.html#unless"
	><span class="hs-identifier hs-var"
	  >unless</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-522"
      ></span
      ><span
      >                    </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><a href="#local-6989586621682074676"
	><span class="hs-identifier hs-var"
	  >p</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K -&gt; K -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3C"
	><span class="hs-operator hs-var"
	  >&lt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><a href="#local-6989586621682074675"
	><span class="hs-identifier hs-var"
	  >t</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-523"
      ></span
      ><span
      >                    </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; BuiltinResult ()
forall a. String -&gt; BuiltinResult a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;unValueData: token names not strictly ascending&quot;</span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-524"
      ></span
      ><span
      >              </span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-525"
      ></span
      ><span
      >            </span
      ><span class="hs-glyph"
      >!</span
      ><span id="local-6989586621682074677"
      ><span class="annot"
	><span class="annottext"
	  >Quantity
</span
	  ><a href="#local-6989586621682074677"
	  ><span class="hs-identifier hs-var"
	    >q</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >&lt;-</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Data -&gt; BuiltinResult Quantity
</span
	><a href="#local-6989586621682074620"
	><span class="hs-identifier hs-var"
	  >unQ</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Data
</span
	><a href="#local-6989586621682074673"
	><span class="hs-identifier hs-var"
	  >qData</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-526"
      ></span
      ><span
      >            </span
      ><span class="hs-keyword"
      >let</span
      ><span
      > </span
      ><span id="local-6989586621682074681"
      ><span class="annot"
	><span class="annottext"
	  >neg' :: t
</span
	  ><a href="#local-6989586621682074681"
	  ><span class="hs-identifier hs-var hs-var"
	    >neg'</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-keyword"
      >if</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074677"
	><span class="hs-identifier hs-var"
	  >q</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Quantity -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3C"
	><span class="hs-operator hs-var"
	  >&lt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="PlutusCore.Value.html#zeroQuantity"
	><span class="hs-identifier hs-var"
	  >zeroQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >then</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>t
</span
	><a href="#local-6989586621682074671"
	><span class="hs-identifier hs-var"
	  >neg</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>t -&gt; t -&gt; t
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#%2B"
	><span class="hs-operator hs-var"
	  >+</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>t
</span
	><span class="hs-number"
	>1</span
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >else</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>t
</span
	><a href="#local-6989586621682074671"
	><span class="hs-identifier hs-var"
	  >neg</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-527"
      ></span
      ><span
      >                </span
      ><span id="local-6989586621682074682"
      ><span class="annot"
	><span class="annottext"
	  >acc' :: [(K, Quantity)]
</span
	  ><a href="#local-6989586621682074682"
	  ><span class="hs-identifier hs-var hs-var"
	    >acc'</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><a href="#local-6989586621682074675"
	><span class="hs-identifier hs-var"
	  >t</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074677"
	><span class="hs-identifier hs-var"
	  >q</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(K, Quantity) -&gt; [(K, Quantity)] -&gt; [(K, Quantity)]
forall a. a -&gt; [a] -&gt; [a]
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#%3A"
	><span class="hs-glyph hs-var"
	  >:</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(K, Quantity)]
</span
	><a href="#local-6989586621682074670"
	><span class="hs-identifier hs-var"
	  >acc</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-528"
      ></span
      ><span
      >            </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe K
-&gt; [(K, Quantity)]
-&gt; t
-&gt; [(Data, Data)]
-&gt; BuiltinResult ([(K, Quantity)], t)
</span
	><a href="#local-6989586621682074659"
	><span class="hs-identifier hs-var"
	  >go</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>K -&gt; Maybe K
forall a. a -&gt; Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-var"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>K
</span
	><a href="#local-6989586621682074675"
	><span class="hs-identifier hs-var"
	  >t</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(K, Quantity)]
</span
	><a href="#local-6989586621682074682"
	><span class="hs-identifier hs-var"
	  >acc'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>t
</span
	><a href="#local-6989586621682074681"
	><span class="hs-identifier hs-var"
	  >neg'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[(Data, Data)]
</span
	><a href="#local-6989586621682074674"
	><span class="hs-identifier hs-var"
	  >rest</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-529"
      ></span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#unValueData"
	><span class="hs-pragma hs-type"
	  >unValueData</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-530"
      ></span
      ><span
      >
</span
      ><span id="line-531"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>-- | Decrement bucket @old@, and increment bucket @new@.</span
	></span
      ><span
      >
</span
      ><span id="line-532"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#updateSizes"
	><span class="hs-identifier hs-type"
	  >updateSizes</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.IntMap.Internal.html#IntMap"
	><span class="hs-identifier hs-type"
	  >IntMap</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.IntMap.Internal.html#IntMap"
	><span class="hs-identifier hs-type"
	  >IntMap</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-533"
      ></span
      ><span id="updateSizes"
      ><span class="annot"
	><span class="annottext"
	  >updateSizes :: Int -&gt; Int -&gt; IntMap Int -&gt; IntMap Int
</span
	  ><a href="PlutusCore.Value.html#updateSizes"
	  ><span class="hs-identifier hs-var hs-var"
	    >updateSizes</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074683"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074683"
	  ><span class="hs-identifier hs-var"
	    >old</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074684"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074684"
	  ><span class="hs-identifier hs-var"
	    >new</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int -&gt; IntMap Int
</span
	><a href="#local-6989586621682074685"
	><span class="hs-identifier hs-var"
	  >dec</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(IntMap Int -&gt; IntMap Int)
-&gt; (IntMap Int -&gt; IntMap Int) -&gt; IntMap Int -&gt; IntMap Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int -&gt; IntMap Int
</span
	><a href="#local-6989586621682074686"
	><span class="hs-identifier hs-var"
	  >inc</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-534"
      ></span
      ><span
      >  </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-535"
      ></span
      ><span
      >    </span
      ><span id="local-6989586621682074686"
      ><span class="annot"
	><span class="annottext"
	  >inc :: IntMap Int -&gt; IntMap Int
</span
	  ><a href="#local-6989586621682074686"
	  ><span class="hs-identifier hs-var hs-var"
	    >inc</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      >
</span
      ><span id="line-536"
      ></span
      ><span
      >      </span
      ><span class="hs-keyword"
      >if</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074684"
	><span class="hs-identifier hs-var"
	  >new</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3D%3D"
	><span class="hs-operator hs-var"
	  >==</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>0</span
	></span
      ><span
      >
</span
      ><span id="line-537"
      ></span
      ><span
      >        </span
      ><span class="hs-keyword"
      >then</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int -&gt; IntMap Int
forall a. a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#id"
	><span class="hs-identifier hs-var"
	  >id</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-538"
      ></span
      ><span
      >        </span
      ><span class="hs-keyword"
      >else</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Maybe Int -&gt; Maybe Int) -&gt; Int -&gt; IntMap Int -&gt; IntMap Int
forall a. (Maybe a -&gt; Maybe a) -&gt; Int -&gt; IntMap a -&gt; IntMap a
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.IntMap.Strict.Internal.html#alter"
	><span class="hs-identifier hs-var"
	  >IntMap.alter</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Maybe Int -&gt; (Int -&gt; Maybe Int) -&gt; Maybe Int -&gt; Maybe Int
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Maybe.html#maybe"
	><span class="hs-identifier hs-var"
	  >maybe</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-var"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>1</span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-var"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Int -&gt; Maybe Int) -&gt; (Int -&gt; Int) -&gt; Int -&gt; Maybe Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#."
	><span class="hs-operator hs-var"
	  >.</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#%2B"
	><span class="hs-operator hs-var"
	  >+</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>1</span
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074684"
	><span class="hs-identifier hs-var"
	  >new</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-539"
      ></span
      ><span
      >    </span
      ><span id="local-6989586621682074685"
      ><span class="annot"
	><span class="annottext"
	  >dec :: IntMap Int -&gt; IntMap Int
</span
	  ><a href="#local-6989586621682074685"
	  ><span class="hs-identifier hs-var hs-var"
	    >dec</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      >
</span
      ><span id="line-540"
      ></span
      ><span
      >      </span
      ><span class="hs-keyword"
      >if</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074683"
	><span class="hs-identifier hs-var"
	  >old</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3D%3D"
	><span class="hs-operator hs-var"
	  >==</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>0</span
	></span
      ><span
      >
</span
      ><span id="line-541"
      ></span
      ><span
      >        </span
      ><span class="hs-keyword"
      >then</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int -&gt; IntMap Int
forall a. a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#id"
	><span class="hs-identifier hs-var"
	  >id</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-542"
      ></span
      ><span
      >        </span
      ><span class="hs-keyword"
      >else</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Int -&gt; Maybe Int) -&gt; Int -&gt; IntMap Int -&gt; IntMap Int
forall a. (a -&gt; Maybe a) -&gt; Int -&gt; IntMap a -&gt; IntMap a
</span
	><a href="https://hackage.haskell.org/package/containers-0.6.7/docs/src/Data.IntMap.Strict.Internal.html#update"
	><span class="hs-identifier hs-var"
	  >IntMap.update</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="hs-glyph"
      >\</span
      ><span id="local-6989586621682074701"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074701"
	  ><span class="hs-identifier hs-var"
	    >n</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="hs-keyword"
      >if</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074701"
	><span class="hs-identifier hs-var"
	  >n</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3C%3D"
	><span class="hs-operator hs-var"
	  >&lt;=</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>1</span
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >then</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe Int
forall a. Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >else</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Maybe Int
forall a. a -&gt; Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-var"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074701"
	><span class="hs-identifier hs-var"
	  >n</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#-"
	><span class="hs-glyph hs-var"
	  >-</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>1</span
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074683"
	><span class="hs-identifier hs-var"
	  >old</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-543"
      ></span
      ><span class="hs-pragma"
      >{-# INLINEABLE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#updateSizes"
	><span class="hs-pragma hs-type"
	  >updateSizes</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-544"
      ></span
      ><span
      >
</span
      ><span id="line-545"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>-- | \(O(n)\). Scale each token by the given constant factor.</span
	></span
      ><span
      >
</span
      ><span id="line-546"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#scaleValue"
	><span class="hs-identifier hs-type"
	  >scaleValue</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-bignum-1.3/docs/src/GHC.Num.Integer.html#Integer"
	><span class="hs-identifier hs-type"
	  >Integer</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Builtin.Result.html#BuiltinResult"
	><span class="hs-identifier hs-type"
	  >BuiltinResult</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-547"
      ></span
      ><span id="scaleValue"
      ><span class="annot"
	><span class="annottext"
	  >scaleValue :: Integer -&gt; Value -&gt; BuiltinResult Value
</span
	  ><a href="PlutusCore.Value.html#scaleValue"
	  ><span class="hs-identifier hs-var hs-var"
	    >scaleValue</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074702"
      ><span class="annot"
	><span class="annottext"
	  >Integer
</span
	  ><a href="#local-6989586621682074702"
	  ><span class="hs-identifier hs-var"
	    >c</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-type"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074703"
      ><span class="annot"
	><span class="annottext"
	  >NestedMap
</span
	  ><a href="#local-6989586621682074703"
	  ><span class="hs-identifier hs-var"
	    >outer</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074704"
      ><span class="annot"
	><span class="annottext"
	  >IntMap Int
</span
	  ><a href="#local-6989586621682074704"
	  ><span class="hs-identifier hs-var"
	    >sizes</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074705"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074705"
	  ><span class="hs-identifier hs-var"
	    >size</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074706"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621682074706"
	  ><span class="hs-identifier hs-var"
	    >neg</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-548"
      ></span
      ><span
      >  </span
      ><span class="hs-comment"
      >-- When scaling by positive factor, no need to change sizes and number of negative amounts.</span
      ><span
      >
</span
      ><span id="line-549"
      ></span
      ><span
      >  </span
      ><span class="hs-glyph"
      >|</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074702"
	><span class="hs-identifier hs-var"
	  >c</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3E"
	><span class="hs-operator hs-var"
	  >&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><span class="hs-number"
	>0</span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-keyword"
      >do</span
      ><span
      >
</span
      ><span id="line-550"
      ></span
      ><span
      >      </span
      ><span id="local-6989586621682074707"
      ><span class="annot"
	><span class="annottext"
	  >NestedMap
</span
	  ><a href="#local-6989586621682074707"
	  ><span class="hs-identifier hs-var"
	    >outer'</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >&lt;-</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; BuiltinResult NestedMap
</span
	><a href="#local-6989586621682074708"
	><span class="hs-identifier hs-var"
	  >go</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074703"
	><span class="hs-identifier hs-var"
	  >outer</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-551"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; BuiltinResult Value
forall a. a -&gt; BuiltinResult a
</span
	><a href="PlutusCore.Builtin.Result.html#BuiltinSuccess"
	><span class="hs-identifier hs-var"
	  >BuiltinSuccess</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Value -&gt; BuiltinResult Value) -&gt; Value -&gt; BuiltinResult Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; IntMap Int -&gt; Int -&gt; Int -&gt; Value
</span
	><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-var"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074707"
	><span class="hs-identifier hs-var"
	  >outer'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int
</span
	><a href="#local-6989586621682074704"
	><span class="hs-identifier hs-var"
	  >sizes</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074705"
	><span class="hs-identifier hs-var"
	  >size</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074706"
	><span class="hs-identifier hs-var"
	  >neg</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-552"
      ></span
      ><span
      >  </span
      ><span class="hs-comment"
      >-- When scaling by negative factor, only need to &quot;flip&quot; negative amounts.</span
      ><span
      >
</span
      ><span id="line-553"
      ></span
      ><span
      >  </span
      ><span class="hs-glyph"
      >|</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074702"
	><span class="hs-identifier hs-var"
	  >c</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Integer -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span
	><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Classes.html#%3C"
	><span class="hs-operator hs-var"
	  >&lt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><span class="hs-number"
	>0</span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-keyword"
      >do</span
      ><span
      >
</span
      ><span id="line-554"
      ></span
      ><span
      >      </span
      ><span id="local-6989586621682074709"
      ><span class="annot"
	><span class="annottext"
	  >NestedMap
</span
	  ><a href="#local-6989586621682074709"
	  ><span class="hs-identifier hs-var"
	    >outer'</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >&lt;-</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; BuiltinResult NestedMap
</span
	><a href="#local-6989586621682074708"
	><span class="hs-identifier hs-var"
	  >go</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074703"
	><span class="hs-identifier hs-var"
	  >outer</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-555"
      ></span
      ><span
      >      </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; BuiltinResult Value
forall a. a -&gt; BuiltinResult a
</span
	><a href="PlutusCore.Builtin.Result.html#BuiltinSuccess"
	><span class="hs-identifier hs-var"
	  >BuiltinSuccess</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Value -&gt; BuiltinResult Value) -&gt; Value -&gt; BuiltinResult Value
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap -&gt; IntMap Int -&gt; Int -&gt; Int -&gt; Value
</span
	><a href="PlutusCore.Value.html#Value"
	><span class="hs-identifier hs-var"
	  >Value</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074709"
	><span class="hs-identifier hs-var"
	  >outer'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>IntMap Int
</span
	><a href="#local-6989586621682074704"
	><span class="hs-identifier hs-var"
	  >sizes</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074705"
	><span class="hs-identifier hs-var"
	  >size</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074705"
	><span class="hs-identifier hs-var"
	  >size</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#-"
	><span class="hs-glyph hs-var"
	  >-</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621682074706"
	><span class="hs-identifier hs-var"
	  >neg</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-556"
      ></span
      ><span
      >  </span
      ><span class="hs-comment"
      >-- Scaling by 0 is always empty value</span
      ><span
      >
</span
      ><span id="line-557"
      ></span
      ><span
      >  </span
      ><span class="hs-glyph"
      >|</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Bool
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#otherwise"
	><span class="hs-identifier hs-var"
	  >otherwise</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value -&gt; BuiltinResult Value
forall a. a -&gt; BuiltinResult a
</span
	><a href="PlutusCore.Builtin.Result.html#BuiltinSuccess"
	><span class="hs-identifier hs-var"
	  >BuiltinSuccess</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Value
</span
	><a href="PlutusCore.Value.html#empty"
	><span class="hs-identifier hs-var"
	  >empty</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-558"
      ></span
      ><span
      >  </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-559"
      ></span
      ><span
      >    </span
      ><span class="annot"
      ><a href="#local-6989586621682074708"
	><span class="hs-identifier hs-type"
	  >go</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#NestedMap"
	><span class="hs-identifier hs-type"
	  >NestedMap</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Builtin.Result.html#BuiltinResult"
	><span class="hs-identifier hs-type"
	  >BuiltinResult</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#NestedMap"
	><span class="hs-identifier hs-type"
	  >NestedMap</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-560"
      ></span
      ><span
      >    </span
      ><span id="local-6989586621682074708"
      ><span class="annot"
	><span class="annottext"
	  >go :: NestedMap -&gt; BuiltinResult NestedMap
</span
	  ><a href="#local-6989586621682074708"
	  ><span class="hs-identifier hs-var hs-var"
	    >go</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074710"
      ><span class="annot"
	><span class="annottext"
	  >NestedMap
</span
	  ><a href="#local-6989586621682074710"
	  ><span class="hs-identifier hs-var"
	    >x</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(Map K Quantity -&gt; BuiltinResult (Map K Quantity))
-&gt; NestedMap -&gt; BuiltinResult NestedMap
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; Map K a -&gt; f (Map K b)
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Traversable.html#traverse"
	><span class="hs-identifier hs-var"
	  >traverse</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>(Quantity -&gt; BuiltinResult Quantity)
-&gt; Map K Quantity -&gt; BuiltinResult (Map K Quantity)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
forall (f :: * -&gt; *) a b.
Applicative f =&gt;
(a -&gt; f b) -&gt; Map K a -&gt; f (Map K b)
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Traversable.html#traverse"
	><span class="hs-identifier hs-var"
	  >traverse</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; BuiltinResult Quantity
</span
	><a href="#local-6989586621682074712"
	><span class="hs-identifier hs-var"
	  >goScale</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>NestedMap
</span
	><a href="#local-6989586621682074710"
	><span class="hs-identifier hs-var"
	  >x</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-561"
      ></span
      ><span
      >    </span
      ><span class="annot"
      ><a href="#local-6989586621682074712"
	><span class="hs-identifier hs-type"
	  >goScale</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Builtin.Result.html#BuiltinResult"
	><span class="hs-identifier hs-type"
	  >BuiltinResult</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Value.html#Quantity"
	><span class="hs-identifier hs-type"
	  >Quantity</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-562"
      ></span
      ><span
      >    </span
      ><span id="local-6989586621682074712"
      ><span class="annot"
	><span class="annottext"
	  >goScale :: Quantity -&gt; BuiltinResult Quantity
</span
	  ><a href="#local-6989586621682074712"
	  ><span class="hs-identifier hs-var hs-var"
	    >goScale</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621682074713"
      ><span class="annot"
	><span class="annottext"
	  >Quantity
</span
	  ><a href="#local-6989586621682074713"
	  ><span class="hs-identifier hs-var"
	    >x</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      >
</span
      ><span id="line-563"
      ></span
      ><span
      >      </span
      ><span class="hs-keyword"
      >case</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; Quantity -&gt; Maybe Quantity
</span
	><a href="PlutusCore.Value.html#scaleQuantity"
	><span class="hs-identifier hs-var"
	  >scaleQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074702"
	><span class="hs-identifier hs-var"
	  >c</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074713"
	><span class="hs-identifier hs-var"
	  >x</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >of</span
      ><span
      >
</span
      ><span id="line-564"
      ></span
      ><span
      >        </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe Quantity
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      >
</span
      ><span id="line-565"
      ></span
      ><span
      >          </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; BuiltinResult Quantity
forall a. String -&gt; BuiltinResult a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Control.Monad.Fail.html#fail"
	><span class="hs-identifier hs-var"
	  >fail</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>(String -&gt; BuiltinResult Quantity)
-&gt; String -&gt; BuiltinResult Quantity
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%24"
	><span class="hs-operator hs-var"
	  >$</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-566"
      ></span
      ><span
      >            </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot;scaleValue: quantity out of bounds: &quot;</span
	></span
      ><span
      >
</span
      ><span id="line-567"
      ></span
      ><span
      >              </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%3C%3E"
	><span class="hs-operator hs-var"
	  >&lt;&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Show.html#show"
	><span class="hs-identifier hs-var"
	  >show</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer
</span
	><a href="#local-6989586621682074702"
	><span class="hs-identifier hs-var"
	  >c</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-568"
      ></span
      ><span
      >              </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%3C%3E"
	><span class="hs-operator hs-var"
	  >&lt;&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>String
</span
	><span class="hs-string"
	>&quot; * &quot;</span
	></span
      ><span
      >
</span
      ><span id="line-569"
      ></span
      ><span
      >              </span
      ><span class="annot"
      ><span class="annottext"
	>String -&gt; ShowS
forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%3C%3E"
	><span class="hs-operator hs-var"
	  >&lt;&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Integer -&gt; String
forall a. Show a =&gt; a -&gt; String
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Show.html#show"
	><span class="hs-identifier hs-var"
	  >show</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; Integer
</span
	><a href="PlutusCore.Value.html#unQuantity"
	><span class="hs-identifier hs-var"
	  >unQuantity</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074713"
	><span class="hs-identifier hs-var"
	  >x</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-570"
      ></span
      ><span
      >        </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-type"
	  >Just</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621682074714"
      ><span class="annot"
	><span class="annottext"
	  >Quantity
</span
	  ><a href="#local-6989586621682074714"
	  ><span class="hs-identifier hs-var"
	    >q</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity -&gt; BuiltinResult Quantity
forall a. a -&gt; BuiltinResult a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#pure"
	><span class="hs-identifier hs-var"
	  >pure</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Quantity
</span
	><a href="#local-6989586621682074714"
	><span class="hs-identifier hs-var"
	  >q</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-571"
      ></span
      ></pre
    ></body
  ></html
>
