<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
><head
  ><link rel="stylesheet" type="text/css" href="style.css"
     /><script type="text/javascript" src="highlight.js"
    ></script
    ></head
  ><body
  ><pre
    ><span class="hs-pragma"
      >{-# LANGUAGE AllowAmbiguousTypes #-}</span
      ><span
      >
</span
      ><span id="line-2"
      ></span
      ><span class="hs-pragma"
      >{-# LANGUAGE BangPatterns #-}</span
      ><span
      >
</span
      ><span id="line-3"
      ></span
      ><span class="hs-pragma"
      >{-# LANGUAGE DataKinds #-}</span
      ><span
      >
</span
      ><span id="line-4"
      ></span
      ><span class="hs-pragma"
      >{-# LANGUAGE FlexibleInstances #-}</span
      ><span
      >
</span
      ><span id="line-5"
      ></span
      ><span class="hs-pragma"
      >{-# LANGUAGE MultiParamTypeClasses #-}</span
      ><span
      >
</span
      ><span id="line-6"
      ></span
      ><span class="hs-pragma"
      >{-# LANGUAGE ScopedTypeVariables #-}</span
      ><span
      >
</span
      ><span id="line-7"
      ></span
      ><span class="hs-pragma"
      >{-# LANGUAGE StandaloneKindSignatures #-}</span
      ><span
      >
</span
      ><span id="line-8"
      ></span
      ><span class="hs-pragma"
      >{-# LANGUAGE TypeApplications #-}</span
      ><span
      >
</span
      ><span id="line-9"
      ></span
      ><span class="hs-pragma"
      >{-# LANGUAGE TypeFamilies #-}</span
      ><span
      >
</span
      ><span id="line-10"
      ></span
      ><span class="hs-pragma"
      >{-# LANGUAGE TypeOperators #-}</span
      ><span
      >
</span
      ><span id="line-11"
      ></span
      ><span class="hs-pragma"
      >{-# LANGUAGE UndecidableInstances #-}</span
      ><span
      >
</span
      ><span id="line-12"
      ></span
      ><span
      >
</span
      ><span id="line-13"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>{-| Static loop unrolling utilities using type-level Peano numbers.

This module provides utilities for statically unrolling loops at compile time.
GHC resolves the type class instances at compile time, resulting in unrolled
code that avoids runtime overhead.

See Note [Static loop unrolling] for details on the technique. -}</span
	></span
      ><span
      >
</span
      ><span id="line-20"
      ></span
      ><span class="hs-keyword"
      >module</span
      ><span
      > </span
      ><span class="hs-identifier"
      >PlutusCore.Unroll</span
      ><span
      >
</span
      ><span id="line-21"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >(</span
      ><span
      > </span
      ><span class="annot"
      ><span class="hs-comment"
	>-- * Peano numbers</span
	></span
      ><span
      >
</span
      ><span id="line-22"
      ></span
      ><span
      >    </span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#Peano"
	><span class="hs-identifier"
	  >Peano</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="hs-glyph"
      >..</span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-23"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#NatToPeano"
	><span class="hs-identifier"
	  >NatToPeano</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-24"
      ></span
      ><span
      >
</span
      ><span id="line-25"
      ></span
      ><span
      >    </span
      ><span class="annot"
      ><span class="hs-comment"
	>-- * Statically unrolled list drop</span
	></span
      ><span
      >
</span
      ><span id="line-26"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#Drop"
	><span class="hs-identifier"
	  >Drop</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="hs-glyph"
      >..</span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-27"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#dropN"
	><span class="hs-identifier"
	  >dropN</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-28"
      ></span
      ><span
      >
</span
      ><span id="line-29"
      ></span
      ><span
      >    </span
      ><span class="annot"
      ><span class="hs-comment"
	>-- * Statically unrolled effectful iteration</span
	></span
      ><span
      >
</span
      ><span id="line-30"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#UpwardsM"
	><span class="hs-identifier"
	  >UpwardsM</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="hs-glyph"
      >..</span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-31"
      ></span
      ><span
      >  </span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-32"
      ></span
      ><span
      >
</span
      ><span id="line-33"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/Data.Kind.html"
	><span class="hs-identifier"
	  >Data.Kind</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Constraint"
	><span class="hs-identifier"
	  >Constraint</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Type"
	><span class="hs-identifier"
	  >Type</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-34"
      ></span
      ><span class="hs-keyword"
      >import</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.TypeNats.html"
	><span class="hs-identifier"
	  >GHC.TypeNats</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.TypeNats.html#Nat"
	><span class="hs-identifier"
	  >Nat</span
	  ></a
	></span
      ><span class="hs-special"
      >,</span
      ><span
      > </span
      ><span class="hs-keyword"
      >type</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="hs-glyph"
      >-</span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-35"
      ></span
      ><span
      >
</span
      ><span id="line-36"
      ></span
      ><span class="hs-comment"
      >{- Note [Static loop unrolling]
To avoid runtime loop overhead, we use type-level Peano numbers to guide instance
resolution. GHC resolves the instances at compile time and unrolls the loop into
straight-line code.

For example, 'dropN @3' becomes pattern matching equivalent to:
  case xs of
    (_:_:_:rest) -&gt; Just rest
    _ -&gt; Nothing

And 'upwardsM @_ @(NatToPeano 3) 0 k' becomes:
  k 0 *&gt; k 1 *&gt; k 2

Benefits:
1. No runtime recursion overhead
2. No allocations for intermediate structures
3. GHC can optimize the unrolled code very well
4. Instance resolution happens entirely at compile time

The technique was originally used in the CEK machine step counter:
https://github.com/IntersectMBO/plutus/pull/5265
-}</span
      ><span
      >
</span
      ><span id="line-58"
      ></span
      ><span
      >
</span
      ><span id="line-59"
      ></span
      ><span class="hs-comment"
      >--------------------------------------------------------------------------------</span
      ><span
      >
</span
      ><span id="line-60"
      ></span
      ><span class="hs-comment"
      >-- Peano numbers ---------------------------------------------------------------</span
      ><span
      >
</span
      ><span id="line-61"
      ></span
      ><span
      >
</span
      ><span id="line-62"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>-- | Peano representation of natural numbers for type-level recursion.</span
	></span
      ><span
      >
</span
      ><span id="line-63"
      ></span
      ><span class="hs-keyword"
      >data</span
      ><span
      > </span
      ><span id="Peano"
      ><span class="annot"
	><a href="PlutusCore.Unroll.html#Peano"
	  ><span class="hs-identifier hs-var"
	    >Peano</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span id="Z"
      ><span class="annot"
	><a href="PlutusCore.Unroll.html#Z"
	  ><span class="hs-identifier hs-var"
	    >Z</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >|</span
      ><span
      > </span
      ><span id="S"
      ><span class="annot"
	><a href="PlutusCore.Unroll.html#S"
	  ><span class="hs-identifier hs-var"
	    >S</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#Peano"
	><span class="hs-identifier hs-type"
	  >Peano</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-64"
      ></span
      ><span
      >
</span
      ><span id="line-65"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>-- | Convert a type-level 'Nat' to 'Peano' form for instance resolution.</span
	></span
      ><span
      >
</span
      ><span id="line-66"
      ></span
      ><span class="hs-keyword"
      >type</span
      ><span
      > </span
      ><span class="hs-keyword"
      >family</span
      ><span
      > </span
      ><span id="NatToPeano"
      ><span class="annot"
	><a href="PlutusCore.Unroll.html#NatToPeano"
	  ><span class="hs-identifier hs-var"
	    >NatToPeano</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621681947551"
      ><span class="annot"
	><a href="#local-6989586621681947551"
	  ><span class="hs-identifier hs-type"
	    >n</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.TypeNats.html#Nat"
	><span class="hs-identifier hs-type"
	  >Nat</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#Peano"
	><span class="hs-identifier hs-type"
	  >Peano</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-67"
      ></span
      ><span
      >  </span
      ><span id="NatToPeano"
      ><span class="annot"
	><a href="PlutusCore.Unroll.html#NatToPeano"
	  ><span class="hs-identifier hs-var"
	    >NatToPeano</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="hs-number"
	>0</span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-special"
      >'</span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#Z"
	><span class="hs-identifier hs-type"
	  >Z</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-68"
      ></span
      ><span
      >  </span
      ><span id="NatToPeano"
      ><span class="annot"
	><a href="PlutusCore.Unroll.html#NatToPeano"
	  ><span class="hs-identifier hs-var"
	    >NatToPeano</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621681947552"
      ><span class="annot"
	><a href="#local-6989586621681947552"
	  ><span class="hs-identifier hs-type hs-type"
	    >n</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="hs-special"
      >'</span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#S"
	><span class="hs-identifier hs-type"
	  >S</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#NatToPeano"
	><span class="hs-identifier hs-type"
	  >NatToPeano</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="#local-6989586621681947552"
	><span class="hs-identifier hs-type"
	  >n</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.TypeNats.html#-"
	><span class="hs-glyph hs-type"
	  >-</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="hs-number"
	>1</span
	></span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-69"
      ></span
      ><span
      >
</span
      ><span id="line-70"
      ></span
      ><span class="hs-comment"
      >--------------------------------------------------------------------------------</span
      ><span
      >
</span
      ><span id="line-71"
      ></span
      ><span class="hs-comment"
      >-- Statically unrolled list drop -----------------------------------------------</span
      ><span
      >
</span
      ><span id="line-72"
      ></span
      ><span
      >
</span
      ><span id="line-73"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>{-| Statically unrolled drop: drops exactly @n@ elements if possible.
Returns 'Nothing' if the list has fewer than @n@ elements.

The @n@ parameter is a 'Peano' number that guides instance resolution.
Use 'dropN' for a more convenient interface with 'Nat' literals. -}</span
	></span
      ><span
      >
</span
      ><span id="line-78"
      ></span
      ><span class="hs-keyword"
      >class</span
      ><span
      > </span
      ><span id="Drop"
      ><span class="annot"
	><a href="PlutusCore.Unroll.html#Drop"
	  ><span class="hs-identifier hs-var"
	    >Drop</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span id="local-6989586621681947523"
      ><span class="annot"
	><a href="#local-6989586621681947523"
	  ><span class="hs-identifier hs-type"
	    >n</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#Peano"
	><span class="hs-identifier hs-type"
	  >Peano</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-79"
      ></span
      ><span
      >  </span
      ><span id="drop%27"
      ><span class="annot"
	><a href="PlutusCore.Unroll.html#drop%27"
	  ><span class="hs-identifier hs-type"
	    >drop'</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span id="local-6989586621681947519"
      ><span class="hs-special"
	>[</span
	><span class="annot"
	><a href="#local-6989586621681947519"
	  ><span class="hs-identifier hs-type"
	    >a</span
	    ></a
	  ></span
	><span class="hs-special"
	>]</span
	><span
	> </span
	><span class="hs-glyph"
	>-&gt;</span
	><span
	> </span
	><span class="annot"
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Maybe"
	  ><span class="hs-identifier hs-type"
	    >Maybe</span
	    ></a
	  ></span
	><span
	> </span
	><span class="hs-special"
	>[</span
	><span class="annot"
	><a href="#local-6989586621681947519"
	  ><span class="hs-identifier hs-type"
	    >a</span
	    ></a
	  ></span
	><span class="hs-special"
	>]</span
	></span
      ><span
      >
</span
      ><span id="line-80"
      ></span
      ><span
      >
</span
      ><span id="line-81"
      ></span
      ><span class="hs-keyword"
      >instance</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#Drop"
	><span class="hs-identifier hs-type"
	  >Drop</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >'</span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#Z"
	><span class="hs-identifier hs-type"
	  >Z</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-82"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621681947557"
      ><span class="annot"
	><span class="annottext"
	  >drop' :: forall a. [a] -&gt; Maybe [a]
</span
	  ><a href="PlutusCore.Unroll.html#drop%27"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >drop'</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[a] -&gt; Maybe [a]
forall a. a -&gt; Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Just"
	><span class="hs-identifier hs-var"
	  >Just</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-83"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#drop%27"
	><span class="hs-pragma hs-type"
	  >drop'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-84"
      ></span
      ><span
      >
</span
      ><span id="line-85"
      ></span
      ><span class="hs-keyword"
      >instance</span
      ><span
      > </span
      ><span id="local-6989586621681947528"
      ><span class="annot"
	><a href="PlutusCore.Unroll.html#Drop"
	  ><span class="hs-identifier hs-type"
	    >Drop</span
	    ></a
	  ></span
	><span
	> </span
	><span class="annot"
	><a href="#local-6989586621681947528"
	  ><span class="hs-identifier hs-type"
	    >n</span
	    ></a
	  ></span
	><span
	> </span
	><span class="hs-glyph"
	>=&gt;</span
	><span
	> </span
	><span class="annot"
	><a href="PlutusCore.Unroll.html#Drop"
	  ><span class="hs-identifier hs-type"
	    >Drop</span
	    ></a
	  ></span
	><span
	> </span
	><span class="hs-special"
	>(</span
	><span class="hs-special"
	>'</span
	><span class="annot"
	><a href="PlutusCore.Unroll.html#S"
	  ><span class="hs-identifier hs-type"
	    >S</span
	    ></a
	  ></span
	><span
	> </span
	><span class="annot"
	><a href="#local-6989586621681947528"
	  ><span class="hs-identifier hs-type"
	    >n</span
	    ></a
	  ></span
	><span class="hs-special"
	>)</span
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-86"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621681947562"
      ><span class="annot"
	><span class="annottext"
	  >drop' :: forall a. [a] -&gt; Maybe [a]
</span
	  ><a href="PlutusCore.Unroll.html#drop%27"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >drop'</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-special"
      >[</span
      ><span class="hs-special"
      >]</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Maybe [a]
forall a. Maybe a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Nothing"
	><span class="hs-identifier hs-var"
	  >Nothing</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-87"
      ></span
      ><span
      >  </span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#drop%27"
	><span class="hs-identifier hs-var"
	  >drop'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>a
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#%3A"
	><span class="hs-glyph hs-type"
	  >:</span
	  ></a
	></span
      ><span
      > </span
      ><span id="local-6989586621681947563"
      ><span class="annot"
	><span class="annottext"
	  >[a]
</span
	  ><a href="#local-6989586621681947563"
	  ><span class="hs-identifier hs-var"
	    >xs</span
	    ></a
	  ></span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>forall (n :: Peano) a. Drop n =&gt; [a] -&gt; Maybe [a]
</span
	><a href="PlutusCore.Unroll.html#drop%27"
	><span class="hs-identifier hs-var"
	  >drop'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >@</span
      ><span class="annot"
      ><a href="#local-6989586621681947528"
	><span class="hs-identifier hs-type"
	  >n</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>[a]
</span
	><a href="#local-6989586621681947563"
	><span class="hs-identifier hs-var"
	  >xs</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-88"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#drop%27"
	><span class="hs-pragma hs-type"
	  >drop'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-89"
      ></span
      ><span
      >
</span
      ><span id="line-90"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>{-| Drop exactly @n@ elements from a list, returning 'Nothing' if too short.

The drop count is statically unrolled at compile time via instance resolution.

@
dropN \@3 [1,2,3,4,5] == Just [4,5]
dropN \@3 [1,2]       == Nothing
@ -}</span
	></span
      ><span
      >
</span
      ><span id="line-98"
      ></span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#dropN"
	><span class="hs-identifier hs-type"
	  >dropN</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="hs-keyword"
      >forall</span
      ><span
      > </span
      ><span id="local-6989586621681947531"
      ><span class="annot"
	><a href="#local-6989586621681947531"
	  ><span class="hs-identifier hs-type"
	    >n</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621681947533"
      ><span class="annot"
	><a href="#local-6989586621681947533"
	  ><span class="hs-identifier hs-type"
	    >a</span
	    ></a
	  ></span
	></span
      ><span class="hs-operator"
      >.</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#Drop"
	><span class="hs-identifier hs-type"
	  >Drop</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#NatToPeano"
	><span class="hs-identifier hs-type"
	  >NatToPeano</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="#local-6989586621681947531"
	><span class="hs-identifier hs-type"
	  >n</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >=&gt;</span
      ><span
      > </span
      ><span class="hs-special"
      >[</span
      ><span class="annot"
      ><a href="#local-6989586621681947533"
	><span class="hs-identifier hs-type"
	  >a</span
	  ></a
	></span
      ><span class="hs-special"
      >]</span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Maybe.html#Maybe"
	><span class="hs-identifier hs-type"
	  >Maybe</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >[</span
      ><span class="annot"
      ><a href="#local-6989586621681947533"
	><span class="hs-identifier hs-type"
	  >a</span
	  ></a
	></span
      ><span class="hs-special"
      >]</span
      ><span
      >
</span
      ><span id="line-99"
      ></span
      ><span id="dropN"
      ><span class="annot"
	><span class="annottext"
	  >dropN :: forall (n :: Nat) a. Drop (NatToPeano n) =&gt; [a] -&gt; Maybe [a]
</span
	  ><a href="PlutusCore.Unroll.html#dropN"
	  ><span class="hs-identifier hs-var hs-var"
	    >dropN</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>forall (n :: Peano) a. Drop n =&gt; [a] -&gt; Maybe [a]
</span
	><a href="PlutusCore.Unroll.html#drop%27"
	><span class="hs-identifier hs-var"
	  >drop'</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >@</span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#NatToPeano"
	><span class="hs-identifier hs-type"
	  >NatToPeano</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="#local-6989586621681947531"
	><span class="hs-identifier hs-type"
	  >n</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-100"
      ></span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#dropN"
	><span class="hs-pragma hs-type"
	  >dropN</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-101"
      ></span
      ><span
      >
</span
      ><span id="line-102"
      ></span
      ><span class="hs-comment"
      >--------------------------------------------------------------------------------</span
      ><span
      >
</span
      ><span id="line-103"
      ></span
      ><span class="hs-comment"
      >-- Statically unrolled effectful iteration -------------------------------------</span
      ><span
      >
</span
      ><span id="line-104"
      ></span
      ><span
      >
</span
      ><span id="line-105"
      ></span
      ><span class="annot"
      ><span class="hs-comment"
	>{-| Statically unrolled effectful iteration over a range.

@upwardsM i k@ means @k i *&gt; k (i + 1) *&gt; ... *&gt; k (i + n - 1)@.

We use this to statically unroll loops through instance resolution.
This makes validation benchmarks a couple of percent faster. -}</span
	></span
      ><span
      >
</span
      ><span id="line-111"
      ></span
      ><span class="hs-keyword"
      >type</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#UpwardsM"
	><span class="hs-identifier hs-type"
	  >UpwardsM</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Type"
	><span class="hs-identifier hs-type"
	  >Type</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Type"
	><span class="hs-identifier hs-type"
	  >Type</span
	  ></a
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#Peano"
	><span class="hs-identifier hs-type"
	  >Peano</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Constraint"
	><span class="hs-identifier hs-type"
	  >Constraint</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-112"
      ></span
      ><span class="hs-keyword"
      >class</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#Applicative"
	><span class="hs-identifier hs-type"
	  >Applicative</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><a href="#local-6989586621681947536"
	><span class="hs-identifier hs-type"
	  >f</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=&gt;</span
      ><span
      > </span
      ><span id="UpwardsM"
      ><span class="annot"
	><a href="PlutusCore.Unroll.html#UpwardsM"
	  ><span class="hs-identifier hs-var"
	    >UpwardsM</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621681947536"
      ><span class="annot"
	><a href="#local-6989586621681947536"
	  ><span class="hs-identifier hs-type"
	    >f</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621681947537"
      ><span class="annot"
	><a href="#local-6989586621681947537"
	  ><span class="hs-identifier hs-type"
	    >n</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-113"
      ></span
      ><span
      >  </span
      ><span id="upwardsM"
      ><span class="annot"
	><a href="PlutusCore.Unroll.html#upwardsM"
	  ><span class="hs-identifier hs-type"
	    >upwardsM</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >::</span
      ><span
      > </span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><a href="https://hackage.haskell.org/package/ghc-prim-0.10.0/docs/src/GHC.Types.html#Int"
	><span class="hs-identifier hs-type"
	  >Int</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="#local-6989586621681947536"
	><span class="hs-identifier hs-type"
	  >f</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="hs-special"
      >)</span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="hs-glyph"
      >-&gt;</span
      ><span
      > </span
      ><span class="annot"
      ><a href="#local-6989586621681947536"
	><span class="hs-identifier hs-type"
	  >f</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-114"
      ></span
      ><span
      >
</span
      ><span id="line-115"
      ></span
      ><span class="hs-keyword"
      >instance</span
      ><span
      > </span
      ><span id="local-6989586621681947540"
      ><span class="annot"
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#Applicative"
	  ><span class="hs-identifier hs-type"
	    >Applicative</span
	    ></a
	  ></span
	><span
	> </span
	><span class="annot"
	><a href="#local-6989586621681947540"
	  ><span class="hs-identifier hs-type"
	    >f</span
	    ></a
	  ></span
	><span
	> </span
	><span class="hs-glyph"
	>=&gt;</span
	><span
	> </span
	><span class="annot"
	><a href="PlutusCore.Unroll.html#UpwardsM"
	  ><span class="hs-identifier hs-type"
	    >UpwardsM</span
	    ></a
	  ></span
	><span
	> </span
	><span class="annot"
	><a href="#local-6989586621681947540"
	  ><span class="hs-identifier hs-type"
	    >f</span
	    ></a
	  ></span
	><span
	> </span
	><span class="hs-special"
	>'</span
	><span class="annot"
	><a href="PlutusCore.Unroll.html#Z"
	  ><span class="hs-identifier hs-type"
	    >Z</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-116"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621681947575"
      ><span class="annot"
	><span class="annottext"
	  >upwardsM :: Int -&gt; (Int -&gt; f ()) -&gt; f ()
</span
	  ><a href="PlutusCore.Unroll.html#upwardsM"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >upwardsM</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; f ()
</span
	><span class="hs-identifier"
	>_</span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>() -&gt; f ()
forall a. a -&gt; f a
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#pure"
	><span class="hs-identifier hs-var"
	  >pure</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="hs-special"
      >)</span
      ><span
      >
</span
      ><span id="line-117"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#upwardsM"
	><span class="hs-pragma hs-type"
	  >upwardsM</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-118"
      ></span
      ><span
      >
</span
      ><span id="line-119"
      ></span
      ><span class="hs-keyword"
      >instance</span
      ><span
      > </span
      ><span id="local-6989586621681947545"
      ><span id="local-6989586621681947546"
	><span class="annot"
	  ><a href="PlutusCore.Unroll.html#UpwardsM"
	    ><span class="hs-identifier hs-type"
	      >UpwardsM</span
	      ></a
	    ></span
	  ><span
	  > </span
	  ><span class="annot"
	  ><a href="#local-6989586621681947545"
	    ><span class="hs-identifier hs-type"
	      >f</span
	      ></a
	    ></span
	  ><span
	  > </span
	  ><span class="annot"
	  ><a href="#local-6989586621681947546"
	    ><span class="hs-identifier hs-type"
	      >n</span
	      ></a
	    ></span
	  ><span
	  > </span
	  ><span class="hs-glyph"
	  >=&gt;</span
	  ><span
	  > </span
	  ><span class="annot"
	  ><a href="PlutusCore.Unroll.html#UpwardsM"
	    ><span class="hs-identifier hs-type"
	      >UpwardsM</span
	      ></a
	    ></span
	  ><span
	  > </span
	  ><span class="annot"
	  ><a href="#local-6989586621681947545"
	    ><span class="hs-identifier hs-type"
	      >f</span
	      ></a
	    ></span
	  ><span
	  > </span
	  ><span class="hs-special"
	  >(</span
	  ><span class="hs-special"
	  >'</span
	  ><span class="annot"
	  ><a href="PlutusCore.Unroll.html#S"
	    ><span class="hs-identifier hs-type"
	      >S</span
	      ></a
	    ></span
	  ><span
	  > </span
	  ><span class="annot"
	  ><a href="#local-6989586621681947546"
	    ><span class="hs-identifier hs-type"
	      >n</span
	      ></a
	    ></span
	  ><span class="hs-special"
	  >)</span
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-keyword"
      >where</span
      ><span
      >
</span
      ><span id="line-120"
      ></span
      ><span
      >  </span
      ><span id="local-6989586621681947587"
      ><span class="annot"
	><span class="annottext"
	  >upwardsM :: Int -&gt; (Int -&gt; f ()) -&gt; f ()
</span
	  ><a href="PlutusCore.Unroll.html#upwardsM"
	  ><span class="hs-identifier hs-var hs-var hs-var hs-var"
	    >upwardsM</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >!</span
      ><span id="local-6989586621681947588"
      ><span class="annot"
	><span class="annottext"
	  >Int
</span
	  ><a href="#local-6989586621681947588"
	  ><span class="hs-identifier hs-var"
	    >i</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span id="local-6989586621681947589"
      ><span class="annot"
	><span class="annottext"
	  >Int -&gt; f ()
</span
	  ><a href="#local-6989586621681947589"
	  ><span class="hs-identifier hs-var"
	    >k</span
	    ></a
	  ></span
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >=</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; f ()
</span
	><a href="#local-6989586621681947589"
	><span class="hs-identifier hs-var"
	  >k</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621681947588"
	><span class="hs-identifier hs-var"
	  >i</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>f () -&gt; f () -&gt; f ()
forall a b. f a -&gt; f b -&gt; f b
forall (f :: * -&gt; *) a b. Applicative f =&gt; f a -&gt; f b -&gt; f b
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Base.html#%2A%3E"
	><span class="hs-operator hs-var"
	  >*&gt;</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>forall (f :: * -&gt; *) (n :: Peano).
UpwardsM f n =&gt;
Int -&gt; (Int -&gt; f ()) -&gt; f ()
</span
	><a href="PlutusCore.Unroll.html#upwardsM"
	><span class="hs-identifier hs-var"
	  >upwardsM</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >@</span
      ><span class="annot"
      ><a href="#local-6989586621681947545"
	><span class="hs-identifier hs-type"
	  >f</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-glyph"
      >@</span
      ><span class="annot"
      ><a href="#local-6989586621681947546"
	><span class="hs-identifier hs-type"
	  >n</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-special"
      >(</span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><a href="#local-6989586621681947588"
	><span class="hs-identifier hs-var"
	  >i</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span
	><a href="https://hackage.haskell.org/package/base-4.18.3.0/docs/src/GHC.Num.html#%2B"
	><span class="hs-operator hs-var"
	  >+</span
	  ></a
	></span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int
</span
	><span class="hs-number"
	>1</span
	></span
      ><span class="hs-special"
      >)</span
      ><span
      > </span
      ><span class="annot"
      ><span class="annottext"
	>Int -&gt; f ()
</span
	><a href="#local-6989586621681947589"
	><span class="hs-identifier hs-var"
	  >k</span
	  ></a
	></span
      ><span
      >
</span
      ><span id="line-121"
      ></span
      ><span
      >  </span
      ><span class="hs-pragma"
      >{-# INLINE</span
      ><span
      > </span
      ><span class="annot"
      ><a href="PlutusCore.Unroll.html#upwardsM"
	><span class="hs-pragma hs-type"
	  >upwardsM</span
	  ></a
	></span
      ><span
      > </span
      ><span class="hs-pragma"
      >#-}</span
      ><span
      >
</span
      ><span id="line-122"
      ></span
      ></pre
    ></body
  ></html
>
