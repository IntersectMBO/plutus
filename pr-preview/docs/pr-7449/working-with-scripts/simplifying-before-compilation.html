<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-working-with-scripts/simplifying-before-compilation" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.0">
<title data-rh="true">Simplifying Code Before Compilation | Plinth and Plutus Core Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://plutus.cardano.intersectmbo.org/pr-preview/docs/pr-7449/img/docusaurus-social-card.png"><meta data-rh="true" name="twitter:image" content="https://plutus.cardano.intersectmbo.org/pr-preview/docs/pr-7449/img/docusaurus-social-card.png"><meta data-rh="true" property="og:url" content="https://plutus.cardano.intersectmbo.org/pr-preview/docs/pr-7449/working-with-scripts/simplifying-before-compilation"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Simplifying Code Before Compilation | Plinth and Plutus Core Documentation"><meta data-rh="true" name="description" content="Much like in regular Haskell, simplifying or expanding certain Plinth code before compilation can make it more efficient."><meta data-rh="true" property="og:description" content="Much like in regular Haskell, simplifying or expanding certain Plinth code before compilation can make it more efficient."><link data-rh="true" rel="icon" href="/pr-preview/docs/pr-7449/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://plutus.cardano.intersectmbo.org/pr-preview/docs/pr-7449/working-with-scripts/simplifying-before-compilation"><link data-rh="true" rel="alternate" href="https://plutus.cardano.intersectmbo.org/pr-preview/docs/pr-7449/working-with-scripts/simplifying-before-compilation" hreflang="en"><link data-rh="true" rel="alternate" href="https://plutus.cardano.intersectmbo.org/pr-preview/docs/pr-7449/working-with-scripts/simplifying-before-compilation" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X6364ZT8L2"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-X6364ZT8L2",{anonymize_ip:!0})</script><link rel="stylesheet" href="/pr-preview/docs/pr-7449/assets/css/styles.225deb0a.css">
<script src="/pr-preview/docs/pr-7449/assets/js/runtime~main.99b91a75.js" defer="defer"></script>
<script src="/pr-preview/docs/pr-7449/assets/js/main.8d0da57f.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/pr-preview/docs/pr-7449/"><div class="navbar__logo"><img src="/pr-preview/docs/pr-7449/img/logo.svg" alt="Plutus Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/pr-preview/docs/pr-7449/img/logo.svg" alt="Plutus Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Plutus</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/pr-preview/docs/pr-7449/">User guide</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item"><a href="https://github.com/IntersectMBO/plutus" class="github-link" target="_blank"></a></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pr-preview/docs/pr-7449/">Plinth User Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pr-preview/docs/pr-7449/category/essential-concepts">Essential concepts</a><button aria-label="Expand sidebar category &#x27;Essential concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pr-preview/docs/pr-7449/category/example-an-auction-smart-contract">Example: An Auction Smart Contract</a><button aria-label="Expand sidebar category &#x27;Example: An Auction Smart Contract&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pr-preview/docs/pr-7449/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pr-preview/docs/pr-7449/haddock-documentation">Haddock Documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pr-preview/docs/pr-7449/category/using-plinth">Using Plinth</a><button aria-label="Expand sidebar category &#x27;Using Plinth&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/pr-preview/docs/pr-7449/category/working-with-scripts">Working with scripts</a><button aria-label="Collapse sidebar category &#x27;Working with scripts&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pr-preview/docs/pr-7449/working-with-scripts/ledger-language-version">Plutus Ledger Language Version (Plutus V1/V2/V3)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pr-preview/docs/pr-7449/working-with-scripts/script-purposes">Script Purposes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pr-preview/docs/pr-7449/working-with-scripts/producing-a-blueprint">Producing a Plutus contract blueprint</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pr-preview/docs/pr-7449/working-with-scripts/optimizing-scripts-with-asData">Optimizing Scripts with asData</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/pr-preview/docs/pr-7449/working-with-scripts/simplifying-before-compilation">Simplifying Code Before Compilation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pr-preview/docs/pr-7449/working-with-scripts/compile-time-evaluation">Compile Time Evaluation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pr-preview/docs/pr-7449/working-with-scripts/other-optimization-techniques">Other Optimization Techniques</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/pr-preview/docs/pr-7449/working-with-scripts/profiling-budget-usage">Profiling Script Budget Usage</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pr-preview/docs/pr-7449/category/delve-deeper">Delve Deeper</a><button aria-label="Expand sidebar category &#x27;Delve Deeper&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pr-preview/docs/pr-7449/category/upcoming-features">Upcoming Features</a><button aria-label="Expand sidebar category &#x27;Upcoming Features&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pr-preview/docs/pr-7449/troubleshooting">Troubleshooting</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/pr-preview/docs/pr-7449/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/pr-preview/docs/pr-7449/category/working-with-scripts"><span itemprop="name">Working with scripts</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Simplifying Code Before Compilation</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Simplifying Code Before Compilation</h1></header>
<p>Much like in regular Haskell, simplifying or expanding certain Plinth code before compilation can make it more efficient.</p>
<p>As an example, suppose you want to call <code>PlutusTx.List.tail</code> on a list <code>n</code> times in Plinth.
You can implement it using a fold:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">ntails</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Integer</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">ntails</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token constant" style="color:#36acaa">PlutusTx</span><span class="token constant punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">List</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">foldl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">\</span><span class="token hvariable">acc</span><span class="token plain"> </span><span class="token hvariable">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PlutusTx</span><span class="token constant punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">List</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">tail</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">.</span><span class="token plain"> </span><span class="token hvariable">acc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token builtin">id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">PlutusTx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">replicate</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This works, but if the value of <code>n</code> is known statically, say <code>n = 5</code>, it may be better to use the following direct implementation:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">tails5</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">tails5</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token constant" style="color:#36acaa">PlutusTx</span><span class="token constant punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">List</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">tail</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">.</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PlutusTx</span><span class="token constant punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">List</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">tail</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">.</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PlutusTx</span><span class="token constant punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">List</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">tail</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">.</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PlutusTx</span><span class="token constant punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">List</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">tail</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">.</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PlutusTx</span><span class="token constant punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">List</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">tail</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It may cause the script to increase in size if <code>n</code> is large, but this has less execution overhead, so the script will be cheaper to execute.</p>
<p>Even if <code>n</code> is not known statically, you can still take advantage of <code>tails5</code>, and perform <code>ntails</code> 5 elements at a time, much like <a href="https://en.wikipedia.org/wiki/Loop_unrolling" target="_blank" rel="noopener noreferrer">loop unrolling</a>:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">ntails</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Integer</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">ntails</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token hvariable">nTails</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">.</span><span class="token plain"> </span><span class="token hvariable">tails5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token operator" style="color:#393A34">|</span><span class="token plain"> </span><span class="token builtin">otherwise</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token constant" style="color:#36acaa">PlutusTx</span><span class="token constant punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">List</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">foldl</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">\</span><span class="token hvariable">acc</span><span class="token plain"> </span><span class="token hvariable">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PlutusTx</span><span class="token constant punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">List</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">tail</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">.</span><span class="token plain"> </span><span class="token hvariable">acc</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin">id</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">PlutusTx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">replicate</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can write code like <code>tails5</code> by hand, but in more complex cases, you can instead use standard Haskell techniques for generating and manipulating source code, such as Template Haskell and GHC plugins.
After all, Plinth is a subset of Haskell.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="template-haskell">Template Haskell<a href="#template-haskell" class="hash-link" aria-label="Direct link to Template Haskell" title="Direct link to Template Haskell">​</a></h2>
<p>The most common method to programmatically generate code like <code>tails5</code> is through Template Haskell.
The following <code>ntailsTH</code> function generates a Template Haskell expression for applying <code>tail</code> <code>n</code> times, for any <code>n</code> that is statically known:</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token import-statement keyword" style="color:#00009f">import</span><span class="token import-statement"> </span><span class="token import-statement keyword" style="color:#00009f">qualified</span><span class="token import-statement"> Language</span><span class="token import-statement punctuation" style="color:#393A34">.</span><span class="token import-statement">Haskell</span><span class="token import-statement punctuation" style="color:#393A34">.</span><span class="token import-statement">TH </span><span class="token import-statement keyword" style="color:#00009f">as</span><span class="token import-statement"> TH</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">ntailsTH</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token hvariable">forall</span><span class="token plain"> </span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">Int</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TH</span><span class="token constant punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">Code</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">TH</span><span class="token constant punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">Q</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">ntailsTH</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token constant" style="color:#36acaa">Data</span><span class="token constant punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">List</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">foldl</span><span class="token plain">&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">\</span><span class="token hvariable">acc</span><span class="token plain"> </span><span class="token hvariable">_</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token constant" style="color:#36acaa">PlutusTx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">tail</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">.</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">$$</span><span class="token hvariable">acc</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token builtin">id</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">(</span><span class="token constant" style="color:#36acaa">Data</span><span class="token constant punctuation" style="color:#393A34">.</span><span class="token constant" style="color:#36acaa">List</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">replicate</span><span class="token plain"> </span><span class="token hvariable">n</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>It&#x27;s worth noting that <code>foldl&#x27;</code> and <code>replicate</code> are executed in Haskell for constructing the expression (rather than being compiled to UPLC), so we can use the ones in <code>Data.List</code> rather than <code>PlutusTx.List</code> (though the latter also works).</p>
<p>Then we can write <code>tails5</code> as</p>
<div class="language-haskell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-haskell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token hvariable">tails5</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">::</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token hvariable">a</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token hvariable">tails5</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">$$</span><span class="token punctuation" style="color:#393A34">(</span><span class="token hvariable">ntailsTH</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Since this is nothing but standard Template Haskell usage, we&#x27;ll keep it concise here.
Some good resources to learn more about Template Haskell include the <a href="https://wiki.haskell.org/Template_Haskell" target="_blank" rel="noopener noreferrer">Template Haskell page on HaskellWiki</a> (which has links to further resources), <a href="https://markkarpov.com/tutorial/th" target="_blank" rel="noopener noreferrer">Template Haskell tutorial</a> by Mark Karpov, and <a href="https://serokell.io/blog/introduction-to-template-haskell" target="_blank" rel="noopener noreferrer">Introduction to Template Haskell</a> by Heitor Toledo Lassarote de Paula.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="ghc-plugins">GHC Plugins<a href="#ghc-plugins" class="hash-link" aria-label="Direct link to GHC Plugins" title="Direct link to GHC Plugins">​</a></h2>
<p>If you need something even more powerful and flexible than Template Haskell, you can write your own GHC plugin to customize the transformation and compilation of certain parts of your code.
However, this is a more advanced tool with greater complexity, which is further compounded by GHC&#x27;s unstable API, making it difficult to support multiple major GHC versions.
You should rarely need to do this, as Template Haskell should meet most requirements.</p>
<p>If you do decide to write your own GHC plugin, keep in mind that the Plinth compiler is also a GHC plugin, so be careful of the orders in which the two plugins are invoked, especially since <a href="https://gitlab.haskell.org/ghc/ghc/-/issues/17884" target="_blank" rel="noopener noreferrer">the order has changed since GHC 9.4</a>.</p>
<p>Finally, keep in mind that doing what&#x27;s described in this page is not always desirable, since although it reduces script execution costs, it often increases script sizes.
For Plutus scripts, size is a much more valuable resource than for general-purpose programs, since Cardano has strict script size and transaction size limits.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/IntersectMBO/plutus/edit/master/doc/docusaurus/docs/working-with-scripts/simplifying-before-compilation.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/pr-preview/docs/pr-7449/working-with-scripts/optimizing-scripts-with-asData"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Optimizing Scripts with asData</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/pr-preview/docs/pr-7449/working-with-scripts/compile-time-evaluation"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Compile Time Evaluation</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#template-haskell" class="table-of-contents__link toc-highlight">Template Haskell</a></li><li><a href="#ghc-plugins" class="table-of-contents__link toc-highlight">GHC Plugins</a></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="footer-container"><div class="footer-left"><img class="footer-logo" src="/pr-preview/docs/pr-7449/img/logo-footer.svg" alt="Plutus"><span>Copyright ©<!-- -->2025<!-- --> IOHK. Built with Docusaurus.</span></div><div class="footer-right"><a href="/pr-preview/docs/pr-7449/">User Guide</a><a href="https://github.com/IntersectMBO/plutus" class="github-link" target="_blank"></a></div></div></footer></div>
</body>
</html>