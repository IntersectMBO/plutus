<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-auction-smart-contract/on-chain-code" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.6.0">
<title data-rh="true">On-chain Code: The Auction Validator | Plinth and Plutus Core Documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://plutus.cardano.intersectmbo.org/pr-preview/docs/pr-7533/img/docusaurus-social-card.png"><meta data-rh="true" name="twitter:image" content="https://plutus.cardano.intersectmbo.org/pr-preview/docs/pr-7533/img/docusaurus-social-card.png"><meta data-rh="true" property="og:url" content="https://plutus.cardano.intersectmbo.org/pr-preview/docs/pr-7533/auction-smart-contract/on-chain-code"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="On-chain Code: The Auction Validator | Plinth and Plutus Core Documentation"><meta data-rh="true" name="description" content="The code in this example is not a production-ready implementation, as it is not optimized for security or efficiency."><meta data-rh="true" property="og:description" content="The code in this example is not a production-ready implementation, as it is not optimized for security or efficiency."><link data-rh="true" rel="icon" href="/pr-preview/docs/pr-7533/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://plutus.cardano.intersectmbo.org/pr-preview/docs/pr-7533/auction-smart-contract/on-chain-code"><link data-rh="true" rel="alternate" href="https://plutus.cardano.intersectmbo.org/pr-preview/docs/pr-7533/auction-smart-contract/on-chain-code" hreflang="en"><link data-rh="true" rel="alternate" href="https://plutus.cardano.intersectmbo.org/pr-preview/docs/pr-7533/auction-smart-contract/on-chain-code" hreflang="x-default"><link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-X6364ZT8L2"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-X6364ZT8L2",{anonymize_ip:!0})</script><link rel="stylesheet" href="/pr-preview/docs/pr-7533/assets/css/styles.225deb0a.css">
<script src="/pr-preview/docs/pr-7533/assets/js/runtime~main.7b607fd6.js" defer="defer"></script>
<script src="/pr-preview/docs/pr-7533/assets/js/main.44501753.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/pr-preview/docs/pr-7533/"><div class="navbar__logo"><img src="/pr-preview/docs/pr-7533/img/logo.svg" alt="Plutus Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/pr-preview/docs/pr-7533/img/logo.svg" alt="Plutus Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Plutus</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/pr-preview/docs/pr-7533/">User guide</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item"><a href="https://github.com/IntersectMBO/plutus" class="github-link" target="_blank"></a></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pr-preview/docs/pr-7533/">Plinth User Guide</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pr-preview/docs/pr-7533/category/essential-concepts">Essential concepts</a><button aria-label="Expand sidebar category &#x27;Essential concepts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/pr-preview/docs/pr-7533/category/example-an-auction-smart-contract">Example: An Auction Smart Contract</a><button aria-label="Collapse sidebar category &#x27;Example: An Auction Smart Contract&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/pr-preview/docs/pr-7533/auction-smart-contract/on-chain-code">On-chain Code: The Auction Validator</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" tabindex="0" href="/pr-preview/docs/pr-7533/category/end-to-end">End to end</a><button aria-label="Expand sidebar category &#x27;End to end&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pr-preview/docs/pr-7533/glossary">Glossary</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pr-preview/docs/pr-7533/haddock-documentation">Haddock Documentation</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pr-preview/docs/pr-7533/category/using-plinth">Using Plinth</a><button aria-label="Expand sidebar category &#x27;Using Plinth&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pr-preview/docs/pr-7533/category/working-with-scripts">Working with scripts</a><button aria-label="Expand sidebar category &#x27;Working with scripts&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pr-preview/docs/pr-7533/category/delve-deeper">Delve Deeper</a><button aria-label="Expand sidebar category &#x27;Delve Deeper&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/pr-preview/docs/pr-7533/category/upcoming-features">Upcoming Features</a><button aria-label="Expand sidebar category &#x27;Upcoming Features&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/pr-preview/docs/pr-7533/troubleshooting">Troubleshooting</a></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/pr-preview/docs/pr-7533/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/pr-preview/docs/pr-7533/category/example-an-auction-smart-contract"><span itemprop="name">Example: An Auction Smart Contract</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">On-chain Code: The Auction Validator</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>On-chain Code: The Auction Validator</h1></header>
<div class="theme-admonition theme-admonition-caution admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_BuS1"><p>The code in this example is not a production-ready implementation, as it is not optimized for security or efficiency.
It is provided purely as an example for illustration and educational purposes.
Refer to resources like <strong><a href="https://library.mlabs.city/common-plutus-security-vulnerabilities" target="_blank" rel="noopener noreferrer">Cardano Plutus Script Vulnerability Guide</a></strong> for best practices on developing secure smart contracts.</p></div></div>
<h1>Auction Properties</h1>
<p>In this example, a seller wants to auction some asset she owns, represented as a non-fungible token (NFT) on Cardano.
She would like to create and deploy an auction smart contract with the following properties:</p>
<ul>
<li>there is a minimum bid amount</li>
<li>each bid must be higher than the previous highest bid (if any)</li>
<li>once a new bid is made, the previous highest bid (if exists) is immediately refunded</li>
<li>there is a deadline for placing bids; once the deadline has passed, new bids are no longer accepted, the asset can be transferred to the highest bidder (or to the seller if there are no bids), and the highest bid (if exists) can be transferred to the seller.</li>
</ul>
<h1>Plinth Code</h1>
<p>Plinth is a subset of Haskell, used to write on-chain code, also known as validators or scripts.
A Plinth program is compiled into Plutus Core, which is interpreted on-chain.
The full Plinth code for the auction smart contract can be found at <a href="https://github.com/IntersectMBO/plinth-template/blob/main/src/AuctionValidator.hs" target="_blank" rel="noopener noreferrer">AuctionValidator.hs</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="data-types">Data types<a href="#data-types" class="hash-link" aria-label="Direct link to Data types" title="Direct link to Data types">â€‹</a></h2>
<p>First, let&#x27;s define the following data types and instances for the validator:</p>
<!-- -->Loading<!-- -->
<p>The purpose of <code>makeLift</code> and <code>makeIsDataSchemaIndexed</code> will be explained later.</p>
<p>Writing a Plinth validator script for a smart contract often involves the following data types:</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="1-contract-parameters">1. Contract parameters<a href="#1-contract-parameters" class="hash-link" aria-label="Direct link to 1. Contract parameters" title="Direct link to 1. Contract parameters">â€‹</a></h3>
<p>These are fixed properties of the contract. You can put here values that will never change during the contract&#x27;s life cycle.
In our example, it is the <code>AuctionParams</code> type, containing properties like seller and minimum bid.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="2-datum">2. Datum<a href="#2-datum" class="hash-link" aria-label="Direct link to 2. Datum" title="Direct link to 2. Datum">â€‹</a></h3>
<p>This is part of a script UTXO.
It&#x27;s commonly used to hold the state of the contract and values that can change throughout the contract&#x27;s life cycle.
Our example requires only one piece of state: the current highest bid.
We use the <code>AuctionDatum</code> type to represent this.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="3-redeemer">3. Redeemer<a href="#3-redeemer" class="hash-link" aria-label="Direct link to 3. Redeemer" title="Direct link to 3. Redeemer">â€‹</a></h3>
<p>This is an input to the Plutus script provided by the transaction that is trying to spend a script UTXO.
If a smart contract is regarded as a state machine, the redeemer would be the input that ticks the state machine.
In our example, it is the <code>AuctionRedeemer</code> type: one may either submit a new bid, or request to close the auction and pay out the winner and the seller, both of which lead to a new state of the auction.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="4-script-context">4. Script context<a href="#4-script-context" class="hash-link" aria-label="Direct link to 4. Script context" title="Direct link to 4. Script context">â€‹</a></h3>
<p>This type contains the information of the transaction that the validator can inspect.
In our example, our validator verifies several conditions of the transaction; e.g., if it is a new bid, then it must be submitted before the auction&#x27;s end time; the previous highest bid must be refunded to the previous bidder, etc.</p>
<p>Different <a href="/pr-preview/docs/pr-7533/working-with-scripts/ledger-language-version">ledger language versions</a> use different script context types.
In this example we are writing a Plutus V3 scripts, so we import the <code>ScriptContext</code> data type from <code>PlutusLedgerApi.V3.Contexts</code>.</p>
<blockquote>
<p>ðŸ“Œ<!-- --> <strong>NOTE</strong></p>
<p>When writing a Plutus validator using Plinth, it is advisable to turn off Haskell&#x27;s <code>Prelude</code>. One way of doing it is the GHC extension <code>NoImplicitPrelude</code> enabled in the module header.
Usage of most functions and methods in <code>Prelude</code> should be replaced by their counterparts in the <code>plutus-tx</code> library, e.g., instead of the <code>==</code> from <code>base</code>, use <code>PlutusTx.Eq.==</code>.</p>
</blockquote>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="main-validator-function">Main Validator Function<a href="#main-validator-function" class="hash-link" aria-label="Direct link to Main Validator Function" title="Direct link to Main Validator Function">â€‹</a></h2>
<p>Now we are ready to introduce our main validator function.
The beginning of the function looks like the following:</p>
<!-- -->Loading<!-- -->
<p>Depending on whether this transaction is attempting to submit a new bid or to request payout, the validator validates the corresponding set of conditions.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sufficient-bid-condition">Sufficient Bid Condition<a href="#sufficient-bid-condition" class="hash-link" aria-label="Direct link to Sufficient Bid Condition" title="Direct link to Sufficient Bid Condition">â€‹</a></h3>
<p>The <code>sufficientBid</code> condition verifies that the bid amount is sufficient:</p>
<!-- -->Loading<!-- -->
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="valid-bid-time-condition">Valid Bid Time Condition<a href="#valid-bid-time-condition" class="hash-link" aria-label="Direct link to Valid Bid Time Condition" title="Direct link to Valid Bid Time Condition">â€‹</a></h3>
<p>The <code>validBidTime</code> condition verifies that the bid is submitted before the auction&#x27;s deadline:</p>
<!-- -->Loading<!-- -->
<p>Here, <code>to x</code> is the time interval ending at <code>x</code>, i.e., <code>(-âˆž, x]</code>.
<code>txInfoValidRange</code> is a transaction property.
It is the time interval in which the transaction is allowed to go through phase-1 validation.
<code>contains</code> takes two time intervals, and checks that the first interval completely includes the second.
Since the transaction may be validated at any point in the <code>txInfoValidRange</code> interval, we need to check that the entire interval lies within <code>(-âˆž, apEndTime params]</code>.</p>
<p>The reason a script receives the <code>txInfoValidRange</code> interval instead of the exact time the script is run is due to <a href="https://iohk.io/en/blog/posts/2021/09/06/no-surprises-transaction-validation-on-cardano/" target="_blank" rel="noopener noreferrer">determinism</a>.
Using the exact time would be like calling a <code>getCurrentTime</code> function and branching based on the current time.
On the other hand, by using the <code>txInfoValidRange</code> interval, the same interval is always used by the same transaction.
If the current time when the transaction is validated is outside of the interval, the transaction is rejected immediately without running the script.</p>
<p>Also note the tilde (<code>~</code>) in <code>~validBidTime = ...</code>.
When writing Plinth it is <a href="/pr-preview/docs/pr-7533/using-plinth/compiling-plinth">advisable</a> to turn on the <code>Strict</code> extension, which generally improves script performance.
Doing so makes all bindings strict, which means, in this particular case, without the <code>~</code>, <code>validBidTime</code> would be evaluated even if the redeemer matches the <code>Payout</code> case, which doesn&#x27;t need this condition.
Doing so results in unnecessary work or even unexpected evaluation failures.
The <code>~</code> makes <code>validBidTime</code> non-strict, i.e., only evaluated when used.</p>
<p>On the other hand, it is unnecessary to add <code>~</code> to <code>sufficientBid</code>, since it has a function type, and a function cannot be evaluated further without receiving enough arguments.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="refunds-previous-highest-bid-condition">Refunds Previous Highest Bid Condition<a href="#refunds-previous-highest-bid-condition" class="hash-link" aria-label="Direct link to Refunds Previous Highest Bid Condition" title="Direct link to Refunds Previous Highest Bid Condition">â€‹</a></h3>
<p>The <code>refundsPreviousHighestBid</code> condition checks that the transaction pays the previous highest bid to the previous bidder:</p>
<!-- -->Loading<!-- -->
<p>It uses <code>PlutusTx.find</code> to find the transaction output (a UTXO) that pays to the previous bidder the amount equivalent to the previous highest bid, and verifies that there is at least one such output.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="correct-output-condition">Correct Output Condition<a href="#correct-output-condition" class="hash-link" aria-label="Direct link to Correct Output Condition" title="Direct link to Correct Output Condition">â€‹</a></h3>
<p>The <code>correctOutput</code> condition verifies that the transaction produces a <em>continuing output</em> (see below for definition) containing the correct datum and value.
It has two subconditions:</p>
<ul>
<li><code>correctOutputDatum</code>: the datum should contain the new highest bid</li>
<li><code>correctOutputValue</code>: the value should contain (1) the token being auctioned, and (2) the bid amount.</li>
</ul>
<!-- -->Loading<!-- -->
<p>A &quot;continuing output&quot; is a transaction output that pays to the same script address from which we are currently spending.
Exactly one continuing output must be present in this example so that the next bidder can place a new bid.
The new bid, in turn, will need to spend the continuing output and get validated by the same script.</p>
<p>If the transaction is requesting a payout, the validator will then verify the other three conditions: <code>validPayoutTime</code>, <code>sellerGetsHighestBid</code> and <code>highestBidderGetsAsset</code>.
These conditions are similar to the ones already explained, so their details are omitted.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="compiling-the-validator">Compiling the validator<a href="#compiling-the-validator" class="hash-link" aria-label="Direct link to Compiling the validator" title="Direct link to Compiling the validator">â€‹</a></h3>
<p>Finally, we need to compile the validator written in Plinth into Plutus Core, using the Plinth compiler:</p>
<!-- -->Loading<!-- -->
<p>The type of a compiled Plutus V3 spending validator should be <code>CompiledCode (BuiltinData -&gt; BuiltinUnit)</code>, as explained in <a href="/pr-preview/docs/pr-7533/working-with-scripts/ledger-language-version">Plutus Ledger Language Version</a>.
The call to <code>PlutusTx.unsafeFromBuiltinData</code> is the reason we need the <code>PlutusTx.unstableMakeIsData</code> shown before, which derives <code>UnsafeFromData</code> instances.
And instead of returning a <code>Bool</code>, it returns <code>BuiltinUnit</code>, and the validation succeeds if the script evaluates without error.</p>
<p>Note that <code>AuctionParams</code> is <em>not</em> an argument of the compiled validator.
<code>AuctionParams</code> contains contract properties that don&#x27;t change, so it is simply built into the validator by partial application.
The partial application is done via <code>PlutusTx.unsafeApplyCode</code>.</p>
<blockquote>
<p>ðŸ“Œ<!-- --> <strong>NOTE</strong></p>
<p>It is worth noting that we must call <code>PlutusTx.compile</code> on the entire <code>auctionUntypedValidator</code>, rather than applying it to <code>params</code> before compiling, as in <code>$$(PlutusTx.compile [||auctionUntypedValidator params||])</code>.
The latter won&#x27;t work, because everything being compiled (inside <code>[||...||]</code>) must be known at compile time, but we won&#x27;t be able to access <code>params</code> until runtime.
Instead, once we have the <code>params</code> value at runtime, we use <code>liftCodeDef</code> or <code>liftCode</code> to lift it into a Plutus Core term before calling <code>unsafeApplyCode</code>.
This is the reason why we need the <code>Lift</code> instance for <code>AuctionParams</code>, derived via <code>PlutusTx.makeLift</code>.
To learn more about lifting, see <a href="/pr-preview/docs/pr-7533/using-plinth/lifting">Lifting Values into CompiledCode</a>.</p>
</blockquote></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/IntersectMBO/plutus/edit/master/doc/docusaurus/docs/auction-smart-contract/on-chain-code.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/pr-preview/docs/pr-7533/category/example-an-auction-smart-contract"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Example: An Auction Smart Contract</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/pr-preview/docs/pr-7533/category/end-to-end"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">End to end</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#data-types" class="table-of-contents__link toc-highlight">Data types</a><ul><li><a href="#1-contract-parameters" class="table-of-contents__link toc-highlight">1. Contract parameters</a></li><li><a href="#2-datum" class="table-of-contents__link toc-highlight">2. Datum</a></li><li><a href="#3-redeemer" class="table-of-contents__link toc-highlight">3. Redeemer</a></li><li><a href="#4-script-context" class="table-of-contents__link toc-highlight">4. Script context</a></li></ul></li><li><a href="#main-validator-function" class="table-of-contents__link toc-highlight">Main Validator Function</a><ul><li><a href="#sufficient-bid-condition" class="table-of-contents__link toc-highlight">Sufficient Bid Condition</a></li><li><a href="#valid-bid-time-condition" class="table-of-contents__link toc-highlight">Valid Bid Time Condition</a></li><li><a href="#refunds-previous-highest-bid-condition" class="table-of-contents__link toc-highlight">Refunds Previous Highest Bid Condition</a></li><li><a href="#correct-output-condition" class="table-of-contents__link toc-highlight">Correct Output Condition</a></li><li><a href="#compiling-the-validator" class="table-of-contents__link toc-highlight">Compiling the validator</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="footer-container"><div class="footer-left"><img class="footer-logo" src="/pr-preview/docs/pr-7533/img/logo-footer.svg" alt="Plutus"><span>Copyright Â©<!-- -->2026<!-- --> IOHK. Built with Docusaurus.</span></div><div class="footer-right"><a href="/pr-preview/docs/pr-7533/">User Guide</a><a href="https://github.com/IntersectMBO/plutus" class="github-link" target="_blank"></a></div></div></footer></div>
</body>
</html>