(program
  (let
    (nonrec
    )
    (datatypebind
      (datatype (tyvardecl Unit (type))  Unit_match (vardecl Unit Unit))
    )
    (let
      (rec
      )
      (datatypebind
        (datatype
          (tyvardecl List (fun (type) (type)))
          (tyvardecl a (type))
          Nil_match
          (vardecl Nil [List a]) (vardecl Cons (fun a (fun [List a] [List a])))
        )
      )
      (let
        (rec
        )
        (datatypebind
          (datatype
            (tyvardecl EmptyRose (type))
            
            EmptyRose_match
            (vardecl EmptyRose (fun [List EmptyRose] EmptyRose))
          )
        )
        (let
          (rec
          )
          (termbind
            (vardecl
              map
              (all t (type) (all a (type) (fun (fun t a) (fun [List t] [List a]))))
            )
            (abs
              t
              (type)
              (abs
                a
                (type)
                (lam
                  ds
                  (fun t a)
                  (lam
                    ds
                    [List t]
                    [
                      [
                        [
                          { [ { Nil_match t } ds ] (fun Unit [List a]) }
                          (lam thunk Unit { Nil a })
                        ]
                        (lam
                          x
                          t
                          (lam
                            xs
                            [List t]
                            (lam
                              thunk
                              Unit
                              [
                                [ { Cons a } [ ds x ] ]
                                [ [ { { map t } a } ds ] xs ]
                              ]
                            )
                          )
                        )
                      ]
                      Unit
                    ]
                  )
                )
              )
            )
          )
          (let
            (rec)
            (termbind
              (vardecl go (fun EmptyRose EmptyRose))
              (lam
                ds
                EmptyRose
                [
                  { [ EmptyRose_match ds ] EmptyRose }
                  (lam
                    xs
                    [List EmptyRose]
                    [ EmptyRose [ [ { { map EmptyRose } EmptyRose } go ] xs ] ]
                  )
                ]
              )
            )
            go
          )
        )
      )
    )
  )
)