<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Cost</title>
    <link rel="stylesheet" href="./Agda.css">
  </head>
  <body>
    <h1>Cost</h1>
    <section>
      <h1 id="costs">Costs</h1>

<p>This module contains the basic definitions and structures for modelling costs.</p>

<pre class="Agda">
<a id="129" class="Keyword">module</a> <a id="136" href="Cost.html" class="Module">Cost</a> <a id="141" class="Keyword">where</a>

</pre>
<h2 id="imports">Imports</h2>

<pre class="Agda"><a id="169" class="Keyword">open</a> <a id="174" class="Keyword">import</a> <a id="181" href="Agda.Builtin.Unit.html" class="Module">Agda.Builtin.Unit</a> <a id="199" class="Keyword">using</a> <a id="205" class="Symbol">(</a><a id="206" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a><a id="208" class="Symbol">)</a>
<a id="210" class="Keyword">open</a> <a id="215" class="Keyword">import</a> <a id="222" href="Function.html" class="Module">Function</a> <a id="231" class="Keyword">using</a> <a id="237" class="Symbol">(</a><a id="238" href="Function.Base.html#1115" class="Function Operator">_‚àò_</a><a id="241" class="Symbol">)</a>
<a id="243" class="Keyword">open</a> <a id="248" class="Keyword">import</a> <a id="255" href="Data.Bool.html" class="Module">Data.Bool</a> <a id="265" class="Keyword">using</a> <a id="271" class="Symbol">(</a><a id="272" href="Data.Bool.Base.html#1505" class="Function Operator">if_then_else_</a><a id="285" class="Symbol">)</a>
<a id="287" class="Keyword">open</a> <a id="292" class="Keyword">import</a> <a id="299" href="Data.Fin.html" class="Module">Data.Fin</a> <a id="308" class="Keyword">using</a> <a id="314" class="Symbol">(</a><a id="315" href="Data.Fin.Base.html#1159" class="Datatype">Fin</a><a id="318" class="Symbol">;</a><a id="319" href="Data.Fin.Base.html#1181" class="InductiveConstructor">zero</a><a id="323" class="Symbol">;</a><a id="324" href="Data.Fin.Base.html#1202" class="InductiveConstructor">suc</a><a id="327" class="Symbol">)</a>
<a id="329" class="Keyword">open</a> <a id="334" class="Keyword">import</a> <a id="341" href="Data.Nat.html" class="Module">Data.Nat</a> <a id="350" class="Keyword">using</a> <a id="356" class="Symbol">(</a><a id="357" href="Agda.Builtin.Nat.html#203" class="Datatype">‚Ñï</a><a id="358" class="Symbol">;</a><a id="359" href="Agda.Builtin.Nat.html#221" class="InductiveConstructor">zero</a><a id="363" class="Symbol">;</a><a id="364" href="Agda.Builtin.Nat.html#234" class="InductiveConstructor">suc</a><a id="367" class="Symbol">;</a><a id="368" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">_+_</a><a id="371" class="Symbol">)</a>
<a id="373" class="Keyword">open</a> <a id="378" class="Keyword">import</a> <a id="385" href="Data.Nat.Properties.html" class="Module">Data.Nat.Properties</a> <a id="405" class="Keyword">using</a> <a id="411" class="Symbol">(</a><a id="412" href="Data.Nat.Properties.html#15113" class="Function">+-assoc</a><a id="419" class="Symbol">;</a><a id="420" href="Data.Nat.Properties.html#15269" class="Function">+-identity ≥</a><a id="431" class="Symbol">)</a>
<a id="433" class="Keyword">open</a> <a id="438" class="Keyword">import</a> <a id="445" href="Data.Nat.Show.html" class="Module">Data.Nat.Show</a> <a id="459" class="Keyword">using</a> <a id="465" class="Symbol">()</a> <a id="468" class="Keyword">renaming</a> <a id="477" class="Symbol">(</a><a id="478" href="Data.Nat.Show.html#1962" class="Function">show</a> <a id="483" class="Symbol">to</a> <a id="486" class="Function">show‚Ñï</a><a id="491" class="Symbol">)</a>
<a id="493" class="Keyword">open</a> <a id="498" class="Keyword">import</a> <a id="505" href="Data.Integer.html" class="Module">Data.Integer</a> <a id="518" class="Keyword">using</a> <a id="524" class="Symbol">(</a><a id="525" href="Agda.Builtin.Int.html#245" class="Datatype">‚Ñ§</a><a id="526" class="Symbol">;</a><a id="527" href="Data.Integer.Base.html#1715" class="Function Operator">‚à£_‚à£</a><a id="530" class="Symbol">)</a>
<a id="532" class="Keyword">open</a> <a id="537" class="Keyword">import</a> <a id="544" href="Data.Float.html" class="Module">Data.Float</a> <a id="555" class="Keyword">using</a> <a id="561" class="Symbol">(</a><a id="562" href="Agda.Builtin.Float.html#353" class="Postulate">Float</a><a id="567" class="Symbol">;</a><a id="568" href="Agda.Builtin.Float.html#822" class="Primitive">from‚Ñï</a><a id="573" class="Symbol">;</a><a id="574" href="Agda.Builtin.Float.html#1500" class="Primitive">_√∑_</a><a id="577" class="Symbol">;</a><a id="578" href="Agda.Builtin.Float.html#421" class="Primitive">_‚â§·µá_</a><a id="582" class="Symbol">)</a> <a id="584" class="Keyword">renaming</a> <a id="593" class="Symbol">(</a><a id="594" href="Agda.Builtin.Float.html#1279" class="Primitive">show</a> <a id="599" class="Symbol">to</a> <a id="602" class="Primitive">showùîΩ</a><a id="607" class="Symbol">;</a><a id="608" href="Agda.Builtin.Float.html#1447" class="Primitive">_*_</a> <a id="612" class="Symbol">to</a> <a id="615" class="Primitive">_*f_</a><a id="619" class="Symbol">)</a>
<a id="621" class="Keyword">import</a> <a id="628" href="Data.List.html" class="Module">Data.List</a> <a id="638" class="Symbol">as</a> <a id="641" class="Module">L</a>

<a id="644" class="Keyword">open</a> <a id="649" class="Keyword">import</a> <a id="656" href="Data.Maybe.html" class="Module">Data.Maybe</a> <a id="667" class="Keyword">using</a> <a id="673" class="Symbol">(</a><a id="674" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a><a id="679" class="Symbol">;</a><a id="680" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a><a id="684" class="Symbol">;</a><a id="685" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a><a id="692" class="Symbol">;</a><a id="693" href="Data.Maybe.Base.html#1468" class="Function">maybe‚Ä≤</a><a id="699" class="Symbol">;</a><a id="700" href="Data.Maybe.Base.html#1546" class="Function">fromMaybe</a><a id="709" class="Symbol">)</a> <a id="711" class="Keyword">renaming</a> <a id="720" class="Symbol">(</a><a id="721" href="Data.Maybe.Base.html#1934" class="Function">map</a> <a id="725" class="Symbol">to</a> <a id="728" class="Function">mapMaybe</a><a id="736" class="Symbol">;</a> <a id="738" href="Data.Maybe.Base.html#2141" class="Function Operator">_&gt;&gt;=_</a> <a id="744" class="Symbol">to</a> <a id="747" class="Function Operator">_&gt;&gt;=m_</a> <a id="754" class="Symbol">)</a>
<a id="756" class="Keyword">open</a> <a id="761" class="Keyword">import</a> <a id="768" href="Data.Product.html" class="Module">Data.Product</a> <a id="781" class="Keyword">using</a> <a id="787" class="Symbol">()</a> <a id="790" class="Keyword">renaming</a> <a id="799" class="Symbol">(</a><a id="800" href="Agda.Builtin.Sigma.html#235" class="InductiveConstructor Operator">_,_</a> <a id="804" class="Symbol">to</a> <a id="807" class="InductiveConstructor Operator">_,,_</a><a id="811" class="Symbol">)</a>
<a id="813" class="Keyword">open</a> <a id="818" class="Keyword">import</a> <a id="825" href="Data.String.html" class="Module">Data.String</a> <a id="837" class="Keyword">using</a> <a id="843" class="Symbol">(</a><a id="844" href="Agda.Builtin.String.html#335" class="Postulate">String</a><a id="850" class="Symbol">;</a><a id="851" href="Data.String.Base.html#2425" class="Function Operator">_++_</a><a id="855" class="Symbol">;</a><a id="856" href="Data.String.Base.html#3710" class="Function">padLeft</a><a id="863" class="Symbol">;</a><a id="864" href="Data.String.Base.html#3841" class="Function">padRight</a><a id="872" class="Symbol">;</a><a id="873" href="Data.String.Base.html#2489" class="Function">length</a><a id="879" class="Symbol">)</a>
<a id="881" class="Keyword">open</a> <a id="886" class="Keyword">import</a> <a id="893" href="Data.Vec.html" class="Module">Data.Vec</a> <a id="902" class="Keyword">using</a> <a id="908" class="Symbol">(</a><a id="909" href="Data.Vec.Base.html#1119" class="Datatype">Vec</a><a id="912" class="Symbol">;</a><a id="913" href="Data.Vec.Base.html#6493" class="Function">replicate</a><a id="922" class="Symbol">;</a><a id="923" href="Data.Vec.Base.html#1155" class="InductiveConstructor">[]</a><a id="925" class="Symbol">;</a><a id="926" href="Data.Vec.Base.html#1174" class="InductiveConstructor Operator">_‚à∑_</a><a id="929" class="Symbol">;</a><a id="930" href="Data.Vec.Base.html#5424" class="Function">foldr</a><a id="935" class="Symbol">)</a>
<a id="937" class="Keyword">open</a> <a id="942" class="Keyword">import</a> <a id="949" href="Algebra.html" class="Module">Algebra</a> <a id="957" class="Keyword">using</a> <a id="963" class="Symbol">(</a><a id="964" href="Algebra.Structures.html#4825" class="Record">IsMonoid</a><a id="972" class="Symbol">)</a>
<a id="974" class="Keyword">open</a> <a id="979" class="Keyword">import</a> <a id="986" href="Relation.Nullary.html" class="Module">Relation.Nullary</a> <a id="1003" class="Keyword">using</a> <a id="1009" class="Symbol">(</a><a id="1010" href="Relation.Nullary.Decidable.Core.html#1994" class="InductiveConstructor">yes</a><a id="1013" class="Symbol">;</a><a id="1014" href="Relation.Nullary.Decidable.Core.html#2031" class="InductiveConstructor">no</a><a id="1016" class="Symbol">)</a>
<a id="1018" class="Keyword">open</a> <a id="1023" class="Keyword">import</a> <a id="1030" href="Relation.Binary.PropositionalEquality.html" class="Module">Relation.Binary.PropositionalEquality</a> <a id="1068" class="Keyword">using</a> <a id="1074" class="Symbol">(</a><a id="1075" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">_‚â°_</a><a id="1078" class="Symbol">;</a><a id="1079" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a><a id="1083" class="Symbol">;</a><a id="1084" href="Relation.Binary.PropositionalEquality.Properties.html#5411" class="Function">isEquivalence</a><a id="1097" class="Symbol">;</a><a id="1098" href="Relation.Binary.PropositionalEquality.Core.html#1576" class="Function">cong‚ÇÇ</a><a id="1103" class="Symbol">)</a>
<a id="1105" class="Keyword">open</a> <a id="1110" class="Keyword">import</a> <a id="1117" href="Text.Printf.html" class="Module">Text.Printf</a> <a id="1129" class="Keyword">using</a> <a id="1135" class="Symbol">(</a><a id="1136" href="Text.Printf.html#1015" class="Function">printf</a><a id="1142" class="Symbol">)</a>
<a id="1144" class="Keyword">open</a> <a id="1149" class="Keyword">import</a> <a id="1156" href="Relation.Binary.html" class="Module">Relation.Binary</a> <a id="1172" class="Keyword">using</a> <a id="1178" class="Symbol">(</a><a id="1179" href="Relation.Binary.Bundles.html#8046" class="Record">StrictTotalOrder</a><a id="1195" class="Symbol">)</a>
<a id="1197" class="Keyword">open</a> <a id="1202" class="Keyword">import</a> <a id="1209" href="Data.Char.html" class="Module">Data.Char</a> <a id="1219" class="Keyword">using</a> <a id="1225" class="Symbol">(</a><a id="1226" href="Data.Char.Base.html#1358" class="Function Operator">_‚âà·µá_</a><a id="1230" class="Symbol">)</a>
<a id="1232" class="Keyword">open</a> <a id="1237" class="Keyword">import</a> <a id="1244" href="Data.String.Properties.html" class="Module">Data.String.Properties</a> <a id="1267" class="Keyword">using</a> <a id="1273" class="Symbol">(</a><a id="1274" href="Data.String.Properties.html#3662" class="Function">&lt;-strictTotalOrder-‚âà</a><a id="1294" class="Symbol">)</a>
<a id="1296" class="Keyword">open</a> <a id="1301" class="Keyword">import</a> <a id="1308" href="Data.Tree.AVL.Map.html" class="Module">Data.Tree.AVL.Map</a> <a id="1326" href="Data.String.Properties.html#3662" class="Function">&lt;-strictTotalOrder-‚âà</a> <a id="1347" class="Symbol">as</a> <a id="AVL"></a><a id="1350" href="Cost.html#1350" class="Module">AVL</a>
          <a id="1364" class="Keyword">using</a> <a id="1370" class="Symbol">(</a><a id="1371" href="Data.Tree.AVL.Map.html#1133" class="Function">Map</a><a id="1374" class="Symbol">;</a><a id="1375" href="Data.Tree.AVL.Map.html#1300" class="Function">empty</a><a id="1380" class="Symbol">;</a><a id="1381" href="Data.Tree.AVL.Map.html#2317" class="Function">unionWith</a><a id="1390" class="Symbol">;</a><a id="1391" href="Data.Tree.AVL.Map.html#1333" class="Function">singleton</a><a id="1400" class="Symbol">)</a>
          <a id="1412" class="Keyword">renaming</a> <a id="1421" class="Symbol">(</a><a id="1422" href="Data.Tree.AVL.Map.html#1570" class="Function">lookup</a> <a id="1429" class="Symbol">to</a> <a id="1432" class="Function">lookupAVL</a><a id="1441" class="Symbol">)</a>

<a id="1444" class="Keyword">open</a> <a id="1449" class="Keyword">import</a> <a id="1456" href="Utils.html" class="Module">Utils</a> <a id="1462" class="Keyword">using</a> <a id="1468" class="Symbol">(</a><a id="1469" href="Utils.html#5063" class="Record Operator">_√ó_</a><a id="1472" class="Symbol">;</a><a id="1473" href="Utils.html#4009" class="InductiveConstructor Operator">_,_</a><a id="1476" class="Symbol">)</a>
<a id="1478" class="Keyword">open</a> <a id="1483" class="Keyword">import</a> <a id="1490" href="Builtin.html" class="Module">Builtin</a> <a id="1498" class="Keyword">using</a> <a id="1504" class="Symbol">(</a><a id="1505" href="Builtin.html#1434" class="Datatype">Builtin</a><a id="1512" class="Symbol">;</a><a id="1513" href="Builtin.html#33776" class="Function">showBuiltin</a><a id="1524" class="Symbol">;</a><a id="1525" href="Builtin.html#33921" class="Function">builtinList</a><a id="1536" class="Symbol">;</a><a id="1537" href="Builtin.html#16778" class="Function">arity</a><a id="1542" class="Symbol">)</a>
<a id="1544" class="Keyword">open</a> <a id="1549" href="Builtin.html#1434" class="Module">Builtin.Builtin</a>
<a id="1565" class="Keyword">open</a> <a id="1570" class="Keyword">import</a> <a id="1577" href="Builtin.Signature.html" class="Module">Builtin.Signature</a> <a id="1595" class="Keyword">using</a> <a id="1601" class="Symbol">(</a><a id="1602" href="Builtin.Signature.html#1821" class="Datatype Operator">_‚ä¢‚ôØ</a><a id="1605" class="Symbol">)</a>
<a id="1607" class="Keyword">open</a> <a id="1612" href="Builtin.Signature.html#1821" class="Module Operator">_‚ä¢‚ôØ</a>
<a id="1616" class="Keyword">open</a> <a id="1621" class="Keyword">import</a> <a id="1628" href="Builtin.Constant.AtomicType.html" class="Module">Builtin.Constant.AtomicType</a> <a id="1656" class="Keyword">using</a> <a id="1662" class="Symbol">(</a><a id="1663" href="Builtin.Constant.AtomicType.html#570" class="Datatype">AtomicTyCon</a><a id="1674" class="Symbol">)</a>
<a id="1676" class="Keyword">open</a> <a id="1681" href="Builtin.Constant.AtomicType.html#570" class="Module">AtomicTyCon</a>

<a id="1694" class="Keyword">open</a> <a id="1699" class="Keyword">import</a> <a id="1706" href="Cost.Base.html" class="Module">Cost.Base</a>
<a id="1716" class="Keyword">open</a> <a id="1721" class="Keyword">import</a> <a id="1728" href="Cost.Size.html" class="Module">Cost.Size</a> <a id="1738" class="Keyword">using</a> <a id="1744" class="Symbol">(</a><a id="1745" href="Cost.Size.html#3130" class="Function">defaultValueMeasure</a><a id="1764" class="Symbol">)</a>
<a id="1766" class="Keyword">open</a> <a id="1771" class="Keyword">import</a> <a id="1778" href="Cost.Model.html" class="Module">Cost.Model</a>
<a id="1789" class="Keyword">open</a> <a id="1794" class="Keyword">import</a> <a id="1801" href="Cost.Raw.html" class="Module">Cost.Raw</a>
<a id="1810" class="Keyword">open</a> <a id="1815" class="Keyword">import</a> <a id="1822" href="Untyped.CEK.html" class="Module">Untyped.CEK</a> <a id="1834" class="Keyword">using</a> <a id="1840" class="Symbol">(</a><a id="1841" href="Untyped.CEK.html#1344" class="Datatype">Value</a><a id="1846" class="Symbol">;</a><a id="1847" href="Untyped.CEK.html#1613" class="InductiveConstructor">V-con</a><a id="1852" class="Symbol">)</a>
</pre>
<h2 id="execution-budget">Execution Budget</h2>

<p>An execution budget consist of two costs: CPU and memory costs.</p>

<pre class="Agda"><a id="1949" class="Keyword">record</a> <a id="ExBudget"></a><a id="1956" href="Cost.html#1956" class="Record">ExBudget</a> <a id="1965" class="Symbol">:</a> <a id="1967" href="Agda.Primitive.html#388" class="Primitive">Set</a> <a id="1971" class="Keyword">where</a>
  <a id="1979" class="Keyword">constructor</a> <a id="mkExBudget"></a><a id="1991" href="Cost.html#1991" class="InductiveConstructor">mkExBudget</a>
  <a id="2004" class="Keyword">field</a>
    <a id="ExBudget.ExCPU"></a><a id="2014" href="Cost.html#2014" class="Field">ExCPU</a> <a id="2020" class="Symbol">:</a> <a id="2022" href="Cost.Base.html#778" class="Function">CostingNat</a> <a id="2033" class="Comment">-- CPU usage</a>
    <a id="ExBudget.ExMem"></a><a id="2050" href="Cost.html#2050" class="Field">ExMem</a> <a id="2056" class="Symbol">:</a> <a id="2058" href="Cost.Base.html#778" class="Function">CostingNat</a> <a id="2069" class="Comment">-- Memory usage</a>

<a id="2086" class="Keyword">open</a> <a id="2091" href="Cost.html#1956" class="Module">ExBudget</a>

<a id="fromHExBudget"></a><a id="2101" href="Cost.html#2101" class="Function">fromHExBudget</a> <a id="2115" class="Symbol">:</a> <a id="2117" href="Cost.Raw.html#837" class="Postulate">HExBudget</a> <a id="2127" class="Symbol">‚Üí</a> <a id="2129" href="Cost.html#1956" class="Record">ExBudget</a>
<a id="2138" href="Cost.html#2101" class="Function">fromHExBudget</a> <a id="2152" href="Cost.html#2152" class="Bound">hb</a> <a id="2155" class="Symbol">=</a> <a id="2157" href="Cost.html#1991" class="InductiveConstructor">mkExBudget</a> <a id="2168" class="Symbol">(</a><a id="2169" href="Cost.Raw.html#2286" class="Postulate">getCPUCost</a> <a id="2180" href="Cost.html#2152" class="Bound">hb</a><a id="2182" class="Symbol">)</a> <a id="2184" class="Symbol">(</a><a id="2185" href="Cost.Raw.html#2332" class="Postulate">getMemoryCost</a> <a id="2199" href="Cost.html#2152" class="Bound">hb</a><a id="2201" class="Symbol">)</a>
</pre>
<p>The type for execution budget should be a Monoid.
We show that this is the case for <code class="language-plaintext highlighter-rouge">ExBudget</code>.</p>

<pre class="Agda"><a id="2309" class="Comment">-- unit of the monoid</a>
<a id="Œµ‚Ç¨"></a><a id="2331" href="Cost.html#2331" class="Function">Œµ‚Ç¨</a> <a id="2334" class="Symbol">:</a> <a id="2336" href="Cost.html#1956" class="Record">ExBudget</a>
<a id="2345" href="Cost.html#2331" class="Function">Œµ‚Ç¨</a> <a id="2348" class="Symbol">=</a> <a id="2350" href="Cost.html#1991" class="InductiveConstructor">mkExBudget</a> <a id="2361" class="Number">0</a> <a id="2363" class="Number">0</a>

<a id="2366" class="Comment">-- binary operation</a>
<a id="_‚àô‚Ç¨_"></a><a id="2386" href="Cost.html#2386" class="Function Operator">_‚àô‚Ç¨_</a> <a id="2391" class="Symbol">:</a> <a id="2393" href="Cost.html#1956" class="Record">ExBudget</a> <a id="2402" class="Symbol">‚Üí</a> <a id="2404" href="Cost.html#1956" class="Record">ExBudget</a> <a id="2413" class="Symbol">‚Üí</a> <a id="2415" href="Cost.html#1956" class="Record">ExBudget</a>
<a id="2424" class="Symbol">(</a><a id="2425" href="Cost.html#1991" class="InductiveConstructor">mkExBudget</a> <a id="2436" href="Cost.html#2436" class="Bound">xCPU</a> <a id="2441" href="Cost.html#2441" class="Bound">xMem</a><a id="2445" class="Symbol">)</a> <a id="2447" href="Cost.html#2386" class="Function Operator">‚àô‚Ç¨</a> <a id="2450" class="Symbol">(</a><a id="2451" href="Cost.html#1991" class="InductiveConstructor">mkExBudget</a> <a id="2462" href="Cost.html#2462" class="Bound">yCPU</a> <a id="2467" href="Cost.html#2467" class="Bound">yMem</a><a id="2471" class="Symbol">)</a> <a id="2473" class="Symbol">=</a> <a id="2475" href="Cost.html#1991" class="InductiveConstructor">mkExBudget</a> <a id="2486" class="Symbol">(</a><a id="2487" href="Cost.html#2436" class="Bound">xCPU</a> <a id="2492" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="2494" href="Cost.html#2462" class="Bound">yCPU</a><a id="2498" class="Symbol">)</a> <a id="2500" class="Symbol">(</a><a id="2501" href="Cost.html#2441" class="Bound">xMem</a> <a id="2506" href="Agda.Builtin.Nat.html#336" class="Primitive Operator">+</a> <a id="2508" href="Cost.html#2467" class="Bound">yMem</a><a id="2512" class="Symbol">)</a>

<a id="2515" class="Comment">-- Note: working with `Monoid` instances would imply working in Set‚ÇÅ, so we avoid it</a>
<a id="2600" class="Comment">-- and just state that `ExBudget` is a Monoid</a>

<a id="isMonoidExBudget"></a><a id="2647" href="Cost.html#2647" class="Function">isMonoidExBudget</a> <a id="2664" class="Symbol">:</a> <a id="2666" href="Algebra.Structures.html#4825" class="Record">IsMonoid</a> <a id="2675" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">_‚â°_</a> <a id="2679" href="Cost.html#2386" class="Function Operator">_‚àô‚Ç¨_</a> <a id="2684" href="Cost.html#2331" class="Function">Œµ‚Ç¨</a>
<a id="2687" href="Cost.html#2647" class="Function">isMonoidExBudget</a> <a id="2704" class="Symbol">=</a> <a id="2706" class="Keyword">record</a> <a id="2713" class="Symbol">{</a>
       <a id="2722" href="Algebra.Structures.html#4886" class="Field">isSemigroup</a> <a id="2734" class="Symbol">=</a> <a id="2736" class="Keyword">record</a> <a id="2743" class="Symbol">{</a>
           <a id="2756" href="Algebra.Structures.html#3436" class="Field">isMagma</a> <a id="2764" class="Symbol">=</a> <a id="2766" class="Keyword">record</a> <a id="2773" class="Symbol">{</a> <a id="2775" href="Algebra.Structures.html#1760" class="Field">isEquivalence</a> <a id="2789" class="Symbol">=</a> <a id="2791" href="Relation.Binary.PropositionalEquality.Properties.html#5411" class="Function">isEquivalence</a> <a id="2805" class="Symbol">;</a> <a id="2807" href="Algebra.Structures.html#1798" class="Field">‚àô-cong</a> <a id="2814" class="Symbol">=</a> <a id="2816" class="Symbol">Œª</a> <a id="2818" class="Symbol">{</a><a id="2819" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="2824" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="2829" class="Symbol">‚Üí</a> <a id="2831" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="2836" class="Symbol">}}</a>
           <a id="2850" class="Symbol">;</a> <a id="2852" href="Algebra.Structures.html#3460" class="Field">assoc</a> <a id="2858" class="Symbol">=</a> <a id="2860" class="Symbol">Œª</a> <a id="2862" href="Cost.html#2862" class="Bound">x</a> <a id="2864" href="Cost.html#2864" class="Bound">y</a> <a id="2866" href="Cost.html#2866" class="Bound">z</a> <a id="2868" class="Symbol">‚Üí</a> <a id="2870" href="Relation.Binary.PropositionalEquality.Core.html#1576" class="Function">cong‚ÇÇ</a> <a id="2876" href="Cost.html#1991" class="InductiveConstructor">mkExBudget</a> <a id="2887" class="Symbol">(</a><a id="2888" href="Data.Nat.Properties.html#15113" class="Function">+-assoc</a> <a id="2896" class="Symbol">(</a><a id="2897" href="Cost.html#2014" class="Field">ExCPU</a> <a id="2903" href="Cost.html#2862" class="Bound">x</a><a id="2904" class="Symbol">)</a> <a id="2906" class="Symbol">(</a><a id="2907" href="Cost.html#2014" class="Field">ExCPU</a> <a id="2913" href="Cost.html#2864" class="Bound">y</a><a id="2914" class="Symbol">)</a> <a id="2916" class="Symbol">(</a><a id="2917" href="Cost.html#2014" class="Field">ExCPU</a> <a id="2923" href="Cost.html#2866" class="Bound">z</a><a id="2924" class="Symbol">))</a>
                                                <a id="2975" class="Symbol">(</a><a id="2976" href="Data.Nat.Properties.html#15113" class="Function">+-assoc</a> <a id="2984" class="Symbol">(</a><a id="2985" href="Cost.html#2050" class="Field">ExMem</a> <a id="2991" href="Cost.html#2862" class="Bound">x</a><a id="2992" class="Symbol">)</a> <a id="2994" class="Symbol">(</a><a id="2995" href="Cost.html#2050" class="Field">ExMem</a> <a id="3001" href="Cost.html#2864" class="Bound">y</a><a id="3002" class="Symbol">)</a> <a id="3004" class="Symbol">(</a><a id="3005" href="Cost.html#2050" class="Field">ExMem</a> <a id="3011" href="Cost.html#2866" class="Bound">z</a><a id="3012" class="Symbol">))</a> <a id="3015" class="Symbol">}</a>
     <a id="3022" class="Symbol">;</a> <a id="3024" href="Algebra.Structures.html#4918" class="Field">identity</a> <a id="3033" class="Symbol">=</a> <a id="3035" class="Symbol">(Œª</a> <a id="3038" href="Cost.html#3038" class="Bound">x</a> <a id="3040" class="Symbol">‚Üí</a> <a id="3042" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a><a id="3046" class="Symbol">)</a> <a id="3048" href="Cost.html#807" class="InductiveConstructor Operator">,,</a> <a id="3051" class="Symbol">Œª</a> <a id="3053" href="Cost.html#3053" class="Bound">x</a> <a id="3055" class="Symbol">‚Üí</a> <a id="3057" href="Relation.Binary.PropositionalEquality.Core.html#1576" class="Function">cong‚ÇÇ</a> <a id="3063" href="Cost.html#1991" class="InductiveConstructor">mkExBudget</a> <a id="3074" class="Symbol">(</a><a id="3075" href="Data.Nat.Properties.html#15269" class="Function">+-identity ≥</a> <a id="3087" class="Symbol">(</a><a id="3088" href="Cost.html#2014" class="Field">ExCPU</a> <a id="3094" href="Cost.html#3053" class="Bound">x</a><a id="3095" class="Symbol">))</a> <a id="3098" class="Symbol">(</a><a id="3099" href="Data.Nat.Properties.html#15269" class="Function">+-identity ≥</a> <a id="3111" class="Symbol">(</a><a id="3112" href="Cost.html#2050" class="Field">ExMem</a> <a id="3118" href="Cost.html#3053" class="Bound">x</a><a id="3119" class="Symbol">))</a> <a id="3122" class="Symbol">}</a>
</pre>
<h2 id="cost-of-executing-a-builtin">Cost of executing a builtin</h2>

<p>To calculate the cost of a builtin we obtain the corresponding builtin model,
and run the cpu and memory model using the vector of argument sizes.</p>

<pre class="Agda"><a id="builtinCost"></a><a id="3313" href="Cost.html#3313" class="Function">builtinCost</a> <a id="3325" class="Symbol">:</a> <a id="3327" class="Symbol">(</a><a id="3328" href="Cost.html#3328" class="Bound">b</a> <a id="3330" class="Symbol">:</a> <a id="3332" href="Builtin.html#1434" class="Datatype">Builtin</a><a id="3339" class="Symbol">)</a> <a id="3341" class="Symbol">‚Üí</a> <a id="3343" href="Cost.Model.html#3393" class="Record">BuiltinModel</a> <a id="3356" class="Symbol">(</a><a id="3357" href="Builtin.html#16778" class="Function">arity</a> <a id="3363" href="Cost.html#3328" class="Bound">b</a><a id="3364" class="Symbol">)</a> <a id="3366" class="Symbol">‚Üí</a> <a id="3368" href="Data.Vec.Base.html#1119" class="Datatype">Vec</a> <a id="3372" href="Untyped.CEK.html#1344" class="Datatype">Value</a> <a id="3378" class="Symbol">(</a><a id="3379" href="Builtin.html#16778" class="Function">arity</a> <a id="3385" href="Cost.html#3328" class="Bound">b</a><a id="3386" class="Symbol">)</a> <a id="3388" class="Symbol">‚Üí</a> <a id="3390" href="Cost.html#1956" class="Record">ExBudget</a>
<a id="3399" href="Cost.html#3313" class="Function">builtinCost</a> <a id="3411" href="Cost.html#3411" class="Bound">b</a> <a id="3413" href="Cost.html#3413" class="Bound">bc</a> <a id="3416" href="Cost.html#3416" class="Bound">cs</a> <a id="3419" class="Symbol">=</a> <a id="3421" href="Cost.html#1991" class="InductiveConstructor">mkExBudget</a> <a id="3432" class="Symbol">(</a><a id="3433" href="Cost.Model.html#3814" class="Function">runModel</a> <a id="3442" class="Symbol">(</a><a id="3443" href="Cost.Model.html#3445" class="Field">costingCPU</a> <a id="3454" href="Cost.html#3413" class="Bound">bc</a><a id="3456" class="Symbol">)</a> <a id="3458" href="Cost.html#3416" class="Bound">cs</a><a id="3460" class="Symbol">)</a> <a id="3462" class="Symbol">(</a><a id="3463" href="Cost.Model.html#3814" class="Function">runModel</a> <a id="3472" class="Symbol">(</a><a id="3473" href="Cost.Model.html#3456" class="Field">costingMem</a> <a id="3484" href="Cost.html#3413" class="Bound">bc</a><a id="3486" class="Symbol">)</a> <a id="3488" href="Cost.html#3416" class="Bound">cs</a><a id="3490" class="Symbol">)</a>
</pre>

<h2 id="default-machine-parameters">Default Machine Parameters</h2>

<p>The machine parameters for <code class="language-plaintext highlighter-rouge">ExBudget</code> for a given Cost Model</p>

<pre class="Agda"><a id="CostModel"></a><a id="3595" href="Cost.html#3595" class="Function">CostModel</a> <a id="3605" class="Symbol">=</a> <a id="3607" href="Cost.Raw.html#804" class="Postulate">HCekMachineCosts</a> <a id="3624" href="Utils.html#5063" class="Record Operator">√ó</a> <a id="3626" href="Cost.Model.html#10194" class="Function">ModelAssignment</a>

<a id="cekMachineCostFunction"></a><a id="3643" href="Cost.html#3643" class="Function">cekMachineCostFunction</a> <a id="3666" class="Symbol">:</a> <a id="3668" href="Cost.Raw.html#804" class="Postulate">HCekMachineCosts</a> <a id="3685" class="Symbol">‚Üí</a> <a id="3687" href="Cost.Base.html#898" class="Datatype">StepKind</a> <a id="3696" class="Symbol">‚Üí</a> <a id="3698" href="Cost.html#1956" class="Record">ExBudget</a>
<a id="3707" href="Cost.html#3643" class="Function">cekMachineCostFunction</a> <a id="3730" href="Cost.html#3730" class="Bound">mc</a> <a id="3733" href="Cost.Base.html#923" class="InductiveConstructor">BConst</a> <a id="3740" class="Symbol">=</a> <a id="3742" href="Cost.html#2101" class="Function">fromHExBudget</a> <a id="3756" class="Symbol">(</a><a id="3757" href="Cost.Raw.html#1104" class="Postulate">getCekConstCost</a> <a id="3773" href="Cost.html#3730" class="Bound">mc</a><a id="3775" class="Symbol">)</a>
<a id="3777" href="Cost.html#3643" class="Function">cekMachineCostFunction</a> <a id="3800" href="Cost.html#3800" class="Bound">mc</a> <a id="3803" href="Cost.Base.html#936" class="InductiveConstructor">BVar</a> <a id="3808" class="Symbol">=</a> <a id="3810" href="Cost.html#2101" class="Function">fromHExBudget</a> <a id="3824" class="Symbol">(</a><a id="3825" href="Cost.Raw.html#1044" class="Postulate">getCekVarCost</a> <a id="3839" href="Cost.html#3800" class="Bound">mc</a><a id="3841" class="Symbol">)</a>
<a id="3843" href="Cost.html#3643" class="Function">cekMachineCostFunction</a> <a id="3866" href="Cost.html#3866" class="Bound">mc</a> <a id="3869" href="Cost.Base.html#947" class="InductiveConstructor">BLamAbs</a> <a id="3877" class="Symbol">=</a> <a id="3879" href="Cost.html#2101" class="Function">fromHExBudget</a> <a id="3893" class="Symbol">(</a><a id="3894" href="Cost.Raw.html#1164" class="Postulate">getCekLamCost</a> <a id="3908" href="Cost.html#3866" class="Bound">mc</a><a id="3910" class="Symbol">)</a>
<a id="3912" href="Cost.html#3643" class="Function">cekMachineCostFunction</a> <a id="3935" href="Cost.html#3935" class="Bound">mc</a> <a id="3938" href="Cost.Base.html#961" class="InductiveConstructor">BApply</a> <a id="3945" class="Symbol">=</a> <a id="3947" href="Cost.html#2101" class="Function">fromHExBudget</a> <a id="3961" class="Symbol">(</a><a id="3962" href="Cost.Raw.html#1344" class="Postulate">getCekApplyCost</a> <a id="3978" href="Cost.html#3935" class="Bound">mc</a><a id="3980" class="Symbol">)</a>
<a id="3982" href="Cost.html#3643" class="Function">cekMachineCostFunction</a> <a id="4005" href="Cost.html#4005" class="Bound">mc</a> <a id="4008" href="Cost.Base.html#974" class="InductiveConstructor">BDelay</a> <a id="4015" class="Symbol">=</a> <a id="4017" href="Cost.html#2101" class="Function">fromHExBudget</a> <a id="4031" class="Symbol">(</a><a id="4032" href="Cost.Raw.html#1224" class="Postulate">getCekDelayCost</a> <a id="4048" href="Cost.html#4005" class="Bound">mc</a><a id="4050" class="Symbol">)</a>
<a id="4052" href="Cost.html#3643" class="Function">cekMachineCostFunction</a> <a id="4075" href="Cost.html#4075" class="Bound">mc</a> <a id="4078" href="Cost.Base.html#987" class="InductiveConstructor">BForce</a> <a id="4085" class="Symbol">=</a> <a id="4087" href="Cost.html#2101" class="Function">fromHExBudget</a> <a id="4101" class="Symbol">(</a><a id="4102" href="Cost.Raw.html#1284" class="Postulate">getCekForceCost</a> <a id="4118" href="Cost.html#4075" class="Bound">mc</a><a id="4120" class="Symbol">)</a>
<a id="4122" href="Cost.html#3643" class="Function">cekMachineCostFunction</a> <a id="4145" href="Cost.html#4145" class="Bound">mc</a> <a id="4148" href="Cost.Base.html#1000" class="InductiveConstructor">BBuiltin</a> <a id="4157" class="Symbol">=</a> <a id="4159" href="Cost.html#2101" class="Function">fromHExBudget</a> <a id="4173" class="Symbol">(</a><a id="4174" href="Cost.Raw.html#1404" class="Postulate">getCekBuiltinCost</a> <a id="4192" href="Cost.html#4145" class="Bound">mc</a><a id="4194" class="Symbol">)</a>
<a id="4196" href="Cost.html#3643" class="Function">cekMachineCostFunction</a> <a id="4219" href="Cost.html#4219" class="Bound">mc</a> <a id="4222" href="Cost.Base.html#1081" class="InductiveConstructor">BConstr</a> <a id="4230" class="Symbol">=</a> <a id="4232" href="Cost.html#2101" class="Function">fromHExBudget</a> <a id="4246" class="Symbol">(</a><a id="4247" href="Cost.Raw.html#1104" class="Postulate">getCekConstCost</a> <a id="4263" href="Cost.html#4219" class="Bound">mc</a><a id="4265" class="Symbol">)</a>
<a id="4267" href="Cost.html#3643" class="Function">cekMachineCostFunction</a> <a id="4290" href="Cost.html#4290" class="Bound">mc</a> <a id="4293" href="Cost.Base.html#1095" class="InductiveConstructor">BCase</a> <a id="4299" class="Symbol">=</a> <a id="4301" href="Cost.html#2101" class="Function">fromHExBudget</a> <a id="4315" class="Symbol">(</a><a id="4316" href="Cost.Raw.html#1524" class="Postulate">getCekCaseCost</a> <a id="4331" href="Cost.html#4290" class="Bound">mc</a><a id="4333" class="Symbol">)</a>

<a id="exBudgetCategoryCost"></a><a id="4336" href="Cost.html#4336" class="Function">exBudgetCategoryCost</a> <a id="4357" class="Symbol">:</a> <a id="4359" href="Cost.html#3595" class="Function">CostModel</a> <a id="4369" class="Symbol">‚Üí</a> <a id="4371" href="Cost.Base.html#1635" class="Datatype">ExBudgetCategory</a> <a id="4388" class="Symbol">‚Üí</a> <a id="4390" href="Cost.html#1956" class="Record">ExBudget</a>
<a id="4399" href="Cost.html#4336" class="Function">exBudgetCategoryCost</a> <a id="4420" class="Symbol">(</a><a id="4421" href="Cost.html#4421" class="Bound">cekMc</a> <a id="4427" href="Utils.html#5107" class="InductiveConstructor Operator">,</a> <a id="4429" class="Symbol">_)</a> <a id="4432" class="Symbol">(</a><a id="4433" href="Cost.Base.html#1711" class="InductiveConstructor">BStep</a> <a id="4439" href="Cost.html#4439" class="Bound">x</a><a id="4440" class="Symbol">)</a> <a id="4442" class="Symbol">=</a> <a id="4444" href="Cost.html#3643" class="Function">cekMachineCostFunction</a> <a id="4467" href="Cost.html#4421" class="Bound">cekMc</a> <a id="4473" href="Cost.html#4439" class="Bound">x</a>
<a id="4475" href="Cost.html#4336" class="Function">exBudgetCategoryCost</a> <a id="4496" class="Symbol">(_</a> <a id="4499" href="Utils.html#5107" class="InductiveConstructor Operator">,</a> <a id="4501" href="Cost.html#4501" class="Bound">ma</a><a id="4503" class="Symbol">)</a> <a id="4505" class="Symbol">(</a><a id="4506" href="Cost.Base.html#1818" class="InductiveConstructor">BBuiltinApp</a> <a id="4518" href="Cost.html#4518" class="Bound">b</a> <a id="4520" href="Cost.html#4520" class="Bound">cs</a><a id="4522" class="Symbol">)</a> <a id="4524" class="Symbol">=</a> <a id="4526" href="Cost.html#3313" class="Function">builtinCost</a> <a id="4538" href="Cost.html#4518" class="Bound">b</a> <a id="4540" class="Symbol">(</a><a id="4541" href="Cost.html#4501" class="Bound">ma</a> <a id="4544" href="Cost.html#4518" class="Bound">b</a><a id="4545" class="Symbol">)</a> <a id="4547" href="Cost.html#4520" class="Bound">cs</a>
<a id="4550" href="Cost.html#4336" class="Function">exBudgetCategoryCost</a> <a id="4571" class="Symbol">(</a><a id="4572" href="Cost.html#4572" class="Bound">cekMc</a> <a id="4578" href="Utils.html#5107" class="InductiveConstructor Operator">,</a> <a id="4580" class="Symbol">_)</a> <a id="4583" href="Cost.Base.html#1912" class="InductiveConstructor">BStartup</a> <a id="4592" class="Symbol">=</a> <a id="4594" href="Cost.html#2101" class="Function">fromHExBudget</a> <a id="4608" class="Symbol">(</a><a id="4609" href="Cost.Raw.html#984" class="Postulate">getCekStartupCost</a> <a id="4627" href="Cost.html#4572" class="Bound">cekMc</a><a id="4632" class="Symbol">)</a>

<a id="machineParameters"></a><a id="4635" href="Cost.html#4635" class="Function">machineParameters</a> <a id="4653" class="Symbol">:</a> <a id="4655" href="Cost.html#3595" class="Function">CostModel</a> <a id="4665" class="Symbol">‚Üí</a> <a id="4667" href="Cost.Base.html#2053" class="Record">MachineParameters</a> <a id="4685" href="Cost.html#1956" class="Record">ExBudget</a>
<a id="4694" href="Cost.html#4635" class="Function">machineParameters</a> <a id="4712" href="Cost.html#4712" class="Bound">costmodel</a> <a id="4722" class="Symbol">=</a> <a id="4724" class="Keyword">record</a> <a id="4731" class="Symbol">{</a>
    <a id="4737" href="Cost.Base.html#2112" class="Field">cekMachineCost</a> <a id="4752" class="Symbol">=</a> <a id="4754" href="Cost.html#4336" class="Function">exBudgetCategoryCost</a> <a id="4775" href="Cost.html#4712" class="Bound">costmodel</a>
  <a id="4787" class="Symbol">;</a> <a id="4789" href="Cost.Base.html#2159" class="Field">Œµ</a> <a id="4791" class="Symbol">=</a> <a id="4793" href="Cost.html#2331" class="Function">Œµ‚Ç¨</a>
  <a id="4798" class="Symbol">;</a> <a id="4800" href="Cost.Base.html#2174" class="Field Operator">_‚àô_</a> <a id="4804" class="Symbol">=</a> <a id="4806" href="Cost.html#2386" class="Function Operator">_‚àô‚Ç¨_</a>
  <a id="4813" class="Symbol">;</a> <a id="4815" href="Cost.Base.html#2205" class="Field">costMonoid</a> <a id="4826" class="Symbol">=</a> <a id="4828" href="Cost.html#2647" class="Function">isMonoidExBudget</a>
 <a id="4846" class="Symbol">}</a>

<a id="countingReport"></a><a id="4849" href="Cost.html#4849" class="Function">countingReport</a> <a id="4864" class="Symbol">:</a> <a id="4866" href="Cost.html#1956" class="Record">ExBudget</a> <a id="4875" class="Symbol">‚Üí</a> <a id="4877" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="4884" href="Cost.html#4849" class="Function">countingReport</a> <a id="4899" class="Symbol">(</a><a id="4900" href="Cost.html#1991" class="InductiveConstructor">mkExBudget</a> <a id="4911" href="Cost.html#4911" class="Bound">cpu</a> <a id="4915" href="Cost.html#4915" class="Bound">mem</a><a id="4918" class="Symbol">)</a> <a id="4920" class="Symbol">=</a>
      <a id="4928" class="String">&quot;\nCPU budget:    &quot;</a> <a id="4948" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="4951" href="Cost.html#486" class="Function">show‚Ñï</a> <a id="4957" href="Cost.html#4911" class="Bound">cpu</a>
   <a id="4964" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="4967" class="String">&quot;\nMemory budget: &quot;</a> <a id="4987" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="4990" href="Cost.html#486" class="Function">show‚Ñï</a> <a id="4996" href="Cost.html#4915" class="Bound">mem</a>
</pre>
<p>## Tallying budget</p>

<p>These functions define a type for Budgets that can record detailed cost information
about nodes and builtins.</p>

<p>We need a map from <code class="language-plaintext highlighter-rouge">ExBudgetCategory</code> into <code class="language-plaintext highlighter-rouge">ExBudget</code>.
It‚Äôs not the most efficient, but the simplest thing to do is to
transform <code class="language-plaintext highlighter-rouge">ExBudgetCategory</code> into a string, and use that as keys.</p>

<pre class="Agda"><a id="mkKeyFromExBudgetCategory"></a><a id="5326" href="Cost.html#5326" class="Function">mkKeyFromExBudgetCategory</a> <a id="5352" class="Symbol">:</a> <a id="5354" href="Cost.Base.html#1635" class="Datatype">ExBudgetCategory</a> <a id="5371" class="Symbol">‚Üí</a> <a id="5373" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="5380" href="Cost.html#5326" class="Function">mkKeyFromExBudgetCategory</a> <a id="5406" class="Symbol">(</a><a id="5407" href="Cost.Base.html#1711" class="InductiveConstructor">BStep</a> <a id="5413" href="Cost.html#5413" class="Bound">x</a><a id="5414" class="Symbol">)</a> <a id="5416" class="Symbol">=</a> <a id="5418" class="String">&quot;0&quot;</a> <a id="5422" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="5425" href="Cost.Base.html#1263" class="Function">showStepKind</a> <a id="5438" href="Cost.html#5413" class="Bound">x</a>
<a id="5440" href="Cost.html#5326" class="Function">mkKeyFromExBudgetCategory</a> <a id="5466" class="Symbol">(</a><a id="5467" href="Cost.Base.html#1818" class="InductiveConstructor">BBuiltinApp</a> <a id="5479" href="Cost.html#5479" class="Bound">x</a> <a id="5481" class="Symbol">_)</a> <a id="5484" class="Symbol">=</a> <a id="5486" class="String">&quot;1&quot;</a><a id="5489" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="5492" href="Builtin.html#33776" class="Function">showBuiltin</a> <a id="5504" href="Cost.html#5479" class="Bound">x</a>
<a id="5506" href="Cost.html#5326" class="Function">mkKeyFromExBudgetCategory</a> <a id="5532" href="Cost.Base.html#1912" class="InductiveConstructor">BStartup</a> <a id="5541" class="Symbol">=</a> <a id="5543" class="String">&quot;2&quot;</a>

<a id="TallyingBudget"></a><a id="5548" href="Cost.html#5548" class="Function">TallyingBudget</a> <a id="5563" class="Symbol">:</a> <a id="5565" href="Agda.Primitive.html#388" class="Primitive">Set</a>
<a id="5569" href="Cost.html#5548" class="Function">TallyingBudget</a> <a id="5584" class="Symbol">=</a> <a id="5586" href="Data.Tree.AVL.Map.html#1133" class="Function">Map</a> <a id="5590" href="Cost.html#1956" class="Record">ExBudget</a> <a id="5599" href="Utils.html#5063" class="Record Operator">√ó</a> <a id="5601" href="Cost.html#1956" class="Record">ExBudget</a>

<a id="lookup"></a><a id="5611" href="Cost.html#5611" class="Function">lookup</a> <a id="5618" class="Symbol">:</a> <a id="5620" href="Data.Tree.AVL.Map.html#1133" class="Function">Map</a> <a id="5624" href="Cost.html#1956" class="Record">ExBudget</a> <a id="5633" class="Symbol">‚Üí</a> <a id="5635" href="Cost.Base.html#1635" class="Datatype">ExBudgetCategory</a> <a id="5652" class="Symbol">‚Üí</a> <a id="5654" href="Cost.html#1956" class="Record">ExBudget</a>
<a id="5663" href="Cost.html#5611" class="Function">lookup</a> <a id="5670" href="Cost.html#5670" class="Bound">m</a> <a id="5672" href="Cost.html#5672" class="Bound">k</a> <a id="5674" class="Keyword">with</a> <a id="5679" href="Cost.html#1432" class="Function">lookupAVL</a> <a id="5689" href="Cost.html#5670" class="Bound">m</a> <a id="5691" class="Symbol">(</a><a id="5692" href="Cost.html#5326" class="Function">mkKeyFromExBudgetCategory</a> <a id="5718" href="Cost.html#5672" class="Bound">k</a><a id="5719" class="Symbol">)</a>
<a id="5721" class="Symbol">...</a> <a id="5725" class="Symbol">|</a> <a id="5727" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="5732" href="Cost.html#5732" class="Bound">x</a> <a id="5734" class="Symbol">=</a> <a id="5736" href="Cost.html#5732" class="Bound">x</a>
<a id="5738" class="Symbol">...</a> <a id="5742" class="Symbol">|</a> <a id="5744" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="5752" class="Symbol">=</a> <a id="5754" href="Cost.html#2331" class="Function">Œµ‚Ç¨</a>
</pre>
<p>As required, <code class="language-plaintext highlighter-rouge">TallyingBudget</code> is a monoid.</p>

<pre class="Agda"><a id="5810" class="Comment">--unit of TallyingBudget</a>
<a id="ŒµT"></a><a id="5835" href="Cost.html#5835" class="Function">ŒµT</a> <a id="5838" class="Symbol">:</a> <a id="5840" href="Cost.html#5548" class="Function">TallyingBudget</a>
<a id="5855" href="Cost.html#5835" class="Function">ŒµT</a> <a id="5858" class="Symbol">=</a> <a id="5860" href="Data.Tree.AVL.Map.html#1300" class="Function">empty</a> <a id="5866" href="Utils.html#5107" class="InductiveConstructor Operator">,</a> <a id="5868" href="Cost.html#2331" class="Function">Œµ‚Ç¨</a>

<a id="5872" class="Comment">-- adding TallyingBudgets</a>
<a id="_‚àôT_"></a><a id="5898" href="Cost.html#5898" class="Function Operator">_‚àôT_</a> <a id="5903" class="Symbol">:</a> <a id="5905" href="Cost.html#5548" class="Function">TallyingBudget</a> <a id="5920" class="Symbol">‚Üí</a> <a id="5922" href="Cost.html#5548" class="Function">TallyingBudget</a> <a id="5937" class="Symbol">‚Üí</a> <a id="5939" href="Cost.html#5548" class="Function">TallyingBudget</a>
<a id="5954" class="Symbol">(</a><a id="5955" href="Cost.html#5955" class="Bound">m</a> <a id="5957" href="Utils.html#5107" class="InductiveConstructor Operator">,</a> <a id="5959" href="Cost.html#5959" class="Bound">x</a><a id="5960" class="Symbol">)</a> <a id="5962" href="Cost.html#5898" class="Function Operator">‚àôT</a> <a id="5965" class="Symbol">(</a><a id="5966" href="Cost.html#5966" class="Bound">n</a> <a id="5968" href="Utils.html#5107" class="InductiveConstructor Operator">,</a> <a id="5970" href="Cost.html#5970" class="Bound">y</a><a id="5971" class="Symbol">)</a> <a id="5973" class="Symbol">=</a> <a id="5975" href="Data.Tree.AVL.Map.html#2317" class="Function">unionWith</a> <a id="5985" href="Cost.html#6011" class="Function">u</a> <a id="5987" href="Cost.html#5955" class="Bound">m</a> <a id="5989" href="Cost.html#5966" class="Bound">n</a> <a id="5991" href="Utils.html#5107" class="InductiveConstructor Operator">,</a> <a id="5993" class="Symbol">(</a><a id="5994" href="Cost.html#5959" class="Bound">x</a> <a id="5996" href="Cost.html#2386" class="Function Operator">‚àô‚Ç¨</a> <a id="5999" href="Cost.html#5970" class="Bound">y</a><a id="6000" class="Symbol">)</a>
   <a id="6005" class="Keyword">where</a> <a id="6011" href="Cost.html#6011" class="Function">u</a> <a id="6013" class="Symbol">:</a> <a id="6015" href="Cost.html#1956" class="Record">ExBudget</a> <a id="6024" class="Symbol">‚Üí</a> <a id="6026" href="Agda.Builtin.Maybe.html#135" class="Datatype">Maybe</a> <a id="6032" class="Symbol">(</a><a id="6033" href="Cost.html#1956" class="Record">ExBudget</a><a id="6041" class="Symbol">)</a> <a id="6043" class="Symbol">‚Üí</a> <a id="6045" href="Cost.html#1956" class="Record">ExBudget</a>
         <a id="6063" href="Cost.html#6011" class="Function">u</a> <a id="6065" href="Cost.html#6065" class="Bound">x</a> <a id="6067" class="Symbol">(</a><a id="6068" href="Agda.Builtin.Maybe.html#173" class="InductiveConstructor">just</a> <a id="6073" href="Cost.html#6073" class="Bound">y</a><a id="6074" class="Symbol">)</a> <a id="6076" class="Symbol">=</a> <a id="6078" href="Cost.html#6065" class="Bound">x</a> <a id="6080" href="Cost.html#2386" class="Function Operator">‚àô‚Ç¨</a> <a id="6083" href="Cost.html#6073" class="Bound">y</a>
         <a id="6094" href="Cost.html#6011" class="Function">u</a> <a id="6096" href="Cost.html#6096" class="Bound">x</a> <a id="6098" href="Agda.Builtin.Maybe.html#194" class="InductiveConstructor">nothing</a> <a id="6106" class="Symbol">=</a> <a id="6108" href="Cost.html#6096" class="Bound">x</a>

<a id="6111" class="Comment">-- TODO : Prove these postulates.</a>
<a id="6145" class="Keyword">postulate</a> <a id="TallyingBudget-assoc"></a><a id="6155" href="Cost.html#6155" class="Postulate">TallyingBudget-assoc</a> <a id="6176" class="Symbol">:</a> <a id="6178" href="Algebra.Definitions.html#1548" class="Function">Algebra.Associative</a> <a id="6198" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">_‚â°_</a> <a id="6202" href="Cost.html#5898" class="Function Operator">_‚àôT_</a>
<a id="6207" class="Keyword">postulate</a> <a id="Tallying-budget-identity ≥"></a><a id="6217" href="Cost.html#6217" class="Postulate">Tallying-budget-identity ≥</a> <a id="6243" class="Symbol">:</a> <a id="6245" href="Algebra.Definitions.html#1781" class="Function">Algebra.RightIdentity</a> <a id="6267" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">_‚â°_</a> <a id="6271" href="Cost.html#5835" class="Function">ŒµT</a> <a id="6274" href="Cost.html#5898" class="Function Operator">_‚àôT_</a>

<a id="isMonoidTallyingBudget"></a><a id="6280" href="Cost.html#6280" class="Function">isMonoidTallyingBudget</a> <a id="6303" class="Symbol">:</a> <a id="6305" href="Algebra.Structures.html#4825" class="Record">IsMonoid</a> <a id="6314" href="Agda.Builtin.Equality.html#150" class="Datatype Operator">_‚â°_</a> <a id="6318" href="Cost.html#5898" class="Function Operator">_‚àôT_</a> <a id="6323" href="Cost.html#5835" class="Function">ŒµT</a>
<a id="6326" href="Cost.html#6280" class="Function">isMonoidTallyingBudget</a> <a id="6349" class="Symbol">=</a> <a id="6351" class="Keyword">record</a> <a id="6358" class="Symbol">{</a>
       <a id="6367" href="Algebra.Structures.html#4886" class="Field">isSemigroup</a> <a id="6379" class="Symbol">=</a> <a id="6381" class="Keyword">record</a> <a id="6388" class="Symbol">{</a>
           <a id="6401" href="Algebra.Structures.html#3436" class="Field">isMagma</a> <a id="6409" class="Symbol">=</a> <a id="6411" class="Keyword">record</a> <a id="6418" class="Symbol">{</a> <a id="6420" href="Algebra.Structures.html#1760" class="Field">isEquivalence</a> <a id="6434" class="Symbol">=</a> <a id="6436" href="Relation.Binary.PropositionalEquality.Properties.html#5411" class="Function">isEquivalence</a>
                            <a id="6478" class="Symbol">;</a> <a id="6480" href="Algebra.Structures.html#1798" class="Field">‚àô-cong</a> <a id="6487" class="Symbol">=</a> <a id="6489" class="Symbol">Œª</a> <a id="6491" class="Symbol">{</a><a id="6492" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="6497" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="6502" class="Symbol">‚Üí</a> <a id="6504" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a> <a id="6509" class="Symbol">}}</a>
           <a id="6523" class="Symbol">;</a> <a id="6525" href="Algebra.Structures.html#3460" class="Field">assoc</a> <a id="6531" class="Symbol">=</a> <a id="6533" href="Cost.html#6155" class="Postulate">TallyingBudget-assoc</a> <a id="6554" class="Symbol">}</a>
     <a id="6561" class="Symbol">;</a> <a id="6563" href="Algebra.Structures.html#4918" class="Field">identity</a> <a id="6572" class="Symbol">=</a> <a id="6574" class="Symbol">(Œª</a> <a id="6577" href="Cost.html#6577" class="Bound">x</a> <a id="6579" class="Symbol">‚Üí</a> <a id="6581" href="Agda.Builtin.Equality.html#207" class="InductiveConstructor">refl</a><a id="6585" class="Symbol">)</a> <a id="6587" href="Cost.html#807" class="InductiveConstructor Operator">,,</a> <a id="6590" href="Cost.html#6217" class="Postulate">Tallying-budget-identity ≥</a> <a id="6616" class="Symbol">}</a>

<a id="tallyingCekMachineCost"></a><a id="6619" href="Cost.html#6619" class="Function">tallyingCekMachineCost</a> <a id="6642" class="Symbol">:</a> <a id="6644" href="Cost.html#3595" class="Function">CostModel</a> <a id="6654" class="Symbol">‚Üí</a> <a id="6656" href="Cost.Base.html#1635" class="Datatype">ExBudgetCategory</a> <a id="6673" class="Symbol">‚Üí</a> <a id="6675" href="Cost.html#5548" class="Function">TallyingBudget</a>
<a id="6690" href="Cost.html#6619" class="Function">tallyingCekMachineCost</a> <a id="6713" href="Cost.html#6713" class="Bound">cm</a> <a id="6716" href="Cost.html#6716" class="Bound">k</a> <a id="6718" class="Symbol">=</a>
      <a id="6726" class="Keyword">let</a> <a id="6730" href="Cost.html#6730" class="Bound">spent</a> <a id="6736" class="Symbol">=</a> <a id="6738" href="Cost.html#4336" class="Function">exBudgetCategoryCost</a> <a id="6759" href="Cost.html#6713" class="Bound">cm</a> <a id="6762" href="Cost.html#6716" class="Bound">k</a>
      <a id="6770" class="Keyword">in</a> <a id="6773" href="Data.Tree.AVL.Map.html#1333" class="Function">singleton</a> <a id="6783" class="Symbol">(</a><a id="6784" href="Cost.html#5326" class="Function">mkKeyFromExBudgetCategory</a> <a id="6810" href="Cost.html#6716" class="Bound">k</a><a id="6811" class="Symbol">)</a> <a id="6813" href="Cost.html#6730" class="Bound">spent</a> <a id="6819" href="Utils.html#5107" class="InductiveConstructor Operator">,</a> <a id="6821" href="Cost.html#6730" class="Bound">spent</a>

<a id="tallyingMachineParameters"></a><a id="6828" href="Cost.html#6828" class="Function">tallyingMachineParameters</a> <a id="6854" class="Symbol">:</a> <a id="6856" href="Cost.html#3595" class="Function">CostModel</a> <a id="6866" class="Symbol">‚Üí</a> <a id="6868" href="Cost.Base.html#2053" class="Record">MachineParameters</a> <a id="6886" href="Cost.html#5548" class="Function">TallyingBudget</a>
<a id="6901" href="Cost.html#6828" class="Function">tallyingMachineParameters</a> <a id="6927" href="Cost.html#6927" class="Bound">cm</a> <a id="6930" class="Symbol">=</a> <a id="6932" class="Keyword">record</a> <a id="6939" class="Symbol">{</a>
        <a id="6949" href="Cost.Base.html#2112" class="Field">cekMachineCost</a> <a id="6964" class="Symbol">=</a> <a id="6966" href="Cost.html#6619" class="Function">tallyingCekMachineCost</a> <a id="6989" href="Cost.html#6927" class="Bound">cm</a>
      <a id="6998" class="Symbol">;</a> <a id="7000" href="Cost.Base.html#2159" class="Field">Œµ</a> <a id="7002" class="Symbol">=</a> <a id="7004" href="Cost.html#5835" class="Function">ŒµT</a>
      <a id="7013" class="Symbol">;</a> <a id="7015" href="Cost.Base.html#2174" class="Field Operator">_‚àô_</a> <a id="7019" class="Symbol">=</a> <a id="7021" href="Cost.html#5898" class="Function Operator">_‚àôT_</a>
      <a id="7032" class="Symbol">;</a> <a id="7034" href="Cost.Base.html#2205" class="Field">costMonoid</a> <a id="7045" class="Symbol">=</a> <a id="7047" href="Cost.html#6280" class="Function">isMonoidTallyingBudget</a>
      <a id="7076" class="Symbol">}</a>

<a id="tallyingReport"></a><a id="7079" href="Cost.html#7079" class="Function">tallyingReport</a> <a id="7094" class="Symbol">:</a> <a id="7096" href="Cost.html#5548" class="Function">TallyingBudget</a> <a id="7111" class="Symbol">‚Üí</a> <a id="7113" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
<a id="7120" href="Cost.html#7079" class="Function">tallyingReport</a> <a id="7135" class="Symbol">(</a><a id="7136" href="Cost.html#7136" class="Bound">mp</a> <a id="7139" href="Utils.html#5107" class="InductiveConstructor Operator">,</a> <a id="7141" href="Cost.html#7141" class="Bound">budget</a><a id="7147" class="Symbol">)</a> <a id="7149" class="Symbol">=</a>
       <a id="7158" href="Cost.html#4849" class="Function">countingReport</a> <a id="7173" href="Cost.html#7141" class="Bound">budget</a>
    <a id="7184" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7187" class="String">&quot;\n&quot;</a>
    <a id="7196" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7199" class="String">&quot;\n&quot;</a>
    <a id="7208" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7211" href="Cost.html#8692" class="Function">printStepReport</a> <a id="7227" href="Cost.html#7136" class="Bound">mp</a>
    <a id="7234" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7237" class="String">&quot;\n&quot;</a>
    <a id="7246" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7249" class="String">&quot;startup    &quot;</a> <a id="7263" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7266" href="Cost.html#8308" class="Function">budgetToString</a> <a id="7281" class="Symbol">(</a><a id="7282" href="Cost.html#5611" class="Function">lookup</a> <a id="7289" href="Cost.html#7136" class="Bound">mp</a> <a id="7292" href="Cost.Base.html#1912" class="InductiveConstructor">BStartup</a><a id="7300" class="Symbol">)</a> <a id="7302" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7305" class="String">&quot;\n&quot;</a>
    <a id="7314" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7317" class="String">&quot;compute    &quot;</a> <a id="7331" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7334" href="Cost.html#8308" class="Function">budgetToString</a> <a id="7349" href="Cost.html#7963" class="Function">totalComputeCost</a> <a id="7366" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7369" class="String">&quot;\n&quot;</a>
    <a id="7378" class="Comment">-- ++ &quot;AST nodes  &quot; ++ ++ &quot;\n&quot;</a>
    <a id="7413" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7416" class="String">&quot;\n\n&quot;</a>
    <a id="7427" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7430" href="Cost.html#9133" class="Function">printBuiltinReport</a> <a id="7449" href="Cost.html#7136" class="Bound">mp</a>
    <a id="7456" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7459" class="String">&quot;\n&quot;</a>
    <a id="7468" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7471" class="String">&quot;Total builtin costs:   &quot;</a> <a id="7497" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7500" href="Cost.html#8308" class="Function">budgetToString</a> <a id="7515" href="Cost.html#7980" class="Function">totalBuiltinCosts</a> <a id="7533" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7536" class="String">&quot;\n&quot;</a>
     <a id="7546" class="Comment">-- We would like to be able to print the following  number as &quot;%4.2f&quot;</a>
     <a id="7621" class="Comment">-- but Agda&#39;s printf currently doesn&#39;t support it.</a>
    <a id="7676" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7679" href="Text.Printf.html#1015" class="Function">printf</a> <a id="7686" class="String">&quot;Time spent executing builtins:  %f%%\n&quot;</a> <a id="7727" class="Symbol">(</a><a id="7728" href="Agda.Builtin.Float.html#822" class="Primitive">from‚Ñï</a> <a id="7734" class="Number">100</a> <a id="7738" href="Cost.html#615" class="Primitive Operator">*f</a> <a id="7741" class="Symbol">(</a><a id="7742" href="Cost.html#8246" class="Function">getCPU</a> <a id="7749" href="Cost.html#7980" class="Function">totalBuiltinCosts</a><a id="7766" class="Symbol">)</a> <a id="7768" href="Agda.Builtin.Float.html#1500" class="Primitive Operator">√∑</a> <a id="7770" class="Symbol">(</a><a id="7771" href="Cost.html#8246" class="Function">getCPU</a> <a id="7778" href="Cost.html#7141" class="Bound">budget</a><a id="7784" class="Symbol">))</a> <a id="7787" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7790" class="String">&quot;\n&quot;</a>
    <a id="7799" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7802" class="String">&quot;\n&quot;</a>
    <a id="7811" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7814" class="String">&quot;Total budget spent:    &quot;</a> <a id="7840" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7843" href="Cost.html#8308" class="Function">budgetToString</a> <a id="7858" href="Cost.html#7141" class="Bound">budget</a> <a id="7865" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7868" class="String">&quot;\n&quot;</a>
    <a id="7877" href="Data.String.Base.html#2425" class="Function Operator">++</a>  <a id="7881" class="String">&quot;Predicted execution time: &quot;</a> <a id="7910" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="7913" href="Cost.html#9380" class="Function">formatTimePicoseconds</a> <a id="7935" class="Symbol">(</a><a id="7936" href="Cost.html#8246" class="Function">getCPU</a> <a id="7943" href="Cost.html#7141" class="Bound">budget</a><a id="7949" class="Symbol">)</a>
  <a id="7953" class="Keyword">where</a>
    <a id="7963" href="Cost.html#7963" class="Function">totalComputeCost</a> <a id="7980" href="Cost.html#7980" class="Function">totalBuiltinCosts</a> <a id="7998" class="Symbol">:</a> <a id="8000" href="Cost.html#1956" class="Record">ExBudget</a>
    <a id="8013" href="Cost.html#7963" class="Function">totalComputeCost</a> <a id="8030" class="Symbol">=</a> <a id="8032" href="Data.List.Base.html#4148" class="Function">L.foldr</a> <a id="8040" class="Symbol">(Œª</a> <a id="8043" href="Cost.html#8043" class="Bound">x</a> <a id="8045" href="Cost.html#8045" class="Bound">acc</a> <a id="8049" class="Symbol">‚Üí</a> <a id="8051" class="Symbol">(</a><a id="8052" href="Cost.html#5611" class="Function">lookup</a> <a id="8059" href="Cost.html#7136" class="Bound">mp</a> <a id="8062" class="Symbol">(</a><a id="8063" href="Cost.Base.html#1711" class="InductiveConstructor">BStep</a> <a id="8069" href="Cost.html#8043" class="Bound">x</a><a id="8070" class="Symbol">))</a> <a id="8073" href="Cost.html#2386" class="Function Operator">‚àô‚Ç¨</a> <a id="8076" href="Cost.html#8045" class="Bound">acc</a><a id="8079" class="Symbol">)</a> <a id="8081" href="Cost.html#2331" class="Function">Œµ‚Ç¨</a> <a id="8084" href="Cost.Base.html#1394" class="Function">stepKindList</a>
    <a id="8101" href="Cost.html#7980" class="Function">totalBuiltinCosts</a> <a id="8119" class="Symbol">=</a> <a id="8121" href="Data.List.Base.html#4148" class="Function">L.foldr</a> <a id="8129" href="Cost.html#2386" class="Function Operator">_‚àô‚Ç¨_</a> <a id="8134" href="Cost.html#2331" class="Function">Œµ‚Ç¨</a> <a id="8137" class="Symbol">(</a><a id="8138" href="Data.List.Base.html#1634" class="Function">L.map</a> <a id="8144" class="Symbol">(</a><a id="8145" href="Cost.html#5611" class="Function">lookup</a> <a id="8152" href="Cost.html#7136" class="Bound">mp</a> <a id="8155" href="Function.Base.html#1115" class="Function Operator">‚àò</a> <a id="8157" class="Symbol">(Œª</a> <a id="8160" href="Cost.html#8160" class="Bound">b</a> <a id="8162" class="Symbol">‚Üí</a> <a id="8164" href="Cost.Base.html#1818" class="InductiveConstructor">BBuiltinApp</a> <a id="8176" href="Cost.html#8160" class="Bound">b</a> <a id="8178" class="Symbol">(</a><a id="8179" href="Data.Vec.Base.html#6493" class="Function">replicate</a> <a id="8189" class="Symbol">(</a><a id="8190" href="Builtin.html#16778" class="Function">arity</a> <a id="8196" href="Cost.html#8160" class="Bound">b</a><a id="8197" class="Symbol">)</a> <a id="8199" class="Symbol">(</a><a id="8200" href="Untyped.CEK.html#1613" class="InductiveConstructor">V-con</a> <a id="8206" class="Symbol">(</a><a id="8207" href="Builtin.Signature.html#1941" class="InductiveConstructor">atomic</a> <a id="8214" href="Builtin.Constant.AtomicType.html#710" class="InductiveConstructor">aUnit</a><a id="8219" class="Symbol">)</a> <a id="8221" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a><a id="8223" class="Symbol">))))</a> <a id="8228" href="Builtin.html#33921" class="Function">builtinList</a><a id="8239" class="Symbol">)</a>

    <a id="8246" href="Cost.html#8246" class="Function">getCPU</a> <a id="8253" class="Symbol">:</a> <a id="8255" href="Cost.html#1956" class="Record">ExBudget</a> <a id="8264" class="Symbol">‚Üí</a> <a id="8266" href="Agda.Builtin.Float.html#353" class="Postulate">Float</a>
    <a id="8276" href="Cost.html#8246" class="Function">getCPU</a> <a id="8283" href="Cost.html#8283" class="Bound">n</a> <a id="8285" class="Symbol">=</a> <a id="8287" href="Agda.Builtin.Float.html#822" class="Primitive">from‚Ñï</a> <a id="8293" class="Symbol">(</a><a id="8294" href="Cost.html#2014" class="Field">ExCPU</a> <a id="8300" href="Cost.html#8283" class="Bound">n</a><a id="8301" class="Symbol">)</a>

    <a id="8308" href="Cost.html#8308" class="Function">budgetToString</a> <a id="8323" class="Symbol">:</a> <a id="8325" href="Cost.html#1956" class="Record">ExBudget</a> <a id="8334" class="Symbol">‚Üí</a> <a id="8336" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="8347" href="Cost.html#8308" class="Function">budgetToString</a> <a id="8362" class="Symbol">(</a><a id="8363" href="Cost.html#1991" class="InductiveConstructor">mkExBudget</a> <a id="8374" href="Cost.html#8374" class="Bound">cpu</a> <a id="8378" href="Cost.html#8378" class="Bound">mem</a><a id="8381" class="Symbol">)</a> <a id="8383" class="Symbol">=</a> <a id="8385" href="Data.String.Base.html#3710" class="Function">padLeft</a> <a id="8393" class="String">&#39; &#39;</a> <a id="8397" class="Number">15</a> <a id="8400" class="Symbol">(</a><a id="8401" href="Cost.html#486" class="Function">show‚Ñï</a> <a id="8407" href="Cost.html#8374" class="Bound">cpu</a><a id="8410" class="Symbol">)</a> <a id="8412" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="8415" class="String">&quot;  &quot;</a>
                                       <a id="8459" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="8462" href="Data.String.Base.html#3710" class="Function">padLeft</a> <a id="8470" class="String">&#39; &#39;</a> <a id="8474" class="Number">15</a> <a id="8477" class="Symbol">(</a><a id="8478" href="Cost.html#486" class="Function">show‚Ñï</a> <a id="8484" href="Cost.html#8378" class="Bound">mem</a><a id="8487" class="Symbol">)</a>

    <a id="8494" href="Cost.html#8494" class="Function">printStepCost</a> <a id="8508" class="Symbol">:</a> <a id="8510" href="Cost.Base.html#898" class="Datatype">StepKind</a> <a id="8519" class="Symbol">‚Üí</a> <a id="8521" href="Cost.html#1956" class="Record">ExBudget</a> <a id="8530" class="Symbol">‚Üí</a> <a id="8532" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="8543" href="Cost.html#8494" class="Function">printStepCost</a> <a id="8557" href="Cost.html#8557" class="Bound">sk</a> <a id="8560" href="Cost.html#8560" class="Bound">budget</a> <a id="8567" class="Symbol">=</a> <a id="8569" href="Data.String.Base.html#3841" class="Function">padRight</a> <a id="8578" class="String">&#39; &#39;</a> <a id="8582" class="Number">10</a> <a id="8585" class="Symbol">(</a><a id="8586" href="Cost.Base.html#1263" class="Function">showStepKind</a> <a id="8599" href="Cost.html#8557" class="Bound">sk</a><a id="8601" class="Symbol">)</a> <a id="8603" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="8606" class="String">&quot; &quot;</a>
                           <a id="8637" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="8640" href="Data.String.Base.html#3710" class="Function">padLeft</a> <a id="8648" class="String">&#39; &#39;</a> <a id="8652" class="Number">20</a> <a id="8655" class="Symbol">(</a><a id="8656" href="Cost.html#8308" class="Function">budgetToString</a> <a id="8671" href="Cost.html#8560" class="Bound">budget</a><a id="8677" class="Symbol">)</a> <a id="8679" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="8682" class="String">&quot;\n&quot;</a>

    <a id="8692" href="Cost.html#8692" class="Function">printStepReport</a> <a id="8708" class="Symbol">:</a> <a id="8710" href="Data.Tree.AVL.Map.html#1133" class="Function">Map</a> <a id="8714" href="Cost.html#1956" class="Record">ExBudget</a> <a id="8723" class="Symbol">‚Üí</a> <a id="8725" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="8736" href="Cost.html#8692" class="Function">printStepReport</a> <a id="8752" href="Cost.html#8752" class="Bound">mp</a> <a id="8755" class="Symbol">=</a> <a id="8757" href="Data.List.Base.html#4148" class="Function">L.foldr</a> <a id="8765" class="Symbol">(Œª</a> <a id="8768" href="Cost.html#8768" class="Bound">s</a> <a id="8770" href="Cost.html#8770" class="Bound">xs</a> <a id="8773" class="Symbol">‚Üí</a> <a id="8775" href="Cost.html#8494" class="Function">printStepCost</a> <a id="8789" href="Cost.html#8768" class="Bound">s</a> <a id="8791" class="Symbol">(</a><a id="8792" href="Cost.html#5611" class="Function">lookup</a> <a id="8799" href="Cost.html#8752" class="Bound">mp</a> <a id="8802" class="Symbol">(</a><a id="8803" href="Cost.Base.html#1711" class="InductiveConstructor">BStep</a> <a id="8809" href="Cost.html#8768" class="Bound">s</a><a id="8810" class="Symbol">))</a> <a id="8813" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="8816" href="Cost.html#8770" class="Bound">xs</a><a id="8818" class="Symbol">)</a>
                               <a id="8851" class="String">&quot;&quot;</a>
                               <a id="8885" href="Cost.Base.html#1394" class="Function">stepKindList</a>

    <a id="8903" href="Cost.html#8903" class="Function">printBuiltinCost</a> <a id="8920" class="Symbol">:</a> <a id="8922" href="Builtin.html#1434" class="Datatype">Builtin</a> <a id="8930" class="Symbol">‚Üí</a> <a id="8932" href="Cost.html#1956" class="Record">ExBudget</a> <a id="8941" class="Symbol">‚Üí</a> <a id="8943" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="8954" href="Cost.html#8903" class="Function">printBuiltinCost</a> <a id="8971" href="Cost.html#8971" class="Bound">b</a> <a id="8973" class="Symbol">(</a><a id="8974" href="Cost.html#1991" class="InductiveConstructor">mkExBudget</a> <a id="8985" class="Number">0</a> <a id="8987" class="Number">0</a><a id="8988" class="Symbol">)</a> <a id="8990" class="Symbol">=</a> <a id="8992" class="String">&quot;&quot;</a>
    <a id="8999" href="Cost.html#8903" class="CatchallClause Function">printBuiltinCost</a><a id="9015" class="CatchallClause"> </a><a id="9016" href="Cost.html#9016" class="CatchallClause Bound">b</a><a id="9017" class="CatchallClause"> </a><a id="9018" href="Cost.html#9018" class="CatchallClause Bound">budget</a> <a id="9025" class="Symbol">=</a> <a id="9027" href="Data.String.Base.html#3841" class="Function">padRight</a> <a id="9036" class="String">&#39; &#39;</a> <a id="9040" class="Number">22</a> <a id="9043" class="Symbol">(</a><a id="9044" href="Builtin.html#33776" class="Function">showBuiltin</a> <a id="9056" href="Cost.html#9016" class="Bound">b</a><a id="9057" class="Symbol">)</a> <a id="9059" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="9062" class="String">&quot; &quot;</a>
                             <a id="9095" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="9098" href="Cost.html#8308" class="Function">budgetToString</a> <a id="9113" href="Cost.html#9018" class="Bound">budget</a> <a id="9120" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="9123" class="String">&quot;\n&quot;</a>

    <a id="9133" href="Cost.html#9133" class="Function">printBuiltinReport</a> <a id="9152" class="Symbol">:</a> <a id="9154" href="Data.Tree.AVL.Map.html#1133" class="Function">Map</a> <a id="9158" href="Cost.html#1956" class="Record">ExBudget</a> <a id="9167" class="Symbol">‚Üí</a> <a id="9169" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="9180" href="Cost.html#9133" class="Function">printBuiltinReport</a> <a id="9199" href="Cost.html#9199" class="Bound">mp</a> <a id="9202" class="Symbol">=</a>
        <a id="9212" href="Data.List.Base.html#4148" class="Function">L.foldr</a> <a id="9220" class="Symbol">(Œª</a> <a id="9223" href="Cost.html#9223" class="Bound">b</a> <a id="9225" href="Cost.html#9225" class="Bound">xs</a> <a id="9228" class="Symbol">‚Üí</a> <a id="9230" href="Cost.html#8903" class="Function">printBuiltinCost</a> <a id="9247" href="Cost.html#9223" class="Bound">b</a> <a id="9249" class="Symbol">(</a><a id="9250" href="Cost.html#5611" class="Function">lookup</a> <a id="9257" href="Cost.html#9199" class="Bound">mp</a> <a id="9260" class="Symbol">(</a><a id="9261" href="Cost.Base.html#1818" class="InductiveConstructor">BBuiltinApp</a> <a id="9273" href="Cost.html#9223" class="Bound">b</a> <a id="9275" class="Symbol">(</a><a id="9276" href="Data.Vec.Base.html#6493" class="Function">replicate</a> <a id="9286" class="Symbol">(</a><a id="9287" href="Builtin.html#16778" class="Function">arity</a> <a id="9293" href="Cost.html#9223" class="Bound">b</a><a id="9294" class="Symbol">)</a> <a id="9296" class="Symbol">(</a><a id="9297" href="Untyped.CEK.html#1613" class="InductiveConstructor">V-con</a> <a id="9303" class="Symbol">(</a><a id="9304" href="Builtin.Signature.html#1941" class="InductiveConstructor">atomic</a> <a id="9311" href="Builtin.Constant.AtomicType.html#710" class="InductiveConstructor">aUnit</a><a id="9316" class="Symbol">)</a> <a id="9318" href="Agda.Builtin.Unit.html#212" class="InductiveConstructor">tt</a><a id="9320" class="Symbol">))))</a> <a id="9325" href="Data.String.Base.html#2425" class="Function Operator">++</a> <a id="9328" href="Cost.html#9225" class="Bound">xs</a><a id="9330" class="Symbol">)</a>
              <a id="9346" class="String">&quot;&quot;</a>
              <a id="9363" href="Builtin.html#33921" class="Function">builtinList</a>

    <a id="9380" href="Cost.html#9380" class="Function">formatTimePicoseconds</a> <a id="9402" class="Symbol">:</a> <a id="9404" href="Agda.Builtin.Float.html#353" class="Postulate">Float</a> <a id="9410" class="Symbol">‚Üí</a> <a id="9412" href="Agda.Builtin.String.html#335" class="Postulate">String</a>
    <a id="9423" href="Cost.html#9380" class="Function">formatTimePicoseconds</a> <a id="9445" href="Cost.html#9445" class="Bound">t</a> <a id="9447" class="Symbol">=</a> <a id="9449" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="9452" class="Number">1e12</a> <a id="9457" href="Agda.Builtin.Float.html#421" class="Primitive Operator">‚â§·µá</a> <a id="9460" href="Cost.html#9445" class="Bound">t</a> <a id="9462" href="Data.Bool.Base.html#1505" class="Function Operator">then</a> <a id="9467" class="Symbol">(</a><a id="9468" href="Text.Printf.html#1015" class="Function">printf</a> <a id="9475" class="String">&quot;%f s&quot;</a> <a id="9482" class="Symbol">(</a><a id="9483" href="Cost.html#9445" class="Bound">t</a> <a id="9485" href="Agda.Builtin.Float.html#1500" class="Primitive Operator">√∑</a> <a id="9487" class="Number">1e12</a><a id="9491" class="Symbol">))</a> <a id="9494" href="Data.Bool.Base.html#1505" class="Function Operator">else</a>
                              <a id="9529" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="9532" class="Number">1e9</a> <a id="9536" href="Agda.Builtin.Float.html#421" class="Primitive Operator">‚â§·µá</a> <a id="9539" href="Cost.html#9445" class="Bound">t</a> <a id="9541" href="Data.Bool.Base.html#1505" class="Function Operator">then</a>  <a id="9547" class="Symbol">(</a><a id="9548" href="Text.Printf.html#1015" class="Function">printf</a> <a id="9555" class="String">&quot;%f ms&quot;</a> <a id="9563" class="Symbol">(</a><a id="9564" href="Cost.html#9445" class="Bound">t</a> <a id="9566" href="Agda.Builtin.Float.html#1500" class="Primitive Operator">√∑</a> <a id="9568" class="Number">1e9</a><a id="9571" class="Symbol">))</a> <a id="9574" href="Data.Bool.Base.html#1505" class="Function Operator">else</a>
                              <a id="9609" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="9612" class="Number">1e6</a> <a id="9616" href="Agda.Builtin.Float.html#421" class="Primitive Operator">‚â§·µá</a> <a id="9619" href="Cost.html#9445" class="Bound">t</a> <a id="9621" href="Data.Bool.Base.html#1505" class="Function Operator">then</a>  <a id="9627" class="Symbol">(</a><a id="9628" href="Text.Printf.html#1015" class="Function">printf</a> <a id="9635" class="String">&quot;%f Œºs&quot;</a> <a id="9643" class="Symbol">(</a><a id="9644" href="Cost.html#9445" class="Bound">t</a> <a id="9646" href="Agda.Builtin.Float.html#1500" class="Primitive Operator">√∑</a> <a id="9648" class="Number">1e6</a><a id="9651" class="Symbol">))</a> <a id="9654" href="Data.Bool.Base.html#1505" class="Function Operator">else</a>
                              <a id="9689" href="Data.Bool.Base.html#1505" class="Function Operator">if</a> <a id="9692" class="Number">1e3</a> <a id="9696" href="Agda.Builtin.Float.html#421" class="Primitive Operator">‚â§·µá</a> <a id="9699" href="Cost.html#9445" class="Bound">t</a> <a id="9701" href="Data.Bool.Base.html#1505" class="Function Operator">then</a>  <a id="9707" class="Symbol">(</a><a id="9708" href="Text.Printf.html#1015" class="Function">printf</a> <a id="9715" class="String">&quot;%f ns&quot;</a> <a id="9723" class="Symbol">(</a><a id="9724" href="Cost.html#9445" class="Bound">t</a> <a id="9726" href="Agda.Builtin.Float.html#1500" class="Primitive Operator">√∑</a> <a id="9728" class="Number">1e3</a><a id="9731" class="Symbol">))</a> <a id="9734" href="Data.Bool.Base.html#1505" class="Function Operator">else</a>
                              <a id="9769" href="Text.Printf.html#1015" class="Function">printf</a> <a id="9776" class="String">&quot;%f ps&quot;</a> <a id="9784" href="Cost.html#9445" class="Bound">t</a>
</pre>

    </section>
  </body>
</html>